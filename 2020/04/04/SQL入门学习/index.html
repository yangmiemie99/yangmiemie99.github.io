<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/yangmiemie99.github.io/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/yangmiemie99.github.io/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/yangmiemie99.github.io/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/yangmiemie99.github.io/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/yangmiemie99.github.io/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/yangmiemie99.github.io/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/yangmiemie99.github.io/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="数据库,MySQL,">










<meta name="description" content="数据库基础概念什么是数据库数据库是一个以某种有组织的方式存储的数据集合。理解数据库的一种最简单的办法是将其想象为一个文件柜。此文件柜是一个存放数据的物理位置,不管数据是什么以及如何组织的。 数据库软件数据库软件应称为DBMS(数据库管理系统)。数据库是通过DBMS创建和操纵的容器。 表在你将资料放入自己的文件柜时,并不是随便将它们扔进某个抽屉就完事了,而是在文件柜中创建文件,然后将相关的资料放入特">
<meta name="keywords" content="数据库,MySQL">
<meta property="og:type" content="article">
<meta property="og:title" content="SQL入门学习（学习中。。。）">
<meta property="og:url" content="https://yangmiemie99.github.io/2020/04/04/SQL入门学习/index.html">
<meta property="og:site_name" content="MieMieBlog">
<meta property="og:description" content="数据库基础概念什么是数据库数据库是一个以某种有组织的方式存储的数据集合。理解数据库的一种最简单的办法是将其想象为一个文件柜。此文件柜是一个存放数据的物理位置,不管数据是什么以及如何组织的。 数据库软件数据库软件应称为DBMS(数据库管理系统)。数据库是通过DBMS创建和操纵的容器。 表在你将资料放入自己的文件柜时,并不是随便将它们扔进某个抽屉就完事了,而是在文件柜中创建文件,然后将相关的资料放入特">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://yangmiemie99.github.io/yangmiemie99.github.io/2020/04/04/SQL入门学习/%E6%AD%A3%E5%88%99%E5%AD%97%E7%AC%A6%E8%A1%A8.png">
<meta property="og:image" content="https://yangmiemie99.github.io/yangmiemie99.github.io/2020/04/04/SQL入门学习/sql%E6%89%A7%E8%A1%8C.png">
<meta property="og:image" content="https://yangmiemie99.github.io/yangmiemie99.github.io/2020/04/04/SQL入门学习/sql_cache.png">
<meta property="og:image" content="https://yangmiemie99.github.io/yangmiemie99.github.io/2020/04/04/SQL入门学习/%E7%B4%A2%E5%BC%95.jpg">
<meta property="og:image" content="https://yangmiemie99.github.io/yangmiemie99.github.io/2020/04/04/SQL入门学习/explain.png">
<meta property="og:image" content="https://yangmiemie99.github.io/yangmiemie99.github.io/2020/04/04/SQL入门学习/select_type.png">
<meta property="og:image" content="https://yangmiemie99.github.io/yangmiemie99.github.io/2020/04/04/SQL入门学习/extra.png">
<meta property="og:image" content="https://yangmiemie99.github.io/yangmiemie99.github.io/2020/04/04/SQL入门学习/filesort.png">
<meta property="og:image" content="https://yangmiemie99.github.io/yangmiemie99.github.io/2020/04/04/SQL入门学习/filesort2.png">
<meta property="og:image" content="https://yangmiemie99.github.io/yangmiemie99.github.io/2020/04/04/SQL入门学习/%E5%BC%82%E6%AD%A5.png">
<meta property="og:image" content="https://yangmiemie99.github.io/yangmiemie99.github.io/2020/04/04/SQL入门学习/redo_log.png">
<meta property="og:image" content="https://yangmiemie99.github.io/yangmiemie99.github.io/2020/04/04/SQL入门学习/relogbinlog.png">
<meta property="og:image" content="https://yangmiemie99.github.io/yangmiemie99.github.io/2020/04/04/SQL入门学习/%E9%94%81.png">
<meta property="og:image" content="https://yangmiemie99.github.io/yangmiemie99.github.io/2020/04/04/SQL入门学习/MVCCzh.png">
<meta property="og:updated_time" content="2020-04-21T02:47:10.241Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="SQL入门学习（学习中。。。）">
<meta name="twitter:description" content="数据库基础概念什么是数据库数据库是一个以某种有组织的方式存储的数据集合。理解数据库的一种最简单的办法是将其想象为一个文件柜。此文件柜是一个存放数据的物理位置,不管数据是什么以及如何组织的。 数据库软件数据库软件应称为DBMS(数据库管理系统)。数据库是通过DBMS创建和操纵的容器。 表在你将资料放入自己的文件柜时,并不是随便将它们扔进某个抽屉就完事了,而是在文件柜中创建文件,然后将相关的资料放入特">
<meta name="twitter:image" content="https://yangmiemie99.github.io/yangmiemie99.github.io/2020/04/04/SQL入门学习/%E6%AD%A3%E5%88%99%E5%AD%97%E7%AC%A6%E8%A1%A8.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/yangmiemie99.github.io/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://yangmiemie99.github.io/2020/04/04/SQL入门学习/">





  <title>SQL入门学习（学习中。。。） | MieMieBlog</title><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/yangmiemie99.github.io/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">MieMieBlog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/yangmiemie99.github.io/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/yangmiemie99.github.io/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/yangmiemie99.github.io/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/yangmiemie99.github.io/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/yangmiemie99.github.io/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://yangmiemie99.github.io/yangmiemie99.github.io/2020/04/04/SQL入门学习/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yang MieMie">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/yangmiemie99.github.io/images/touxiang.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MieMieBlog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">SQL入门学习（学习中。。。）</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-04-04T01:21:19+08:00">
                2020-04-04
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/yangmiemie99.github.io/categories/数据库/" itemprop="url" rel="index">
                    <span itemprop="name">数据库</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="数据库基础概念"><a href="#数据库基础概念" class="headerlink" title="数据库基础概念"></a>数据库基础概念</h1><h2 id="什么是数据库"><a href="#什么是数据库" class="headerlink" title="什么是数据库"></a>什么是数据库</h2><p>数据库是一个<strong>以某种有组织的方式存储的数据集合</strong>。理解数据库的一种最简单的办法是将其想象为一个文件柜。此文件柜是一个存放数据的物理位置,不管数据是<br>什么以及如何组织的。</p>
<h2 id="数据库软件"><a href="#数据库软件" class="headerlink" title="数据库软件"></a>数据库软件</h2><p>数据库软件应称为DBMS(数据库管理系统)。数据库<br>是通过DBMS创建和操纵的容器。</p>
<h2 id="表"><a href="#表" class="headerlink" title="表"></a>表</h2><p>在你将资料放入自己的文件柜时,并不是随便将它们扔进某个抽屉就完事了,而是在文件柜中创建文件,然后将相关的资料放入特定的文件中。</p>
<p>在数据库领域中,这种文件称为表。<strong>表是一种结构化的文件,可用来存储某种特定类型的数据。</strong></p>
<h2 id="模式"><a href="#模式" class="headerlink" title="模式"></a>模式</h2><p>表具有一些特性,这些特性定义了数据在表中如何存储,如<strong>可以存储什么样的数据,数据如何分解,各部分信息如何命名,等等</strong>。<strong>描述表的这组信息就是所谓的模式</strong>,模式可以用来描述数据库中特定的表以及整个数据库(和其中表的关系)。</p>
<h2 id="列和数据类型"><a href="#列和数据类型" class="headerlink" title="列和数据类型"></a>列和数据类型</h2><p><strong>列</strong>(column) 表中的一个字段。所有表都是由一个或多个列组成的。</p>
<p>数据库中<strong>每个列都有相应的数据类型</strong>。数据类型定义列可以存储的数据种类。例如,如果列中存储的为数字(或许是订单中的物品数),则相应的数据类型应该为数值类型。如果列中存储的是日期、文本、注释、金额等,则应该用恰当的数据类型规定出来。</p>
<h2 id="行"><a href="#行" class="headerlink" title="行"></a>行</h2><p><strong>表中的数据是按行存储的</strong>,所保存的每个记录存储在自己的行内。</p>
<h2 id="主键"><a href="#主键" class="headerlink" title="主键"></a>主键</h2><p>表中每一行都应该有可以<strong>唯一标识自己的一列(</strong>或一组列)。一个顾客表可以使用顾客编号列,而订单表可以使用订单ID,雇员表可以使用雇员ID或雇员社会保险号。</p>
<ul>
<li>任意两行都不具有相同的主键值;</li>
<li>每个行都必须具有一个主键值(主键列不允许NULL值)。</li>
</ul>
<h2 id="什么是-SQL"><a href="#什么是-SQL" class="headerlink" title="什么是 SQL"></a>什么是 SQL</h2><p>结构化查询语言(Structured Query Language) , SQL是一种专门用来与数据库通信的语言。</p>
<h2 id="什么是-MySQL"><a href="#什么是-MySQL" class="headerlink" title="什么是 MySQL"></a>什么是 MySQL</h2><p>数据的所有<strong>存储、检索、管理和处理</strong>实际上是由数据库软件——DBMS(数据库管理系统)完成的。MySQL是一种DBMS,即它是一种数据库软件。</p>
<h3 id="基于客户机—服务器的数据库"><a href="#基于客户机—服务器的数据库" class="headerlink" title="基于客户机—服务器的数据库"></a>基于客户机—服务器的数据库</h3><p><strong>服务器</strong>部分是负责所有数据访问和处理的一个软件。这个软件运行在称为数据库服务器的计算机上。关于<strong>数据、数据添加、删除和数据更新</strong>的所有请求都由服务器软件完成。</p>
<p>这些请求或更改来自运行<strong>客户机软件</strong>的计算机。</p>
<ul>
<li><p>服务器软件为MySQL DBMS。你可以在本地安装的副本上运行,也可以连接到运行在你具有访问权的远程服务器上的一个副本。</p>
</li>
<li><p>客户机可以是MySQL提供的工具、脚本语言(如Perl)、Web应用开发语言(如ASP、ColdFusion、JSP和PHP)、程序设计语言(如C、C++、Java)等。 </p>
</li>
</ul>
<h2 id="登录和退出MySQL服务器"><a href="#登录和退出MySQL服务器" class="headerlink" title="登录和退出MySQL服务器"></a>登录和退出MySQL服务器</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 登录MySQL</span><br><span class="line">$ mysql -u root -p12345612</span><br><span class="line"></span><br><span class="line"># 退出MySQL数据库服务器</span><br><span class="line">exit;</span><br></pre></td></tr></table></figure>

<h2 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h2><ul>
<li>可以通过查看帮助文档查阅所有支持的数据类型</li>
<li>使用数据类型的原则是：够用就行，尽量使用取值范围小的，而不用大的，这样可以更多的节省存储空间</li>
<li>常用数据类型如下：<ul>
<li>整数：int，bit</li>
<li>小数：decimal</li>
<li>字符串：varchar,char</li>
<li>日期时间: date, time, datetime</li>
<li>枚举类型(enum)</li>
</ul>
</li>
<li>特别说明的类型如下：<ul>
<li>decimal表示浮点数，如decimal(5,2)表示共存5位数，小数占2位</li>
<li>char表示固定长度的字符串，如char(3)，如果填充’ab’时会补一个空格为<code>&#39;ab &#39;</code></li>
<li>varchar表示可变长度的字符串，如varchar(3)，填充’ab’时就会存储’ab’</li>
<li>字符串text表示存储大文本，当字符大于4000时推荐使用</li>
<li>对于图片、音频、视频等文件，不存储在数据库中，而是上传到某个服务器上，然后在表中存储这个文件的保存路径</li>
</ul>
</li>
<li>更全的数据类型可以参考<a href="http://blog.csdn.net/anxpp/article/details/51284106" target="_blank" rel="noopener">http://blog.csdn.net/anxpp/article/details/51284106</a></li>
</ul>
<blockquote>
<p>数值类型(常用)</p>
</blockquote>
<table>
<thead>
<tr>
<th align="left">类型</th>
<th align="left">字节大小</th>
<th align="left">有符号范围(Signed)</th>
<th align="left">无符号范围(Unsigned)</th>
</tr>
</thead>
<tbody><tr>
<td align="left">TINYINT</td>
<td align="left">1</td>
<td align="left">-128 ~ 127</td>
<td align="left">0 ~ 255</td>
</tr>
<tr>
<td align="left">SMALLINT</td>
<td align="left">2</td>
<td align="left">-32768 ~ 32767</td>
<td align="left">0 ~ 65535</td>
</tr>
<tr>
<td align="left">MEDIUMINT</td>
<td align="left">3</td>
<td align="left">-8388608 ~ 8388607</td>
<td align="left">0 ~ 16777215</td>
</tr>
<tr>
<td align="left">INT/INTEGER</td>
<td align="left">4</td>
<td align="left">-2147483648 ~2147483647</td>
<td align="left">0 ~ 4294967295</td>
</tr>
<tr>
<td align="left">BIGINT</td>
<td align="left">8</td>
<td align="left">-9223372036854775808 ~ 9223372036854775807</td>
<td align="left">0 ~ 18446744073709551615</td>
</tr>
</tbody></table>
<blockquote>
<p>字符串</p>
</blockquote>
<table>
<thead>
<tr>
<th align="left">类型</th>
<th align="left">字节大小</th>
<th align="left">示例</th>
</tr>
</thead>
<tbody><tr>
<td align="left">CHAR</td>
<td align="left">0-255</td>
<td align="left">类型:char(3) 输入 ‘ab’, 实际存储为’ab ‘, 输入’abcd’ 实际存储为 ‘abc’</td>
</tr>
<tr>
<td align="left">VARCHAR</td>
<td align="left">0-255</td>
<td align="left">类型:varchar(3) 输 ‘ab’,实际存储为’ab’, 输入’abcd’,实际存储为’abc’</td>
</tr>
<tr>
<td align="left">TEXT</td>
<td align="left">0-65535</td>
<td align="left">大文本</td>
</tr>
</tbody></table>
<blockquote>
<p>日期时间类型</p>
</blockquote>
<table>
<thead>
<tr>
<th align="left">类型</th>
<th align="left">字节大小</th>
<th align="left">示例</th>
</tr>
</thead>
<tbody><tr>
<td align="left">DATE</td>
<td align="left">4</td>
<td align="left">‘2020-01-01’</td>
</tr>
<tr>
<td align="left">TIME</td>
<td align="left">3</td>
<td align="left">‘12:29:59’</td>
</tr>
<tr>
<td align="left">DATETIME</td>
<td align="left">8</td>
<td align="left">‘2020-01-01 12:29:59’</td>
</tr>
<tr>
<td align="left">YEAR</td>
<td align="left">1</td>
<td align="left">‘2017’</td>
</tr>
<tr>
<td align="left">TIMESTAMP</td>
<td align="left">4</td>
<td align="left">‘1970-01-01 00:00:01’ UTC ~ ‘2038-01-01 00:00:01’ UTC</td>
</tr>
</tbody></table>
<h2 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 显示所有数据库</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">databases</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建数据库</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> <span class="keyword">test</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 切换数据库</span></span><br><span class="line"><span class="keyword">use</span> <span class="keyword">test</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 显示数据库中的所有表</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">tables</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建数据表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> pet (</span><br><span class="line">    <span class="keyword">name</span> <span class="built_in">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">    owner <span class="built_in">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">    species <span class="built_in">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">    sex <span class="built_in">CHAR</span>(<span class="number">1</span>),</span><br><span class="line">    birth <span class="built_in">DATE</span>,</span><br><span class="line">    death <span class="built_in">DATE</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看数据表结构</span></span><br><span class="line"><span class="comment">-- describe pet;</span></span><br><span class="line">desc pet;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询表</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">from</span> pet;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入数据</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> pet <span class="keyword">VALUES</span> (<span class="string">'puffball'</span>, <span class="string">'Diane'</span>, <span class="string">'hamster'</span>, <span class="string">'f'</span>, <span class="string">'1990-03-30'</span>, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 修改数据</span></span><br><span class="line"><span class="keyword">UPDATE</span> pet <span class="keyword">SET</span> <span class="keyword">name</span> = <span class="string">'squirrel'</span> <span class="keyword">where</span> owner = <span class="string">'Diane'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除数据</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> pet <span class="keyword">where</span> <span class="keyword">name</span> = <span class="string">'squirrel'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除表</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> myorder;</span><br></pre></td></tr></table></figure>

<h2 id="输入中文乱码解决"><a href="#输入中文乱码解决" class="headerlink" title="输入中文乱码解决"></a>输入中文乱码解决</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--创建数据库的时候默认utf-8</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> abcd <span class="keyword">DEFAULT</span> <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> utf8;</span><br><span class="line"><span class="comment">--查看mysql的字符集：</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">variables</span> <span class="keyword">where</span> Variable_name <span class="keyword">like</span> <span class="string">'%char%'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--查看某一个数据库字符集：</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">database</span> <span class="keyword">test</span>;(注：test为数据库)</span><br><span class="line"><span class="comment">--看数据表的编码：</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">table</span> pet; </span><br><span class="line"><span class="comment">--修改数据库test的字符集：</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">database</span> <span class="keyword">test</span> <span class="built_in">character</span> <span class="keyword">set</span> utf8</span><br><span class="line"><span class="comment">--修改表的编码方式：</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> pet <span class="keyword">default</span> <span class="built_in">character</span> <span class="keyword">set</span> utf8;</span><br><span class="line"></span><br><span class="line"><span class="comment">--修改字段的编码方式：</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> pet <span class="keyword">change</span> <span class="keyword">name</span> <span class="keyword">name</span> <span class="built_in">varchar</span>(<span class="number">20</span>) <span class="built_in">character</span> <span class="keyword">set</span> utf8;</span><br><span class="line">该命令用于将表pet中name字段的编码方式改为utf8</span><br><span class="line"></span><br><span class="line"><span class="comment">--修改之后可以插入中文</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> pet <span class="keyword">VALUE</span>(<span class="string">'旺财'</span>,<span class="string">'周星驰'</span>,<span class="string">'狗'</span>,<span class="string">'公'</span>,<span class="string">'1993-1-1'</span>,<span class="literal">NULL</span>);</span><br></pre></td></tr></table></figure>

<h2 id="建表约束"><a href="#建表约束" class="headerlink" title="建表约束"></a>建表约束</h2><h3 id="主键约束"><a href="#主键约束" class="headerlink" title="主键约束"></a>主键约束</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 主键约束</span></span><br><span class="line"><span class="comment">-- 使某个字段不重复且不得为空，确保表内所有数据的唯一性。</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">user</span> (</span><br><span class="line">    <span class="keyword">id</span> <span class="built_in">INT</span> PRIMARY <span class="keyword">KEY</span>,</span><br><span class="line">    <span class="keyword">name</span> <span class="built_in">VARCHAR</span>(<span class="number">20</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 联合主键</span></span><br><span class="line"><span class="comment">-- 联合主键中的每个字段都不能为空，并且加起来不能和已设置的联合主键重复。</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">user</span> (</span><br><span class="line">    <span class="keyword">id</span> <span class="built_in">INT</span>,</span><br><span class="line">    <span class="keyword">name</span> <span class="built_in">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">    <span class="keyword">password</span> <span class="built_in">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">    PRIMARY <span class="keyword">KEY</span>(<span class="keyword">id</span>, <span class="keyword">name</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> usr(<span class="number">1</span>,<span class="string">'zhangsa'</span>,<span class="string">'fff'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 自增约束</span></span><br><span class="line"><span class="comment">-- 自增约束的主键由系统自动递增分配。</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">user</span> (</span><br><span class="line">    <span class="keyword">id</span> <span class="built_in">INT</span> PRIMARY <span class="keyword">KEY</span> AUTO_INCREMENT,</span><br><span class="line">    <span class="keyword">name</span> <span class="built_in">VARCHAR</span>(<span class="number">20</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 添加主键约束</span></span><br><span class="line"><span class="comment">-- 如果忘记设置主键，还可以通过SQL语句设置（两种方式）：</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="keyword">user</span> <span class="keyword">ADD</span> PRIMARY <span class="keyword">KEY</span>(<span class="keyword">id</span>);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="keyword">user</span> <span class="keyword">MODIFY</span> <span class="keyword">id</span> <span class="built_in">INT</span> PRIMARY <span class="keyword">KEY</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除主键</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="keyword">user</span> <span class="keyword">drop</span> PRIMARY <span class="keyword">KEY</span>;</span><br></pre></td></tr></table></figure>

<h3 id="唯一约束"><a href="#唯一约束" class="headerlink" title="唯一约束"></a>唯一约束</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--主键值不能为空，唯一约束值可以为空</span></span><br><span class="line"><span class="comment">-- 建表时创建唯一主键</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">user</span> (</span><br><span class="line">    <span class="keyword">id</span> <span class="built_in">INT</span>,</span><br><span class="line">    <span class="keyword">name</span> <span class="built_in">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">    <span class="keyword">UNIQUE</span>(<span class="keyword">name</span>)</span><br><span class="line">);</span><br><span class="line"><span class="comment">--两个不能同时重复</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">user</span> (</span><br><span class="line">    <span class="keyword">id</span> <span class="built_in">INT</span>,</span><br><span class="line">    <span class="keyword">name</span> <span class="built_in">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">    <span class="keyword">UNIQUE</span>(<span class="keyword">id</span>,<span class="keyword">name</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 添加唯一约束</span></span><br><span class="line"><span class="comment">-- 如果建表时没有设置唯一建，还可以通过SQL语句设置（两种方式）：</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="keyword">user</span> <span class="keyword">ADD</span> <span class="keyword">UNIQUE</span>(<span class="keyword">name</span>);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="keyword">user</span> <span class="keyword">MODIFY</span> <span class="keyword">name</span> <span class="built_in">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">UNIQUE</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除唯一约束</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="keyword">user</span> <span class="keyword">DROP</span> <span class="keyword">INDEX</span> <span class="keyword">name</span>;</span><br></pre></td></tr></table></figure>

<h3 id="非空约束"><a href="#非空约束" class="headerlink" title="非空约束"></a>非空约束</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 建表时添加非空约束</span></span><br><span class="line"><span class="comment">-- 约束某个字段不能为空</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">user</span> (</span><br><span class="line">    <span class="keyword">id</span> <span class="built_in">INT</span>,</span><br><span class="line">    <span class="keyword">name</span> <span class="built_in">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 移除非空约束</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="keyword">user</span> <span class="keyword">MODIFY</span> <span class="keyword">name</span> <span class="built_in">VARCHAR</span>(<span class="number">20</span>);</span><br></pre></td></tr></table></figure>

<h3 id="默认约束"><a href="#默认约束" class="headerlink" title="默认约束"></a>默认约束</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 建表时添加默认约束</span></span><br><span class="line"><span class="comment">-- 约束某个字段的默认值</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> user2 (</span><br><span class="line">    <span class="keyword">id</span> <span class="built_in">INT</span>,</span><br><span class="line">    <span class="keyword">name</span> <span class="built_in">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">    age <span class="built_in">INT</span> <span class="keyword">DEFAULT</span> <span class="number">10</span></span><br><span class="line">);</span><br><span class="line"><span class="comment">--只插入两个字段,默认年龄为10</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> user2 (<span class="keyword">id</span>,<span class="keyword">name</span>) <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">'zhagnsa'</span>);</span><br><span class="line"><span class="comment">-- 移除非空约束</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="keyword">user</span> <span class="keyword">MODIFY</span> age <span class="built_in">INT</span>;</span><br></pre></td></tr></table></figure>

<h3 id="外键约束"><a href="#外键约束" class="headerlink" title="外键约束"></a>外键约束</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 班级</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> classes (</span><br><span class="line">    <span class="keyword">id</span> <span class="built_in">INT</span> PRIMARY <span class="keyword">KEY</span>,</span><br><span class="line">    <span class="keyword">name</span> <span class="built_in">VARCHAR</span>(<span class="number">20</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 学生表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> students (</span><br><span class="line">    <span class="keyword">id</span> <span class="built_in">INT</span> PRIMARY <span class="keyword">KEY</span>,</span><br><span class="line">    <span class="keyword">name</span> <span class="built_in">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">    <span class="comment">-- 这里的 class_id 要和 classes 中的 id 字段相关联</span></span><br><span class="line">    class_id <span class="built_in">INT</span>,</span><br><span class="line">    <span class="comment">-- 表示 class_id 的值必须来自于 classes 中的 id 字段值</span></span><br><span class="line">    <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span>(class_id) <span class="keyword">REFERENCES</span> classes(<span class="keyword">id</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 1. 主表（父表）classes 中没有的数据值，在副表（子表）students 中，是不可以使用的；</span></span><br><span class="line"><span class="comment">-- 2. 主表中的记录被副表引用时，主表不可以被删除。</span></span><br></pre></td></tr></table></figure>

<h2 id="数据库的三大设计范式"><a href="#数据库的三大设计范式" class="headerlink" title="数据库的三大设计范式"></a>数据库的三大设计范式</h2><h3 id="1NF"><a href="#1NF" class="headerlink" title="1NF"></a>1NF</h3><p>数据表中的所有字段都是不可分割的原子值。</p>
<p>只要字段值还可以继续拆分，就不满足第一范式。</p>
<p>范式设计得越详细，对某些实际操作可能会更好，但并非都有好处，需要对项目的实际情况进行设定。</p>
<h3 id="2NF"><a href="#2NF" class="headerlink" title="2NF"></a>2NF</h3><p><strong>必须在满足第一范式的前提下</strong>，其他列都必须完全依赖于主键列。如果出现不完全依赖，只可能发生在联合主键的情况下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 订单表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> myorder (</span><br><span class="line">    product_id <span class="built_in">INT</span>,</span><br><span class="line">    customer_id <span class="built_in">INT</span>,</span><br><span class="line">    product_name <span class="built_in">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">    customer_name <span class="built_in">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">    PRIMARY <span class="keyword">KEY</span> (product_id, customer_id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>实际上，在这张订单表中，<code>product_name</code> 只依赖于 <code>product_id</code> ，<code>customer_name</code> 只依赖于 <code>customer_id</code> 。也就是说，<code>product_name</code> 和 <code>customer_id</code> 是没用关系的，<code>customer_name</code> 和 <code>product_id</code> 也是没有关系的。</p>
<p>这就不满足第二范式：除主键以外其他列都必须完全依赖于主键列！</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> myorder (</span><br><span class="line">    order_id <span class="built_in">INT</span> PRIMARY <span class="keyword">KEY</span>,</span><br><span class="line">    product_id <span class="built_in">INT</span>,</span><br><span class="line">    customer_id <span class="built_in">INT</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> product (</span><br><span class="line">    <span class="keyword">id</span> <span class="built_in">INT</span> PRIMARY <span class="keyword">KEY</span>,</span><br><span class="line">    <span class="keyword">name</span> <span class="built_in">VARCHAR</span>(<span class="number">20</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> customer (</span><br><span class="line">    <span class="keyword">id</span> <span class="built_in">INT</span> PRIMARY <span class="keyword">KEY</span>,</span><br><span class="line">    <span class="keyword">name</span> <span class="built_in">VARCHAR</span>(<span class="number">20</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>拆分之后，<code>myorder</code> 表中的 <code>product_id</code> 和 <code>customer_id</code> 完全依赖于 <code>order_id</code> 主键，而 <code>product</code> 和 <code>customer</code> 表中的其他字段又完全依赖于主键。满足了第二范式的设计！</p>
<h3 id="3NF"><a href="#3NF" class="headerlink" title="3NF"></a>3NF</h3><p>必须在满足第二范式的前提下，除了主键列之外，<strong>其他列之间不能有传递依赖关系。</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> myorder (</span><br><span class="line">    order_id <span class="built_in">INT</span> PRIMARY <span class="keyword">KEY</span>,</span><br><span class="line">    product_id <span class="built_in">INT</span>,</span><br><span class="line">    customer_id <span class="built_in">INT</span>,</span><br><span class="line">    customer_phone <span class="built_in">VARCHAR</span>(<span class="number">15</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>表中的 <code>customer_phone</code> 有可能依赖于 <code>order_id</code> 、 <code>customer_id</code> 两列，也就不满足了第三范式的设计：其他列之间不能有传递依赖关系。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> myorder (</span><br><span class="line">    order_id <span class="built_in">INT</span> PRIMARY <span class="keyword">KEY</span>,</span><br><span class="line">    product_id <span class="built_in">INT</span>,</span><br><span class="line">    customer_id <span class="built_in">INT</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> customer (</span><br><span class="line">    <span class="keyword">id</span> <span class="built_in">INT</span> PRIMARY <span class="keyword">KEY</span>,</span><br><span class="line">    <span class="keyword">name</span> <span class="built_in">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">    phone <span class="built_in">VARCHAR</span>(<span class="number">15</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>修改后就不存在其他列之间的传递依赖关系，其他列都只依赖于主键列，满足了第三范式的设计！</p>
<h2 id="查询边学边练"><a href="#查询边学边练" class="headerlink" title="查询边学边练"></a>查询边学边练</h2><h3 id="准备数据"><a href="#准备数据" class="headerlink" title="准备数据"></a>准备数据</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建数据库</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> select_test;</span><br><span class="line"><span class="comment">-- 切换数据库</span></span><br><span class="line"><span class="keyword">USE</span> select_test;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建学生表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> student (</span><br><span class="line">    <span class="keyword">no</span> <span class="built_in">VARCHAR</span>(<span class="number">20</span>) PRIMARY <span class="keyword">KEY</span>,</span><br><span class="line">    <span class="keyword">name</span> <span class="built_in">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">    sex <span class="built_in">VARCHAR</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">    birthday <span class="built_in">DATE</span>, <span class="comment">-- 生日</span></span><br><span class="line">    <span class="keyword">class</span> <span class="built_in">VARCHAR</span>(<span class="number">20</span>) <span class="comment">-- 所在班级</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建教师表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> teacher (</span><br><span class="line">    <span class="keyword">no</span> <span class="built_in">VARCHAR</span>(<span class="number">20</span>) PRIMARY <span class="keyword">KEY</span>,</span><br><span class="line">    <span class="keyword">name</span> <span class="built_in">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">    sex <span class="built_in">VARCHAR</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">    birthday <span class="built_in">DATE</span>,</span><br><span class="line">    profession <span class="built_in">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>, <span class="comment">-- 职称</span></span><br><span class="line">    department <span class="built_in">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="comment">-- 部门</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建课程表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> course (</span><br><span class="line">    <span class="keyword">no</span> <span class="built_in">VARCHAR</span>(<span class="number">20</span>) PRIMARY <span class="keyword">KEY</span>,</span><br><span class="line">    <span class="keyword">name</span> <span class="built_in">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">    t_no <span class="built_in">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>, <span class="comment">-- 教师编号</span></span><br><span class="line">    <span class="comment">-- 表示该 tno 来自于 teacher 表中的 no 字段值</span></span><br><span class="line">    <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span>(t_no) <span class="keyword">REFERENCES</span> teacher(<span class="keyword">no</span>) </span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 成绩表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> score (</span><br><span class="line">    s_no <span class="built_in">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>, <span class="comment">-- 学生编号</span></span><br><span class="line">    c_no <span class="built_in">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>, <span class="comment">-- 课程号</span></span><br><span class="line">    degree <span class="built_in">DECIMAL</span>,	<span class="comment">-- 成绩</span></span><br><span class="line">    <span class="comment">-- 表示该 s_no, c_no 分别来自于 student, course 表中的 no 字段值</span></span><br><span class="line">    <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span>(s_no) <span class="keyword">REFERENCES</span> student(<span class="keyword">no</span>),	</span><br><span class="line">    <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span>(c_no) <span class="keyword">REFERENCES</span> course(<span class="keyword">no</span>),</span><br><span class="line">    <span class="comment">-- 设置 s_no, c_no 为联合主键</span></span><br><span class="line">    PRIMARY <span class="keyword">KEY</span>(s_no, c_no)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看所有表</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">TABLES</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 添加学生表数据</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> student <span class="keyword">VALUES</span>(<span class="string">'101'</span>, <span class="string">'曾华'</span>, <span class="string">'男'</span>, <span class="string">'1977-09-01'</span>, <span class="string">'95033'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> student <span class="keyword">VALUES</span>(<span class="string">'102'</span>, <span class="string">'匡明'</span>, <span class="string">'男'</span>, <span class="string">'1975-10-02'</span>, <span class="string">'95031'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> student <span class="keyword">VALUES</span>(<span class="string">'103'</span>, <span class="string">'王丽'</span>, <span class="string">'女'</span>, <span class="string">'1976-01-23'</span>, <span class="string">'95033'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> student <span class="keyword">VALUES</span>(<span class="string">'104'</span>, <span class="string">'李军'</span>, <span class="string">'男'</span>, <span class="string">'1976-02-20'</span>, <span class="string">'95033'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> student <span class="keyword">VALUES</span>(<span class="string">'105'</span>, <span class="string">'王芳'</span>, <span class="string">'女'</span>, <span class="string">'1975-02-10'</span>, <span class="string">'95031'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> student <span class="keyword">VALUES</span>(<span class="string">'106'</span>, <span class="string">'陆军'</span>, <span class="string">'男'</span>, <span class="string">'1974-06-03'</span>, <span class="string">'95031'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> student <span class="keyword">VALUES</span>(<span class="string">'107'</span>, <span class="string">'王尼玛'</span>, <span class="string">'男'</span>, <span class="string">'1976-02-20'</span>, <span class="string">'95033'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> student <span class="keyword">VALUES</span>(<span class="string">'108'</span>, <span class="string">'张全蛋'</span>, <span class="string">'男'</span>, <span class="string">'1975-02-10'</span>, <span class="string">'95031'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> student <span class="keyword">VALUES</span>(<span class="string">'109'</span>, <span class="string">'赵铁柱'</span>, <span class="string">'男'</span>, <span class="string">'1974-06-03'</span>, <span class="string">'95031'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 添加教师表数据</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> teacher <span class="keyword">VALUES</span>(<span class="string">'804'</span>, <span class="string">'李诚'</span>, <span class="string">'男'</span>, <span class="string">'1958-12-02'</span>, <span class="string">'副教授'</span>, <span class="string">'计算机系'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> teacher <span class="keyword">VALUES</span>(<span class="string">'856'</span>, <span class="string">'张旭'</span>, <span class="string">'男'</span>, <span class="string">'1969-03-12'</span>, <span class="string">'讲师'</span>, <span class="string">'电子工程系'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> teacher <span class="keyword">VALUES</span>(<span class="string">'825'</span>, <span class="string">'王萍'</span>, <span class="string">'女'</span>, <span class="string">'1972-05-05'</span>, <span class="string">'助教'</span>, <span class="string">'计算机系'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> teacher <span class="keyword">VALUES</span>(<span class="string">'831'</span>, <span class="string">'刘冰'</span>, <span class="string">'女'</span>, <span class="string">'1977-08-14'</span>, <span class="string">'助教'</span>, <span class="string">'电子工程系'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 添加课程表数据</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> course <span class="keyword">VALUES</span>(<span class="string">'3-105'</span>, <span class="string">'计算机导论'</span>, <span class="string">'825'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> course <span class="keyword">VALUES</span>(<span class="string">'3-245'</span>, <span class="string">'操作系统'</span>, <span class="string">'804'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> course <span class="keyword">VALUES</span>(<span class="string">'6-166'</span>, <span class="string">'数字电路'</span>, <span class="string">'856'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> course <span class="keyword">VALUES</span>(<span class="string">'9-888'</span>, <span class="string">'高等数学'</span>, <span class="string">'831'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 添加添加成绩表数据</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> score <span class="keyword">VALUES</span>(<span class="string">'103'</span>, <span class="string">'3-105'</span>, <span class="string">'92'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> score <span class="keyword">VALUES</span>(<span class="string">'103'</span>, <span class="string">'3-245'</span>, <span class="string">'86'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> score <span class="keyword">VALUES</span>(<span class="string">'103'</span>, <span class="string">'6-166'</span>, <span class="string">'85'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> score <span class="keyword">VALUES</span>(<span class="string">'105'</span>, <span class="string">'3-105'</span>, <span class="string">'88'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> score <span class="keyword">VALUES</span>(<span class="string">'105'</span>, <span class="string">'3-245'</span>, <span class="string">'75'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> score <span class="keyword">VALUES</span>(<span class="string">'105'</span>, <span class="string">'6-166'</span>, <span class="string">'79'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> score <span class="keyword">VALUES</span>(<span class="string">'109'</span>, <span class="string">'3-105'</span>, <span class="string">'76'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> score <span class="keyword">VALUES</span>(<span class="string">'109'</span>, <span class="string">'3-245'</span>, <span class="string">'68'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> score <span class="keyword">VALUES</span>(<span class="string">'109'</span>, <span class="string">'6-166'</span>, <span class="string">'81'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看表结构</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> course;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> score;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> student;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> teacher;</span><br></pre></td></tr></table></figure>

<h3 id="查询基本使用"><a href="#查询基本使用" class="headerlink" title="查询基本使用"></a>查询基本使用</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询 student 表的所有行</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> student;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询 student 表中的 name、sex 和 class 字段的所有行</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">name</span>, sex, <span class="keyword">class</span> <span class="keyword">FROM</span> student;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询 teacher 表中不重复的 department 列</span></span><br><span class="line"><span class="comment">-- department: 去重查询</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> department <span class="keyword">FROM</span> teacher;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询 score 表中成绩在60-80之间的所有行（区间查询和运算符查询）</span></span><br><span class="line"><span class="comment">-- BETWEEN xx AND xx: 查询区间, AND 表示 "并且"</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> score <span class="keyword">WHERE</span> degree <span class="keyword">BETWEEN</span> <span class="number">60</span> <span class="keyword">AND</span> <span class="number">80</span>;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> score <span class="keyword">WHERE</span> degree &gt; <span class="number">60</span> <span class="keyword">AND</span> degree &lt; <span class="number">80</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询 score 表中成绩为 85, 86 或 88 的行</span></span><br><span class="line"><span class="comment">-- IN: 查询规定中的多个值</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> score <span class="keyword">WHERE</span> degree <span class="keyword">IN</span> (<span class="number">85</span>, <span class="number">86</span>, <span class="number">88</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询 student 表中 '95031' 班或性别为 '女' 的所有行</span></span><br><span class="line"><span class="comment">-- or: 表示或者关系</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> <span class="keyword">class</span> = <span class="string">'95031'</span> <span class="keyword">or</span> sex = <span class="string">'女'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 以 class 降序的方式查询 student 表的所有行</span></span><br><span class="line"><span class="comment">-- DESC: 降序，从高到低</span></span><br><span class="line"><span class="comment">-- ASC（默认）: 升序，从低到高</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> student <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">class</span> <span class="keyword">DESC</span>;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> student <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">class</span> <span class="keyword">ASC</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 以 c_no 升序、degree 降序查询 score 表的所有行</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> score <span class="keyword">ORDER</span>  <span class="keyword">BY</span> c_no <span class="keyword">ASC</span>, degree <span class="keyword">DESC</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询 "95031" 班的学生人数</span></span><br><span class="line"><span class="comment">-- COUNT: 统计</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(*) <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> <span class="keyword">class</span> = <span class="string">'95031'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询 score 表中的最高分的学生学号和课程编号（子查询或排序查询）。</span></span><br><span class="line"><span class="comment">-- (SELECT MAX(degree) FROM score): 子查询，算出最高分</span></span><br><span class="line"><span class="keyword">SELECT</span> s_no, c_no <span class="keyword">FROM</span> score <span class="keyword">WHERE</span> degree = (<span class="keyword">SELECT</span> <span class="keyword">MAX</span>(degree) <span class="keyword">FROM</span> score);</span><br><span class="line"></span><br><span class="line"><span class="comment">--  排序查询,最高分有两个出现问题 </span></span><br><span class="line"><span class="comment">-- LIMIT r, n: 表示从第r行开始，查询n条数据</span></span><br><span class="line"><span class="keyword">SELECT</span> s_no, c_no, degree <span class="keyword">FROM</span> score <span class="keyword">ORDER</span> <span class="keyword">BY</span> degree <span class="keyword">DESC</span> <span class="keyword">LIMIT</span> <span class="number">0</span>, <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<h3 id="WHERE子句注意"><a href="#WHERE子句注意" class="headerlink" title="WHERE子句注意"></a>WHERE子句注意</h3><ul>
<li><p>WHERE 子句的位置<br>在同时使用 ORDER BY 和 WHERE 子句时,应<br>该让 <strong>ORDER BY 位于 WHERE 之后</strong>,否则将会产生错误</p>
</li>
<li><p>WHERE 子句操作符</p>
<p><code>= ,!=,&lt;&gt;不等于,&lt;,&lt;=,&gt;,&gt;=,BETWEEN...AND...,IS NULL检查是否为空值，is not null检查不为空值的列</code></p>
</li>
</ul>
<h3 id="AND和OR的计算次序"><a href="#AND和OR的计算次序" class="headerlink" title="AND和OR的计算次序"></a>AND和OR的计算次序</h3><p>可使用 AND 操作符给 WHERE 子句附加条件。WHERE 可包含任意数目的 AND 和 OR 操作符。SQL(像多数语言一样)在<strong>处理 OR 操作符前,优先处理 AND</strong> 操<br>作符。所以在指定顺序的附加条件需要加括号。比如</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">name</span>,price <span class="keyword">from</span> products <span class="keyword">where</span> (<span class="keyword">id</span> = <span class="number">1002</span> <span class="keyword">or</span> <span class="keyword">id</span> =<span class="number">1003</span>) <span class="keyword">and</span> price &gt;=<span class="number">10</span>;</span><br></pre></td></tr></table></figure>

<h3 id="通配符LIKE"><a href="#通配符LIKE" class="headerlink" title="通配符LIKE"></a>通配符LIKE</h3><p>最常使用的通配符是百分号( % )。在搜索串中, % 表示任何字符出现任意次数。另一个有用的通配符是下划线( _ )。下划线的用途与 % 一样,但下划线只匹配单个字符而不是多个字符。</p>
<h3 id="where子句中的正则表达式"><a href="#where子句中的正则表达式" class="headerlink" title="where子句中的正则表达式"></a>where子句中的正则表达式</h3><p>则表达式的作用是匹配文本,将一个模式(正则表达式)与一个文本串进行比较。关键词REGEXP</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--下面的语句检索name中包含1000的所有行</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">name</span> <span class="keyword">from</span> products <span class="keyword">where</span> <span class="keyword">name</span> REGEXP <span class="string">'1000'</span> ordered <span class="keyword">by</span> <span class="keyword">name</span>;</span><br><span class="line"><span class="comment">--.代替任意字符</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">name</span> <span class="keyword">from</span> products <span class="keyword">where</span> <span class="keyword">name</span> REGEXP <span class="string">'.000'</span> ordered <span class="keyword">by</span> <span class="keyword">name</span>;</span><br></pre></td></tr></table></figure>

<p>进行OR匹配</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">name</span> <span class="keyword">from</span> products </span><br><span class="line"><span class="keyword">where</span> <span class="keyword">name</span> REGEXP <span class="string">'1000|2000'</span> </span><br><span class="line">ordered <span class="keyword">by</span> <span class="keyword">name</span>;</span><br></pre></td></tr></table></figure>

<p>匹配几个字符之一</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">name</span> <span class="keyword">from</span> products </span><br><span class="line"><span class="keyword">where</span> <span class="keyword">name</span> REGEXP <span class="string">'[123] ton'</span> </span><br><span class="line">ordered <span class="keyword">by</span> <span class="keyword">name</span>;</span><br></pre></td></tr></table></figure>

<p>范围匹配</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">name</span> <span class="keyword">from</span> products </span><br><span class="line"><span class="keyword">where</span> <span class="keyword">name</span> REGEXP <span class="string">'[1-5] ton'</span> </span><br><span class="line">ordered <span class="keyword">by</span> <span class="keyword">name</span>;</span><br></pre></td></tr></table></figure>

<p>匹配特殊字符</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--如果要找出包含 . 字符的值,怎样搜索?</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">name</span> <span class="keyword">from</span> products </span><br><span class="line"><span class="keyword">where</span> <span class="keyword">name</span> REGEXP <span class="string">'\\.'</span> </span><br><span class="line">ordered <span class="keyword">by</span> <span class="keyword">name</span>;</span><br></pre></td></tr></table></figure>

<p>匹配字符类为更方便工作,可以使用预定义的字符集,称为字符类(character class)。</p>
<p><img src="/yangmiemie99.github.io/2020/04/04/SQL入门学习/%E6%AD%A3%E5%88%99%E5%AD%97%E7%AC%A6%E8%A1%A8.png" alt></p>
<p>匹配多个实例</p>
<table>
<thead>
<tr>
<th>元字符</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>*</td>
<td>0个或者多个匹配</td>
</tr>
<tr>
<td>+</td>
<td>1个或者多个匹配</td>
</tr>
<tr>
<td>?</td>
<td>0或1个匹配</td>
</tr>
<tr>
<td>{n}</td>
<td>指定数目的匹配</td>
</tr>
<tr>
<td>{n,}</td>
<td>不少于n个的匹配</td>
</tr>
<tr>
<td>{n,m}</td>
<td>匹配数目范围n-m</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--匹配带有扩按0-9数字任意一个后接stick,s可有可无</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">name</span> <span class="keyword">from</span> products</span><br><span class="line"><span class="keyword">where</span> naem regexp <span class="string">'\\([0-9] sticks?\\)'</span></span><br><span class="line"><span class="comment">--匹配任意数字连续四个</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">name</span> <span class="keyword">from</span> products </span><br><span class="line"><span class="keyword">where</span> <span class="keyword">name</span> REGEXP <span class="string">'[[:digits:]]&#123;4&#125;'</span> </span><br><span class="line">ordered <span class="keyword">by</span> <span class="keyword">name</span>;</span><br></pre></td></tr></table></figure>

<p>定位符</p>
<table>
<thead>
<tr>
<th>元字符</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>^</td>
<td>文本的开始</td>
</tr>
<tr>
<td>$</td>
<td>文本的结尾</td>
</tr>
<tr>
<td>[[:&lt;:]]</td>
<td>词的开始</td>
</tr>
<tr>
<td>[[:&gt;:]]</td>
<td>词的结尾</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--例如,如果你想找出以一个数(包括以小数点开始的数)开始的所有产品</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">name</span> <span class="keyword">from</span> products </span><br><span class="line"><span class="keyword">where</span> <span class="keyword">name</span> REGEXP <span class="string">'^[[:digit:]\\.]'</span> </span><br><span class="line">ordered <span class="keyword">by</span> <span class="keyword">name</span>;</span><br></pre></td></tr></table></figure>

<h3 id="创建计算字段"><a href="#创建计算字段" class="headerlink" title="创建计算字段"></a>创建计算字段</h3><p>存储在数据库表中的数据一般<strong>不是</strong>应用程序<strong>所需要的格式</strong>。</p>
<p>例如：如果想在一个字段中既显示公司名,又显示公司的地址,但这两个信息一般包含在不同的表列中。但报表程序需要把所有数据按大写表示出来。物品订单表存储物品的价格和数量,但不需要存储每个物品的总价格(用价格乘以数量即可)。<strong>需要根据表数据进行总数、平均数计算或其他计算。</strong></p>
<p>存储在表中的数据都不是应用程序所需要的。<br>我们需要<strong>直接从数据库中检索出转换、计算或格式化过的数据</strong>;而不是检索出数据,然后再在客户机应用程序或报告程序中重新格式化。</p>
<ul>
<li>拼接字段：将值联结到一起构成单个值。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">concat</span>(<span class="keyword">name</span>,<span class="string">'('</span>,<span class="string">"生日"</span>,birthday,<span class="string">')'</span>) <span class="keyword">from</span> student;</span><br><span class="line">+<span class="comment">----------------------------------------+</span></span><br><span class="line">| concat(name,'(',"生日",birthday,')')   |</span><br><span class="line">+<span class="comment">----------------------------------------+</span></span><br><span class="line">| 曾华(生日1977-09-01)                   |</span><br><span class="line">| 匡明(生日1975-10-02)                   |</span><br><span class="line">| 王丽(生日1976-01-23)                   |</span><br><span class="line">| 李军(生日1976-02-20)                   |</span><br><span class="line">| 王芳(生日1975-02-10)                   |</span><br><span class="line">| 陆军(生日1974-06-03)                   |</span><br><span class="line">| 王尼玛(生日1976-02-20)                 |</span><br><span class="line">| 张全蛋(生日1975-02-10)                 |</span><br><span class="line">| 赵铁柱(生日1974-06-03)                 |</span><br><span class="line">| brook(生日1995-01-01)                  |</span><br><span class="line">+<span class="comment">----------------------------------------+</span></span><br></pre></td></tr></table></figure>

<ul>
<li>去除空格 RTrim(),LTrim()去除左边的空格，Trim()去除空格</li>
<li>使用别名</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">concat</span>(<span class="keyword">name</span>,<span class="string">'('</span>,<span class="string">"生日"</span>,birthday,<span class="string">')'</span>) <span class="keyword">as</span> name_birth <span class="keyword">from</span> student;</span><br><span class="line">+<span class="comment">-----------------------------+</span></span><br><span class="line">| name_birth                  |</span><br><span class="line">+<span class="comment">-----------------------------+</span></span><br><span class="line">| 曾华(生日1977-09-01)        |</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<ul>
<li>执行算数计算</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--建设有字段数量和单价格，打出总价</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">id</span> ,quality,price,</span><br><span class="line">qualitu * price <span class="keyword">as</span> totalPrice</span><br><span class="line"><span class="keyword">from</span> orderitems</span><br><span class="line"><span class="keyword">where</span> nume=<span class="number">20000</span>;</span><br></pre></td></tr></table></figure>

<h3 id="数据汇总"><a href="#数据汇总" class="headerlink" title="数据汇总"></a>数据汇总</h3><p>我们经常需要汇总数据而不用把它们实际检索出来,为此MySQL提供了专门的函数。使用这些函数,MySQL查询可用于检索数据,以便分析和报表生成。</p>
<h4 id="聚集函数"><a href="#聚集函数" class="headerlink" title="聚集函数"></a>聚集函数</h4><table>
<thead>
<tr>
<th>函数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>AVG()</td>
<td>返回某列的平均值</td>
</tr>
<tr>
<td>COUNT()</td>
<td>返回莫列的行数</td>
</tr>
<tr>
<td>MAX()</td>
<td>返回某列的最大值</td>
</tr>
<tr>
<td>MIN()</td>
<td>返回某列的最小值</td>
</tr>
<tr>
<td>SUM()</td>
<td>返回某列值之和</td>
</tr>
</tbody></table>
<ul>
<li>AVG():AVG() 可用来返回所有列的平均值,也可以用来返回特定列或行的平均值。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--返回特定列平均</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">avg</span>(degree) <span class="keyword">from</span> score;</span><br><span class="line"><span class="comment">--返回特定课程平均</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">avg</span>(degree) <span class="keyword">from</span> score <span class="keyword">where</span> s_no = <span class="number">101</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>count()：计数，表中行数或符合特定条件的行数。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">from</span> score;</span><br></pre></td></tr></table></figure>

<ul>
<li>sum</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--计算总和，例子</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">sum</span>(item_price*quantity) <span class="keyword">as</span> total_price <span class="keyword">from</span> oedereditems</span><br><span class="line"><span class="keyword">where</span> order_num = <span class="number">20000</span>;</span><br><span class="line"><span class="comment">--使用 AVG() 函数返回特定供应商提供的产品的平均价格。</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">avg</span>(<span class="keyword">distinct</span> prod_rice) <span class="keyword">as</span> avg_price <span class="keyword">from</span> products</span><br><span class="line"><span class="keyword">where</span> vend_id = <span class="number">1003</span>;</span><br></pre></td></tr></table></figure>

<h3 id="分组数据"><a href="#分组数据" class="headerlink" title="分组数据"></a>分组数据</h3><p>如何分组数据,以便能汇总表内容的子集。这涉及两个<br>新 SELECT 语句子句,分别是 GROUP BY 子句和HAVING 子句。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--特定供应商提供的产品数量</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">as</span> num_prods</span><br><span class="line"><span class="keyword">from</span> products</span><br><span class="line"><span class="keyword">where</span> vend_id = <span class="number">1003</span>;</span><br><span class="line"><span class="comment">--列出全部供应商呢？ROUP BY 子句指示MySQL按 vend_id 排序并分组数据。这导致对每个 vend_id 而不是整个表计算 num_prods 一次。</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">as</span> num_prods</span><br><span class="line"><span class="keyword">from</span> products</span><br><span class="line"><span class="keyword">where</span> <span class="keyword">group</span> <span class="keyword">by</span> vend_id;</span><br></pre></td></tr></table></figure>

<p>GROUP BY 子句必须出现在 WHERE 子句之后, ORDER BY 子句之前。</p>
<h4 id="过滤分组"><a href="#过滤分组" class="headerlink" title="过滤分组"></a>过滤分组</h4><p>因为 WHERE 过滤指定的是行而不是分组，MySQL为此目的提供了另外的子句,那就是 HAVING 子句。<strong>HAVING 非常类似于 WHERE</strong> 。事实上,目前为止所学过的所有类型的 WHERE 子句都可以用 HAVING 来替代。里有另一种理解方法, <strong>WHERE 在数据分组前进行过滤, HAVING 在数据分组后进行过滤。</strong>这是一个重要的区别, WHERE 排除的行不包括在分组中。这可能会改变计算值,从而影响 HAVING 子句中基于这些值过滤掉的分组。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--列出两个含以上，价格10以上的产品的供应商</span></span><br><span class="line"><span class="keyword">select</span> vend_id,<span class="keyword">count</span>(*) <span class="keyword">as</span> num_products</span><br><span class="line"><span class="keyword">from</span> products</span><br><span class="line"><span class="keyword">where</span> prod_price&gt;=<span class="number">10</span></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> vend_id</span><br><span class="line"><span class="keyword">having</span> <span class="keyword">count</span>(*) &gt;=<span class="number">2</span>;</span><br></pre></td></tr></table></figure>

<h3 id="分组计算平均成绩"><a href="#分组计算平均成绩" class="headerlink" title="分组计算平均成绩"></a>分组计算平均成绩</h3><p><strong>查询每门课的平均成绩。</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- AVG: 平均值</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">AVG</span>(degree) <span class="keyword">FROM</span> score <span class="keyword">WHERE</span> c_no = <span class="string">'3-105'</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">AVG</span>(degree) <span class="keyword">FROM</span> score <span class="keyword">WHERE</span> c_no = <span class="string">'3-245'</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">AVG</span>(degree) <span class="keyword">FROM</span> score <span class="keyword">WHERE</span> c_no = <span class="string">'6-166'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- GROUP BY: 分组查询</span></span><br><span class="line"><span class="keyword">SELECT</span> c_no, <span class="keyword">AVG</span>(degree) <span class="keyword">FROM</span> score <span class="keyword">GROUP</span> <span class="keyword">BY</span> c_no;</span><br></pre></td></tr></table></figure>

<h3 id="分组条件与模糊查询"><a href="#分组条件与模糊查询" class="headerlink" title="分组条件与模糊查询"></a>分组条件与模糊查询</h3><p><strong>查询 score 表中至少有 2 名学生选修，并以 3 开头的课程的平均分数。</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> score;</span><br><span class="line"><span class="comment">-- c_no 课程编号</span></span><br><span class="line">+<span class="comment">------+-------+--------+</span></span><br><span class="line">| s_no | c_no  | degree |</span><br><span class="line">+<span class="comment">------+-------+--------+</span></span><br><span class="line">| 103  | 3-105 |     92 |</span><br><span class="line">| 103  | 3-245 |     86 |</span><br><span class="line">| 103  | 6-166 |     85 |</span><br><span class="line">| 105  | 3-105 |     88 |</span><br><span class="line">| 105  | 3-245 |     75 |</span><br><span class="line">| 105  | 6-166 |     79 |</span><br><span class="line">| 109  | 3-105 |     76 |</span><br><span class="line">| 109  | 3-245 |     68 |</span><br><span class="line">| 109  | 6-166 |     81 |</span><br><span class="line">+<span class="comment">------+-------+--------+</span></span><br></pre></td></tr></table></figure>

<p>分析表发现，至少有 2 名学生选修的课程是 <code>3-105</code> 、<code>3-245</code> 、<code>6-166</code> ，以 3 开头的课程是 <code>3-105</code> 、<code>3-245</code> 。也就是说，我们要查询所有 <code>3-105</code> 和 <code>3-245</code> 的 <code>degree</code> 平均分。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 首先把 c_no, AVG(degree) 通过分组查询出来</span></span><br><span class="line"><span class="keyword">SELECT</span> c_no, <span class="keyword">AVG</span>(degree) <span class="keyword">FROM</span> score <span class="keyword">GROUP</span> <span class="keyword">BY</span> c_no</span><br><span class="line">+<span class="comment">-------+-------------+</span></span><br><span class="line">| c_no  | <span class="keyword">AVG</span>(degree) |</span><br><span class="line">+<span class="comment">-------+-------------+</span></span><br><span class="line">| <span class="number">3</span><span class="number">-105</span> |     <span class="number">85.3333</span> |</span><br><span class="line">| <span class="number">3</span><span class="number">-245</span> |     <span class="number">76.3333</span> |</span><br><span class="line">| <span class="number">6</span><span class="number">-166</span> |     <span class="number">81.6667</span> |</span><br><span class="line">+<span class="comment">-------+-------------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 再查询出至少有 2 名学生选修的课程</span></span><br><span class="line"><span class="comment">-- HAVING: 表示持有</span></span><br><span class="line"><span class="keyword">HAVING</span> <span class="keyword">COUNT</span>(c_no) &gt;= <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 并且是以 3 开头的课程</span></span><br><span class="line"><span class="comment">-- LIKE 表示模糊查询，"%" 是一个通配符，匹配 "3" 后面的任意字符。</span></span><br><span class="line"><span class="keyword">AND</span> c_no <span class="keyword">LIKE</span> <span class="string">'3%'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 把前面的SQL语句拼接起来，</span></span><br><span class="line"><span class="comment">-- 后面加上一个 COUNT(*)，表示将每个分组的个数也查询出来。</span></span><br><span class="line"><span class="keyword">SELECT</span> c_no, <span class="keyword">AVG</span>(degree), <span class="keyword">COUNT</span>(*) <span class="keyword">FROM</span> score <span class="keyword">GROUP</span> <span class="keyword">BY</span> c_no</span><br><span class="line"><span class="keyword">HAVING</span> <span class="keyword">COUNT</span>(c_no) &gt;= <span class="number">2</span> </span><br><span class="line"><span class="keyword">AND</span> c_no <span class="keyword">LIKE</span> <span class="string">'3%'</span>;</span><br><span class="line">+<span class="comment">-------+-------------+----------+</span></span><br><span class="line">| c_no  | AVG(degree) | COUNT(*) |</span><br><span class="line">+<span class="comment">-------+-------------+----------+</span></span><br><span class="line">| 3-105 |     85.3333 |        3 |</span><br><span class="line">| 3-245 |     76.3333 |        3 |</span><br><span class="line">+<span class="comment">-------+-------------+----------+</span></span><br></pre></td></tr></table></figure>

<h3 id="多表查询-1"><a href="#多表查询-1" class="headerlink" title="多表查询 - 1"></a>多表查询 - 1</h3><p><strong>查询所有学生的 name，以及该学生在 score 表中对应的 c_no 和 degree 。</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">no</span>, <span class="keyword">name</span> <span class="keyword">FROM</span> student;</span><br><span class="line">+<span class="comment">-----+-----------+</span></span><br><span class="line">| no  | name      |</span><br><span class="line">+<span class="comment">-----+-----------+</span></span><br><span class="line">| 101 | 曾华      |</span><br><span class="line">| 102 | 匡明      |</span><br><span class="line">| 103 | 王丽      |</span><br><span class="line">| 104 | 李军      |</span><br><span class="line">| 105 | 王芳      |</span><br><span class="line">| 106 | 陆军      |</span><br><span class="line">| 107 | 王尼玛    |</span><br><span class="line">| 108 | 张全蛋    |</span><br><span class="line">| 109 | 赵铁柱    |</span><br><span class="line">+<span class="comment">-----+-----------+</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> s_no, c_no, degree <span class="keyword">FROM</span> score;</span><br><span class="line">+<span class="comment">------+-------+--------+</span></span><br><span class="line">| s_no | c_no  | degree |</span><br><span class="line">+<span class="comment">------+-------+--------+</span></span><br><span class="line">| 103  | 3-105 |     92 |</span><br><span class="line">| 103  | 3-245 |     86 |</span><br><span class="line">| 103  | 6-166 |     85 |</span><br><span class="line">| 105  | 3-105 |     88 |</span><br><span class="line">| 105  | 3-245 |     75 |</span><br><span class="line">| 105  | 6-166 |     79 |</span><br><span class="line">| 109  | 3-105 |     76 |</span><br><span class="line">| 109  | 3-245 |     68 |</span><br><span class="line">| 109  | 6-166 |     81 |</span><br><span class="line">+<span class="comment">------+-------+--------+</span></span><br></pre></td></tr></table></figure>

<p>通过分析可以发现，只要把 <code>score</code> 表中的 <code>s_no</code> 字段值替换成 <code>student</code> 表中对应的 <code>name</code> 字段值就可以了，如何做呢？</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- FROM...: 表示从 student, score 表中查询</span></span><br><span class="line"><span class="comment">-- WHERE 的条件表示为，只有在 student.no 和 score.s_no 相等时才显示出来。</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">name</span>, c_no, degree <span class="keyword">FROM</span> student, score </span><br><span class="line"><span class="keyword">WHERE</span> student.no = score.s_no;</span><br><span class="line">+<span class="comment">-----------+-------+--------+</span></span><br><span class="line">| name      | c_no  | degree |</span><br><span class="line">+<span class="comment">-----------+-------+--------+</span></span><br><span class="line">| 王丽      | 3-105 |     92 |</span><br><span class="line">| 王丽      | 3-245 |     86 |</span><br><span class="line">| 王丽      | 6-166 |     85 |</span><br><span class="line">| 王芳      | 3-105 |     88 |</span><br><span class="line">| 王芳      | 3-245 |     75 |</span><br><span class="line">| 王芳      | 6-166 |     79 |</span><br><span class="line">| 赵铁柱    | 3-105 |     76 |</span><br><span class="line">| 赵铁柱    | 3-245 |     68 |</span><br><span class="line">| 赵铁柱    | 6-166 |     81 |</span><br><span class="line">+<span class="comment">-----------+-------+--------+</span></span><br></pre></td></tr></table></figure>

<h3 id="多表查询-2"><a href="#多表查询-2" class="headerlink" title="多表查询 - 2"></a>多表查询 - 2</h3><p><strong>查询所有学生的 no 、课程名称 ( course 表中的 name ) 和成绩 ( score 表中的 degree ) 列。</strong></p>
<p>只有 <code>score</code> 关联学生的 <code>no</code> ，因此只要查询 <code>score</code> 表，就能找出所有和学生相关的 <code>no</code> 和 <code>degree</code> ：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> s_no, c_no, degree <span class="keyword">FROM</span> score;</span><br><span class="line">+<span class="comment">------+-------+--------+</span></span><br><span class="line">| s_no | c_no  | degree |</span><br><span class="line">+<span class="comment">------+-------+--------+</span></span><br><span class="line">| 103  | 3-105 |     92 |</span><br><span class="line">| 103  | 3-245 |     86 |</span><br><span class="line">| 103  | 6-166 |     85 |</span><br><span class="line">| 105  | 3-105 |     88 |</span><br><span class="line">| 105  | 3-245 |     75 |</span><br><span class="line">| 105  | 6-166 |     79 |</span><br><span class="line">| 109  | 3-105 |     76 |</span><br><span class="line">| 109  | 3-245 |     68 |</span><br><span class="line">| 109  | 6-166 |     81 |</span><br><span class="line">+<span class="comment">------+-------+--------+</span></span><br></pre></td></tr></table></figure>

<p>然后查询 <code>course</code> 表：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+<span class="comment">-------+-----------------+</span></span><br><span class="line">| no    | name            |</span><br><span class="line">+<span class="comment">-------+-----------------+</span></span><br><span class="line">| 3-105 | 计算机导论      |</span><br><span class="line">| 3-245 | 操作系统        |</span><br><span class="line">| 6-166 | 数字电路        |</span><br><span class="line">| 9-888 | 高等数学        |</span><br><span class="line">+<span class="comment">-------+-----------------+</span></span><br></pre></td></tr></table></figure>

<p>只要把 <code>score</code> 表中的 <code>c_no</code> 替换成 <code>course</code> 表中对应的 <code>name</code> 字段值就可以了。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 增加一个查询字段 name，分别从 score、course 这两个表中查询。</span></span><br><span class="line"><span class="comment">-- as 表示取一个该字段的别名。</span></span><br><span class="line"><span class="keyword">SELECT</span> s_no, <span class="keyword">name</span> <span class="keyword">as</span> c_name, degree <span class="keyword">FROM</span> score, course</span><br><span class="line"><span class="keyword">WHERE</span> score.c_no = course.no;</span><br><span class="line">+<span class="comment">------+-----------------+--------+</span></span><br><span class="line">| s_no | c_name          | degree |</span><br><span class="line">+<span class="comment">------+-----------------+--------+</span></span><br><span class="line">| 103  | 计算机导论      |     92 |</span><br><span class="line">| 105  | 计算机导论      |     88 |</span><br><span class="line">| 109  | 计算机导论      |     76 |</span><br><span class="line">| 103  | 操作系统        |     86 |</span><br><span class="line">| 105  | 操作系统        |     75 |</span><br><span class="line">| 109  | 操作系统        |     68 |</span><br><span class="line">| 103  | 数字电路        |     85 |</span><br><span class="line">| 105  | 数字电路        |     79 |</span><br><span class="line">| 109  | 数字电路        |     81 |</span><br><span class="line">+<span class="comment">------+-----------------+--------+</span></span><br></pre></td></tr></table></figure>

<h3 id="三表关联查询"><a href="#三表关联查询" class="headerlink" title="三表关联查询"></a>三表关联查询</h3><p><strong>查询所有学生的 name 、课程名 ( course 表中的 name ) 和 degree 。</strong></p>
<p>只有 <code>score</code> 表中关联学生的学号和课堂号，我们只要围绕着 <code>score</code> 这张表查询就好了。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> score;</span><br><span class="line">+<span class="comment">------+-------+--------+</span></span><br><span class="line">| s_no | c_no  | degree |</span><br><span class="line">+<span class="comment">------+-------+--------+</span></span><br><span class="line">| 103  | 3-105 |     92 |</span><br><span class="line">| 103  | 3-245 |     86 |</span><br><span class="line">| 103  | 6-166 |     85 |</span><br><span class="line">| 105  | 3-105 |     88 |</span><br><span class="line">| 105  | 3-245 |     75 |</span><br><span class="line">| 105  | 6-166 |     79 |</span><br><span class="line">| 109  | 3-105 |     76 |</span><br><span class="line">| 109  | 3-245 |     68 |</span><br><span class="line">| 109  | 6-166 |     81 |</span><br><span class="line">+<span class="comment">------+-------+--------+</span></span><br></pre></td></tr></table></figure>

<p>只要把 <code>s_no</code> 和 <code>c_no</code> 替换成 <code>student</code> 和 <code>srouse</code> 表中对应的 <code>name</code> 字段值就好了。</p>
<p>首先把 <code>s_no</code> 替换成 <code>student</code> 表中的 <code>name</code> 字段：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">name</span>, c_no, degree <span class="keyword">FROM</span> student, score <span class="keyword">WHERE</span> student.no = score.s_no;</span><br><span class="line">+<span class="comment">-----------+-------+--------+</span></span><br><span class="line">| name      | c_no  | degree |</span><br><span class="line">+<span class="comment">-----------+-------+--------+</span></span><br><span class="line">| 王丽      | 3-105 |     92 |</span><br><span class="line">| 王丽      | 3-245 |     86 |</span><br><span class="line">| 王丽      | 6-166 |     85 |</span><br><span class="line">| 王芳      | 3-105 |     88 |</span><br><span class="line">| 王芳      | 3-245 |     75 |</span><br><span class="line">| 王芳      | 6-166 |     79 |</span><br><span class="line">| 赵铁柱    | 3-105 |     76 |</span><br><span class="line">| 赵铁柱    | 3-245 |     68 |</span><br><span class="line">| 赵铁柱    | 6-166 |     81 |</span><br><span class="line">+<span class="comment">-----------+-------+--------+</span></span><br></pre></td></tr></table></figure>

<p>再把 <code>c_no</code> 替换成 <code>course</code> 表中的 <code>name</code> 字段：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 课程表</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">no</span>, <span class="keyword">name</span> <span class="keyword">FROM</span> course;</span><br><span class="line">+<span class="comment">-------+-----------------+</span></span><br><span class="line">| no    | name            |</span><br><span class="line">+<span class="comment">-------+-----------------+</span></span><br><span class="line">| 3-105 | 计算机导论      |</span><br><span class="line">| 3-245 | 操作系统        |</span><br><span class="line">| 6-166 | 数字电路        |</span><br><span class="line">| 9-888 | 高等数学        |</span><br><span class="line">+<span class="comment">-------+-----------------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 由于字段名存在重复，使用 "表名.字段名 as 别名" 代替。</span></span><br><span class="line"><span class="keyword">SELECT</span> student.name <span class="keyword">as</span> s_name, course.name <span class="keyword">as</span> c_name, degree </span><br><span class="line"><span class="keyword">FROM</span> student, score, course</span><br><span class="line"><span class="keyword">WHERE</span> student.NO = score.s_no</span><br><span class="line"><span class="keyword">AND</span> score.c_no = course.no;</span><br></pre></td></tr></table></figure>

<h3 id="子查询加分组求平均分"><a href="#子查询加分组求平均分" class="headerlink" title="子查询加分组求平均分"></a>子查询加分组求平均分</h3><p><strong>查询 95031 班学生每门课程的平均成绩。</strong></p>
<p>在 <code>score</code> 表中根据 <code>student</code> 表的学生编号筛选出学生的课堂号和成绩：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- IN (..): 将筛选出的学生号当做 s_no 的条件查询</span></span><br><span class="line"><span class="keyword">SELECT</span> s_no, c_no, degree <span class="keyword">FROM</span> score</span><br><span class="line"><span class="keyword">WHERE</span> s_no <span class="keyword">IN</span> (<span class="keyword">SELECT</span> <span class="keyword">no</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> <span class="keyword">class</span> = <span class="string">'95031'</span>);</span><br><span class="line">+<span class="comment">------+-------+--------+</span></span><br><span class="line">| s_no | c_no  | degree |</span><br><span class="line">+<span class="comment">------+-------+--------+</span></span><br><span class="line">| 105  | 3-105 |     88 |</span><br><span class="line">| 105  | 3-245 |     75 |</span><br><span class="line">| 105  | 6-166 |     79 |</span><br><span class="line">| 109  | 3-105 |     76 |</span><br><span class="line">| 109  | 3-245 |     68 |</span><br><span class="line">| 109  | 6-166 |     81 |</span><br><span class="line">+<span class="comment">------+-------+--------+</span></span><br></pre></td></tr></table></figure>

<p>这时只要将 <code>c_no</code> 分组一下就能得出 <code>95031</code> 班学生每门课的平均成绩：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> c_no, <span class="keyword">AVG</span>(degree) <span class="keyword">FROM</span> score</span><br><span class="line"><span class="keyword">WHERE</span> s_no <span class="keyword">IN</span> (<span class="keyword">SELECT</span> <span class="keyword">no</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> <span class="keyword">class</span> = <span class="string">'95031'</span>)</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> c_no;</span><br><span class="line">+<span class="comment">-------+-------------+</span></span><br><span class="line">| c_no  | AVG(degree) |</span><br><span class="line">+<span class="comment">-------+-------------+</span></span><br><span class="line">| 3-105 |     82.0000 |</span><br><span class="line">| 3-245 |     71.5000 |</span><br><span class="line">| 6-166 |     80.0000 |</span><br><span class="line">+<span class="comment">-------+-------------+</span></span><br></pre></td></tr></table></figure>

<h3 id="子查询-1"><a href="#子查询-1" class="headerlink" title="子查询 - 1"></a>子查询 - 1</h3><p><strong>查询在 3-105 课程中，所有成绩高于 109 号同学的记录。</strong></p>
<p>首先筛选出课堂号为 <code>3-105</code> ，在找出所有成绩高于 <code>109</code> 号同学的的行。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> score </span><br><span class="line"><span class="keyword">WHERE</span> c_no = <span class="string">'3-105'</span></span><br><span class="line"><span class="keyword">AND</span> degree &gt; (<span class="keyword">SELECT</span> degree <span class="keyword">FROM</span> score <span class="keyword">WHERE</span> s_no = <span class="string">'109'</span> <span class="keyword">AND</span> c_no = <span class="string">'3-105'</span>);</span><br></pre></td></tr></table></figure>

<h3 id="子查询-2"><a href="#子查询-2" class="headerlink" title="子查询 - 2"></a>子查询 - 2</h3><p><strong>查询所有成绩高于 109 号同学的 3-105 课程成绩记录。</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 不限制课程号，只要成绩大于109号同学的3-105课程成绩就可以。</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> score</span><br><span class="line"><span class="keyword">WHERE</span> degree &gt; (<span class="keyword">SELECT</span> degree <span class="keyword">FROM</span> score <span class="keyword">WHERE</span> s_no = <span class="string">'109'</span> <span class="keyword">AND</span> c_no = <span class="string">'3-105'</span>);</span><br></pre></td></tr></table></figure>

<h3 id="YEAR-函数与带-IN-关键字查询"><a href="#YEAR-函数与带-IN-关键字查询" class="headerlink" title="YEAR 函数与带 IN 关键字查询"></a>YEAR 函数与带 IN 关键字查询</h3><p><strong>查询所有和 101 、108 号学生同年出生的 no 、name 、birthday 列。</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- YEAR(..): 取出日期中的年份</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">no</span>, <span class="keyword">name</span>, birthday <span class="keyword">FROM</span> student</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">YEAR</span>(birthday) <span class="keyword">IN</span> (<span class="keyword">SELECT</span> <span class="keyword">YEAR</span>(birthday) <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> <span class="keyword">no</span> <span class="keyword">IN</span> (<span class="number">101</span>, <span class="number">108</span>));</span><br></pre></td></tr></table></figure>

<h3 id="多层嵌套子查询"><a href="#多层嵌套子查询" class="headerlink" title="多层嵌套子查询"></a>多层嵌套子查询</h3><p><strong>查询 ‘张旭’ 教师任课的学生成绩表。</strong></p>
<p>首先找到教师编号：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">NO</span> <span class="keyword">FROM</span> teacher <span class="keyword">WHERE</span> <span class="keyword">NAME</span> = <span class="string">'张旭'</span></span><br></pre></td></tr></table></figure>

<p>通过 <code>sourse</code> 表找到该教师课程号：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">NO</span> <span class="keyword">FROM</span> course <span class="keyword">WHERE</span> t_no = ( <span class="keyword">SELECT</span> <span class="keyword">NO</span> <span class="keyword">FROM</span> teacher <span class="keyword">WHERE</span> <span class="keyword">NAME</span> = <span class="string">'张旭'</span> );</span><br></pre></td></tr></table></figure>

<p>通过筛选出的课程号查询成绩表：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> score <span class="keyword">WHERE</span> c_no = (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="keyword">no</span> <span class="keyword">FROM</span> course <span class="keyword">WHERE</span> t_no = ( </span><br><span class="line">        <span class="keyword">SELECT</span> <span class="keyword">no</span> <span class="keyword">FROM</span> teacher <span class="keyword">WHERE</span> <span class="keyword">NAME</span> = <span class="string">'张旭'</span> </span><br><span class="line">    )</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="多表查询"><a href="#多表查询" class="headerlink" title="多表查询"></a>多表查询</h3><p><strong>查询某选修课程多于5个同学的教师姓名。</strong></p>
<p>首先在 <code>teacher</code> 表中，根据 <code>no</code> 字段来判断该教师的同一门课程是否有至少5名学员选修：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询 teacher 表</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">no</span>, <span class="keyword">name</span> <span class="keyword">FROM</span> teacher;</span><br><span class="line">+<span class="comment">-----+--------+</span></span><br><span class="line">| no  | name   |</span><br><span class="line">+<span class="comment">-----+--------+</span></span><br><span class="line">| 804 | 李诚   |</span><br><span class="line">| 825 | 王萍   |</span><br><span class="line">| 831 | 刘冰   |</span><br><span class="line">| 856 | 张旭   |</span><br><span class="line">+<span class="comment">-----+--------+</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">name</span> <span class="keyword">FROM</span> teacher <span class="keyword">WHERE</span> <span class="keyword">no</span> <span class="keyword">IN</span> (</span><br><span class="line">    <span class="comment">-- 在这里找到对应的条件</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>查看和教师编号有有关的表的信息：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> course;</span><br><span class="line"><span class="comment">-- t_no: 教师编号</span></span><br><span class="line">+<span class="comment">-------+-----------------+------+</span></span><br><span class="line">| no    | name            | t_no |</span><br><span class="line">+<span class="comment">-------+-----------------+------+</span></span><br><span class="line">| 3-105 | 计算机导论      | 825  |</span><br><span class="line">| 3-245 | 操作系统        | 804  |</span><br><span class="line">| 6-166 | 数字电路        | 856  |</span><br><span class="line">| 9-888 | 高等数学        | 831  |</span><br><span class="line">+<span class="comment">-------+-----------------+------+</span></span><br></pre></td></tr></table></figure>

<p>我们已经找到和教师编号有关的字段就在 <code>course</code> 表中，但是还无法知道哪门课程至少有5名学生选修，所以还需要根据 <code>score</code>表来查询：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 在此之前向 score 插入一些数据，以便丰富查询条件。</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> score <span class="keyword">VALUES</span> (<span class="string">'101'</span>, <span class="string">'3-105'</span>, <span class="string">'90'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> score <span class="keyword">VALUES</span> (<span class="string">'102'</span>, <span class="string">'3-105'</span>, <span class="string">'91'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> score <span class="keyword">VALUES</span> (<span class="string">'104'</span>, <span class="string">'3-105'</span>, <span class="string">'89'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询 score 表</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> score;</span><br><span class="line">+<span class="comment">------+-------+--------+</span></span><br><span class="line">| s_no | c_no  | degree |</span><br><span class="line">+<span class="comment">------+-------+--------+</span></span><br><span class="line">| 101  | 3-105 |     90 |</span><br><span class="line">| 102  | 3-105 |     91 |</span><br><span class="line">| 103  | 3-105 |     92 |</span><br><span class="line">| 103  | 3-245 |     86 |</span><br><span class="line">| 103  | 6-166 |     85 |</span><br><span class="line">| 104  | 3-105 |     89 |</span><br><span class="line">| 105  | 3-105 |     88 |</span><br><span class="line">| 105  | 3-245 |     75 |</span><br><span class="line">| 105  | 6-166 |     79 |</span><br><span class="line">| 109  | 3-105 |     76 |</span><br><span class="line">| 109  | 3-245 |     68 |</span><br><span class="line">| 109  | 6-166 |     81 |</span><br><span class="line">+<span class="comment">------+-------+--------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 在 score 表中将 c_no 作为分组，并且限制 c_no 持有至少 5 条数据。 group by 和having配合使用实现先分组在执行having后的条件。having后接函数条件。</span></span><br><span class="line"><span class="keyword">SELECT</span> c_no <span class="keyword">FROM</span> score <span class="keyword">GROUP</span> <span class="keyword">BY</span> c_no <span class="keyword">HAVING</span> <span class="keyword">COUNT</span>(*) &gt; <span class="number">5</span>;</span><br><span class="line">+<span class="comment">-------+</span></span><br><span class="line">| c_no  |</span><br><span class="line">+<span class="comment">-------+</span></span><br><span class="line">| 3-105 |</span><br><span class="line">+<span class="comment">-------+</span></span><br></pre></td></tr></table></figure>

<p>根据筛选出来的课程号，找出在某课程中，拥有至少5名学员的教师编号：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> t_no <span class="keyword">FROM</span> course <span class="keyword">WHERE</span> <span class="keyword">no</span> <span class="keyword">IN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> c_no <span class="keyword">FROM</span> score <span class="keyword">GROUP</span> <span class="keyword">BY</span> c_no <span class="keyword">HAVING</span> <span class="keyword">COUNT</span>(*) &gt; <span class="number">5</span></span><br><span class="line">);</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">| t_no |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">| 825  |</span><br><span class="line">+<span class="comment">------+</span></span><br></pre></td></tr></table></figure>

<p>在 <code>teacher</code> 表中，根据筛选出来的教师编号找到教师姓名：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">name</span> <span class="keyword">FROM</span> teacher <span class="keyword">WHERE</span> <span class="keyword">no</span> <span class="keyword">IN</span> (</span><br><span class="line">    <span class="comment">-- 最终条件</span></span><br><span class="line">    <span class="keyword">SELECT</span> t_no <span class="keyword">FROM</span> course <span class="keyword">WHERE</span> <span class="keyword">no</span> <span class="keyword">IN</span> (</span><br><span class="line">        <span class="keyword">SELECT</span> c_no <span class="keyword">FROM</span> score <span class="keyword">GROUP</span> <span class="keyword">BY</span> c_no <span class="keyword">HAVING</span> <span class="keyword">COUNT</span>(*) &gt; <span class="number">5</span></span><br><span class="line">    )</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="子查询-3"><a href="#子查询-3" class="headerlink" title="子查询 - 3"></a>子查询 - 3</h3><p><strong>查询 “计算机系” 课程的成绩表。</strong></p>
<p>思路是，先找出 <code>course</code> 表中所有 <code>计算机系</code> 课程的编号，然后根据这个编号查询 <code>score</code> 表。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 通过 teacher 表查询所有 `计算机系` 的教师编号</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">no</span>, <span class="keyword">name</span>, department <span class="keyword">FROM</span> teacher <span class="keyword">WHERE</span> department = <span class="string">'计算机系'</span></span><br><span class="line">+<span class="comment">-----+--------+--------------+</span></span><br><span class="line">| <span class="keyword">no</span>  | <span class="keyword">name</span>   | department   |</span><br><span class="line">+<span class="comment">-----+--------+--------------+</span></span><br><span class="line">| <span class="number">804</span> | 李诚   | 计算机系     |</span><br><span class="line">| <span class="number">825</span> | 王萍   | 计算机系     |</span><br><span class="line">+<span class="comment">-----+--------+--------------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 通过 course 表查询该教师的课程编号</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">no</span> <span class="keyword">FROM</span> course <span class="keyword">WHERE</span> t_no <span class="keyword">IN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="keyword">no</span> <span class="keyword">FROM</span> teacher <span class="keyword">WHERE</span> department = <span class="string">'计算机系'</span></span><br><span class="line">);</span><br><span class="line">+<span class="comment">-------+</span></span><br><span class="line">| no    |</span><br><span class="line">+<span class="comment">-------+</span></span><br><span class="line">| 3-245 |</span><br><span class="line">| 3-105 |</span><br><span class="line">+<span class="comment">-------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 根据筛选出来的课程号查询成绩表</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> score <span class="keyword">WHERE</span> c_no <span class="keyword">IN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="keyword">no</span> <span class="keyword">FROM</span> course <span class="keyword">WHERE</span> t_no <span class="keyword">IN</span> (</span><br><span class="line">        <span class="keyword">SELECT</span> <span class="keyword">no</span> <span class="keyword">FROM</span> teacher <span class="keyword">WHERE</span> department = <span class="string">'计算机系'</span></span><br><span class="line">    )</span><br><span class="line">);</span><br><span class="line">+<span class="comment">------+-------+--------+</span></span><br><span class="line">| s_no | c_no  | degree |</span><br><span class="line">+<span class="comment">------+-------+--------+</span></span><br><span class="line">| 103  | 3-245 |     86 |</span><br><span class="line">| 105  | 3-245 |     75 |</span><br><span class="line">| 109  | 3-245 |     68 |</span><br><span class="line">| 101  | 3-105 |     90 |</span><br><span class="line">| 102  | 3-105 |     91 |</span><br><span class="line">| 103  | 3-105 |     92 |</span><br><span class="line">| 104  | 3-105 |     89 |</span><br><span class="line">| 105  | 3-105 |     88 |</span><br><span class="line">| 109  | 3-105 |     76 |</span><br><span class="line">+<span class="comment">------+-------+--------+</span></span><br></pre></td></tr></table></figure>

<h3 id="UNION-和-NOTIN-的使用"><a href="#UNION-和-NOTIN-的使用" class="headerlink" title="UNION 和 NOTIN 的使用"></a>UNION 和 NOTIN 的使用</h3><p><strong>查询 计算机系 与 电子工程系 中的不同职称的教师。</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- NOT: 代表逻辑非</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> teacher <span class="keyword">WHERE</span> department = <span class="string">'计算机系'</span> <span class="keyword">AND</span> profession <span class="keyword">NOT</span> <span class="keyword">IN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> profession <span class="keyword">FROM</span> teacher <span class="keyword">WHERE</span> department = <span class="string">'电子工程系'</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">-- 合并两个集</span></span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> teacher <span class="keyword">WHERE</span> department = <span class="string">'电子工程系'</span> <span class="keyword">AND</span> profession <span class="keyword">NOT</span> <span class="keyword">IN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> profession <span class="keyword">FROM</span> teacher <span class="keyword">WHERE</span> department = <span class="string">'计算机系'</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="ANY-表示至少一个-DESC-降序"><a href="#ANY-表示至少一个-DESC-降序" class="headerlink" title="ANY 表示至少一个 - DESC ( 降序 )"></a>ANY 表示至少一个 - DESC ( 降序 )</h3><p><strong>查询课程 3-105 且成绩 至少 高于 3-245 的 score 表。</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> score <span class="keyword">WHERE</span> c_no = <span class="string">'3-105'</span>;</span><br><span class="line">+<span class="comment">------+-------+--------+</span></span><br><span class="line">| s_no | c_no  | degree |</span><br><span class="line">+<span class="comment">------+-------+--------+</span></span><br><span class="line">| 101  | 3-105 |     90 |</span><br><span class="line">| 102  | 3-105 |     91 |</span><br><span class="line">| 103  | 3-105 |     92 |</span><br><span class="line">| 104  | 3-105 |     89 |</span><br><span class="line">| 105  | 3-105 |     88 |</span><br><span class="line">| 109  | 3-105 |     76 |</span><br><span class="line">+<span class="comment">------+-------+--------+</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> score <span class="keyword">WHERE</span> c_no = <span class="string">'3-245'</span>;</span><br><span class="line">+<span class="comment">------+-------+--------+</span></span><br><span class="line">| s_no | c_no  | degree |</span><br><span class="line">+<span class="comment">------+-------+--------+</span></span><br><span class="line">| 103  | 3-245 |     86 |</span><br><span class="line">| 105  | 3-245 |     75 |</span><br><span class="line">| 109  | 3-245 |     68 |</span><br><span class="line">+<span class="comment">------+-------+--------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- ANY: 符合SQL语句中的任意条件。</span></span><br><span class="line"><span class="comment">-- 也就是说，在 3-105 成绩中，只要有一个大于从 3-245 筛选出来的任意行就符合条件，</span></span><br><span class="line"><span class="comment">-- 最后根据降序查询结果。</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> score <span class="keyword">WHERE</span> c_no = <span class="string">'3-105'</span> <span class="keyword">AND</span> degree &gt; <span class="keyword">ANY</span>(</span><br><span class="line">    <span class="keyword">SELECT</span> degree <span class="keyword">FROM</span> score <span class="keyword">WHERE</span> c_no = <span class="string">'3-245'</span></span><br><span class="line">) <span class="keyword">ORDER</span> <span class="keyword">BY</span> degree <span class="keyword">DESC</span>;</span><br><span class="line">+<span class="comment">------+-------+--------+</span></span><br><span class="line">| s_no | c_no  | degree |</span><br><span class="line">+<span class="comment">------+-------+--------+</span></span><br><span class="line">| 103  | 3-105 |     92 |</span><br><span class="line">| 102  | 3-105 |     91 |</span><br><span class="line">| 101  | 3-105 |     90 |</span><br><span class="line">| 104  | 3-105 |     89 |</span><br><span class="line">| 105  | 3-105 |     88 |</span><br><span class="line">| 109  | 3-105 |     76 |</span><br><span class="line">+<span class="comment">------+-------+--------+</span></span><br></pre></td></tr></table></figure>

<h3 id="表示所有的-ALL"><a href="#表示所有的-ALL" class="headerlink" title="表示所有的 ALL"></a>表示所有的 ALL</h3><p><strong>查询课程 3-105 且成绩高于 3-245 的 score 表。</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 只需对上一道题稍作修改。</span></span><br><span class="line"><span class="comment">-- ALL: 符合SQL语句中的所有条件。</span></span><br><span class="line"><span class="comment">-- 也就是说，在 3-105 每一行成绩中，都要大于从 3-245 筛选出来全部行才算符合条件。</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> score <span class="keyword">WHERE</span> c_no = <span class="string">'3-105'</span> <span class="keyword">AND</span> degree &gt; <span class="keyword">ALL</span>(</span><br><span class="line">    <span class="keyword">SELECT</span> degree <span class="keyword">FROM</span> score <span class="keyword">WHERE</span> c_no = <span class="string">'3-245'</span></span><br><span class="line">);</span><br><span class="line">+<span class="comment">------+-------+--------+</span></span><br><span class="line">| s_no | c_no  | degree |</span><br><span class="line">+<span class="comment">------+-------+--------+</span></span><br><span class="line">| 101  | 3-105 |     90 |</span><br><span class="line">| 102  | 3-105 |     91 |</span><br><span class="line">| 103  | 3-105 |     92 |</span><br><span class="line">| 104  | 3-105 |     89 |</span><br><span class="line">| 105  | 3-105 |     88 |</span><br><span class="line">+<span class="comment">------+-------+--------+</span></span><br></pre></td></tr></table></figure>

<h3 id="别名"><a href="#别名" class="headerlink" title="别名"></a>别名</h3><p><strong>查询所有教师和通许的name,sex,和birthday</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">name</span>,sex,birthday <span class="keyword">from</span> student</span><br><span class="line">    <span class="keyword">union</span></span><br><span class="line">    <span class="keyword">select</span> <span class="keyword">name</span>,sex,birthday <span class="keyword">from</span> teacher;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">name</span> <span class="keyword">as</span> ts_name,sex,birthday <span class="keyword">from</span> student <span class="keyword">union</span> <span class="keyword">select</span> <span class="keyword">name</span>,sex,birthday <span class="keyword">from</span> teacher;</span><br><span class="line">+<span class="comment">-----------+-----+------------+</span></span><br><span class="line">| ts_name   | sex | birthday   |</span><br><span class="line">+<span class="comment">-----------+-----+------------+</span></span><br><span class="line">| 曾华      | 男  | 1977-09-01 |</span><br><span class="line">| 匡明      | 男  | 1975-10-02 |</span><br><span class="line">| 王丽      | 女  | 1976-01-23 |</span><br><span class="line">| 李军      | 男  | 1976-02-20 |</span><br><span class="line">| 王芳      | 女  | 1975-02-10 |</span><br><span class="line">| 陆军      | 男  | 1974-06-03 |</span><br><span class="line">| 王尼玛    | 男  | 1976-02-20 |</span><br><span class="line">| 张全蛋    | 男  | 1975-02-10 |</span><br><span class="line">| 赵铁柱    | 男  | 1974-06-03 |</span><br><span class="line">| brook     | 男  | 1995-01-01 |</span><br><span class="line">| 李诚      | 男  | 1958-12-02 |</span><br><span class="line">| 王萍      | 女  | 1972-05-05 |</span><br><span class="line">| 刘冰      | 女  | 1977-08-14 |</span><br><span class="line">| 张旭      | 男  | 1969-03-12 |</span><br><span class="line">+<span class="comment">-----------+-----+------------+</span></span><br></pre></td></tr></table></figure>

<h3 id="复制表的数据作为条件查询"><a href="#复制表的数据作为条件查询" class="headerlink" title="复制表的数据作为条件查询"></a>复制表的数据作为条件查询</h3><p><strong>查询某课程成绩比该课程平均成绩低的 score 表。</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询平均分</span></span><br><span class="line"><span class="keyword">SELECT</span> c_no, <span class="keyword">AVG</span>(degree) <span class="keyword">FROM</span> score <span class="keyword">GROUP</span> <span class="keyword">BY</span> c_no;</span><br><span class="line">+<span class="comment">-------+-------------+</span></span><br><span class="line">| c_no  | AVG(degree) |</span><br><span class="line">+<span class="comment">-------+-------------+</span></span><br><span class="line">| 3-105 |     87.6667 |</span><br><span class="line">| 3-245 |     76.3333 |</span><br><span class="line">| 6-166 |     81.6667 |</span><br><span class="line">+<span class="comment">-------+-------------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询 score 表</span></span><br><span class="line"><span class="keyword">SELECT</span> degree <span class="keyword">FROM</span> score;</span><br><span class="line">+<span class="comment">--------+</span></span><br><span class="line">| degree |</span><br><span class="line">+<span class="comment">--------+</span></span><br><span class="line">|     90 |</span><br><span class="line">|     91 |</span><br><span class="line">|     92 |</span><br><span class="line">|     86 |</span><br><span class="line">|     85 |</span><br><span class="line">|     89 |</span><br><span class="line">|     88 |</span><br><span class="line">|     75 |</span><br><span class="line">|     79 |</span><br><span class="line">|     76 |</span><br><span class="line">|     68 |</span><br><span class="line">|     81 |</span><br><span class="line">+<span class="comment">--------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 将表 b 作用于表 a 中查询数据,a,b表相当于相同的表，就是起了个别名</span></span><br><span class="line"><span class="comment">-- score a (b): 将表声明为 a (b)，</span></span><br><span class="line"><span class="comment">-- 如此就能用 a.c_no = b.c_no 作为条件执行查询了。</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> score a <span class="keyword">WHERE</span> degree &lt; (</span><br><span class="line">    (<span class="keyword">SELECT</span> <span class="keyword">AVG</span>(degree) <span class="keyword">FROM</span> score b <span class="keyword">WHERE</span> a.c_no = b.c_no)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> score <span class="keyword">as</span> a <span class="keyword">where</span> degree &lt; (<span class="keyword">select</span> <span class="keyword">avg</span>(degree) <span class="keyword">from</span> score <span class="keyword">as</span>  b <span class="keyword">where</span> a.c_no = b.c_no);</span><br><span class="line"></span><br><span class="line">+<span class="comment">------+-------+--------+</span></span><br><span class="line">| s_no | c_no  | degree |</span><br><span class="line">+<span class="comment">------+-------+--------+</span></span><br><span class="line">| 105  | 3-245 |     75 |</span><br><span class="line">| 105  | 6-166 |     79 |</span><br><span class="line">| 109  | 3-105 |     76 |</span><br><span class="line">| 109  | 3-245 |     68 |</span><br><span class="line">| 109  | 6-166 |     81 |</span><br><span class="line">+<span class="comment">------+-------+--------+</span></span><br></pre></td></tr></table></figure>

<h3 id="子查询-4"><a href="#子查询-4" class="headerlink" title="子查询 - 4"></a>子查询 - 4</h3><p><strong>查询所有任课 ( 在 course 表里有课程 ) 教师的 name 和 department</strong> 。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">name</span>, department <span class="keyword">FROM</span> teacher <span class="keyword">WHERE</span> <span class="keyword">no</span> <span class="keyword">IN</span> (<span class="keyword">SELECT</span> t_no <span class="keyword">FROM</span> course);</span><br><span class="line">+<span class="comment">--------+-----------------+</span></span><br><span class="line">| name   | department      |</span><br><span class="line">+<span class="comment">--------+-----------------+</span></span><br><span class="line">| 李诚   | 计算机系        |</span><br><span class="line">| 王萍   | 计算机系        |</span><br><span class="line">| 刘冰   | 电子工程系      |</span><br><span class="line">| 张旭   | 电子工程系      |</span><br><span class="line">+<span class="comment">--------+-----------------+</span></span><br></pre></td></tr></table></figure>

<h3 id="条件加组筛选"><a href="#条件加组筛选" class="headerlink" title="条件加组筛选"></a>条件加组筛选</h3><p><strong>查询 student 表中至少有 2 名男生的 class 。</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查看学生表信息</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> student;</span><br><span class="line">+<span class="comment">-----+-----------+-----+------------+-------+</span></span><br><span class="line">| no  | name      | sex | birthday   | class |</span><br><span class="line">+<span class="comment">-----+-----------+-----+------------+-------+</span></span><br><span class="line">| 101 | 曾华      | 男  | 1977-09-01 | 95033 |</span><br><span class="line">| 102 | 匡明      | 男  | 1975-10-02 | 95031 |</span><br><span class="line">| 103 | 王丽      | 女  | 1976-01-23 | 95033 |</span><br><span class="line">| 104 | 李军      | 男  | 1976-02-20 | 95033 |</span><br><span class="line">| 105 | 王芳      | 女  | 1975-02-10 | 95031 |</span><br><span class="line">| 106 | 陆军      | 男  | 1974-06-03 | 95031 |</span><br><span class="line">| 107 | 王尼玛    | 男  | 1976-02-20 | 95033 |</span><br><span class="line">| 108 | 张全蛋    | 男  | 1975-02-10 | 95031 |</span><br><span class="line">| 109 | 赵铁柱    | 男  | 1974-06-03 | 95031 |</span><br><span class="line">| 110 | 张飞      | 男  | 1974-06-03 | 95038 |</span><br><span class="line">+<span class="comment">-----+-----------+-----+------------+-------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 只查询性别为男，然后按 class 分组，并限制 class 行大于 1。</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">class</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> sex = <span class="string">'男'</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">class</span> <span class="keyword">HAVING</span> <span class="keyword">COUNT</span>(*) &gt; <span class="number">1</span>;</span><br><span class="line">+<span class="comment">-------+</span></span><br><span class="line">| class |</span><br><span class="line">+<span class="comment">-------+</span></span><br><span class="line">| 95033 |</span><br><span class="line">| 95031 |</span><br><span class="line">+<span class="comment">-------+</span></span><br></pre></td></tr></table></figure>

<h3 id="NOTLIKE-模糊查询取反"><a href="#NOTLIKE-模糊查询取反" class="headerlink" title="NOTLIKE 模糊查询取反"></a>NOTLIKE 模糊查询取反</h3><p><strong>查询 student 表中不姓 “王” 的同学记录。</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- NOT: 取反</span></span><br><span class="line"><span class="comment">-- LIKE: 模糊查询</span></span><br><span class="line">mysql&gt; SELECT * FROM student WHERE name NOT LIKE '王%';</span><br><span class="line">+<span class="comment">-----+-----------+-----+------------+-------+</span></span><br><span class="line">| no  | name      | sex | birthday   | class |</span><br><span class="line">+<span class="comment">-----+-----------+-----+------------+-------+</span></span><br><span class="line">| 101 | 曾华      | 男  | 1977-09-01 | 95033 |</span><br><span class="line">| 102 | 匡明      | 男  | 1975-10-02 | 95031 |</span><br><span class="line">| 104 | 李军      | 男  | 1976-02-20 | 95033 |</span><br><span class="line">| 106 | 陆军      | 男  | 1974-06-03 | 95031 |</span><br><span class="line">| 108 | 张全蛋    | 男  | 1975-02-10 | 95031 |</span><br><span class="line">| 109 | 赵铁柱    | 男  | 1974-06-03 | 95031 |</span><br><span class="line">| 110 | 张飞      | 男  | 1974-06-03 | 95038 |</span><br><span class="line">+<span class="comment">-----+-----------+-----+------------+-------+</span></span><br></pre></td></tr></table></figure>

<h3 id="YEAR-与-NOW-函数"><a href="#YEAR-与-NOW-函数" class="headerlink" title="YEAR 与 NOW 函数"></a>YEAR 与 NOW 函数</h3><p><strong>查询 student 表中每个学生的姓名和年龄。</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 使用函数 YEAR(NOW()) 计算出当前年份，减去出生年份后得出年龄。</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">name</span>, <span class="keyword">YEAR</span>(<span class="keyword">NOW</span>()) - <span class="keyword">YEAR</span>(birthday) <span class="keyword">as</span> age <span class="keyword">FROM</span> student;</span><br><span class="line">+<span class="comment">-----------+------+</span></span><br><span class="line">| name      | age  |</span><br><span class="line">+<span class="comment">-----------+------+</span></span><br><span class="line">| 曾华      |   42 |</span><br><span class="line">| 匡明      |   44 |</span><br><span class="line">| 王丽      |   43 |</span><br><span class="line">| 李军      |   43 |</span><br><span class="line">| 王芳      |   44 |</span><br><span class="line">| 陆军      |   45 |</span><br><span class="line">| 王尼玛    |   43 |</span><br><span class="line">| 张全蛋    |   44 |</span><br><span class="line">| 赵铁柱    |   45 |</span><br><span class="line">| 张飞      |   45 |</span><br><span class="line">+<span class="comment">-----------+------+</span></span><br></pre></td></tr></table></figure>

<h3 id="MAX-与-MIN-函数"><a href="#MAX-与-MIN-函数" class="headerlink" title="MAX 与 MIN 函数"></a>MAX 与 MIN 函数</h3><p><strong>查询 student 表中最大和最小的 birthday 值。</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MAX</span>(birthday), <span class="keyword">MIN</span>(birthday) <span class="keyword">FROM</span> student;</span><br><span class="line">+<span class="comment">---------------+---------------+</span></span><br><span class="line">| MAX(birthday) | MIN(birthday) |</span><br><span class="line">+<span class="comment">---------------+---------------+</span></span><br><span class="line">| 1977-09-01    | 1974-06-03    |</span><br><span class="line">+<span class="comment">---------------+---------------+</span></span><br></pre></td></tr></table></figure>

<h3 id="多段排序"><a href="#多段排序" class="headerlink" title="多段排序"></a>多段排序</h3><p><strong>以 class 和 birthday 从大到小的顺序查询 student 表。</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> student <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">class</span> <span class="keyword">DESC</span>, birthday;</span><br><span class="line">+<span class="comment">-----+-----------+-----+------------+-------+</span></span><br><span class="line">| no  | name      | sex | birthday   | class |</span><br><span class="line">+<span class="comment">-----+-----------+-----+------------+-------+</span></span><br><span class="line">| 110 | 张飞      | 男  | 1974-06-03 | 95038 |</span><br><span class="line">| 103 | 王丽      | 女  | 1976-01-23 | 95033 |</span><br><span class="line">| 104 | 李军      | 男  | 1976-02-20 | 95033 |</span><br><span class="line">| 107 | 王尼玛    | 男  | 1976-02-20 | 95033 |</span><br><span class="line">| 101 | 曾华      | 男  | 1977-09-01 | 95033 |</span><br><span class="line">| 106 | 陆军      | 男  | 1974-06-03 | 95031 |</span><br><span class="line">| 109 | 赵铁柱    | 男  | 1974-06-03 | 95031 |</span><br><span class="line">| 105 | 王芳      | 女  | 1975-02-10 | 95031 |</span><br><span class="line">| 108 | 张全蛋    | 男  | 1975-02-10 | 95031 |</span><br><span class="line">| 102 | 匡明      | 男  | 1975-10-02 | 95031 |</span><br><span class="line">+<span class="comment">-----+-----------+-----+------------+-------+</span></span><br></pre></td></tr></table></figure>

<h3 id="子查询-5"><a href="#子查询-5" class="headerlink" title="子查询 - 5"></a>子查询 - 5</h3><p><strong>查询 “男” 教师及其所上的课程。</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> course <span class="keyword">WHERE</span> t_no <span class="keyword">in</span> (<span class="keyword">SELECT</span> <span class="keyword">no</span> <span class="keyword">FROM</span> teacher <span class="keyword">WHERE</span> sex = <span class="string">'男'</span>);</span><br><span class="line">+<span class="comment">-------+--------------+------+</span></span><br><span class="line">| no    | name         | t_no |</span><br><span class="line">+<span class="comment">-------+--------------+------+</span></span><br><span class="line">| 3-245 | 操作系统     | 804  |</span><br><span class="line">| 6-166 | 数字电路     | 856  |</span><br><span class="line">+<span class="comment">-------+--------------+------+</span></span><br></pre></td></tr></table></figure>

<h3 id="MAX-函数与子查询"><a href="#MAX-函数与子查询" class="headerlink" title="MAX 函数与子查询"></a>MAX 函数与子查询</h3><p><strong>查询最高分同学的 score 表。</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 找出最高成绩（该查询只能有一个结果）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MAX</span>(degree) <span class="keyword">FROM</span> score;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 根据上面的条件筛选出所有最高成绩表，</span></span><br><span class="line"><span class="comment">-- 该查询可能有多个结果，假设 degree 值多次符合条件。</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> score <span class="keyword">WHERE</span> degree = (<span class="keyword">SELECT</span> <span class="keyword">MAX</span>(degree) <span class="keyword">FROM</span> score);</span><br><span class="line">+<span class="comment">------+-------+--------+</span></span><br><span class="line">| s_no | c_no  | degree |</span><br><span class="line">+<span class="comment">------+-------+--------+</span></span><br><span class="line">| 103  | 3-105 |     92 |</span><br><span class="line">+<span class="comment">------+-------+--------+</span></span><br></pre></td></tr></table></figure>

<h3 id="子查询-6"><a href="#子查询-6" class="headerlink" title="子查询 - 6"></a>子查询 - 6</h3><p><strong>查询和 “李军” 同性别的所有同学 name 。</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 首先将李军的性别作为条件取出来</span></span><br><span class="line"><span class="keyword">SELECT</span> sex <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> <span class="keyword">name</span> = <span class="string">'李军'</span>;</span><br><span class="line">+<span class="comment">-----+</span></span><br><span class="line">| sex |</span><br><span class="line">+<span class="comment">-----+</span></span><br><span class="line">| 男  |</span><br><span class="line">+<span class="comment">-----+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 根据性别查询 name 和 sex</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">name</span>, sex <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> sex = (</span><br><span class="line">    <span class="keyword">SELECT</span> sex <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> <span class="keyword">name</span> = <span class="string">'李军'</span></span><br><span class="line">);</span><br><span class="line">+<span class="comment">-----------+-----+</span></span><br><span class="line">| name      | sex |</span><br><span class="line">+<span class="comment">-----------+-----+</span></span><br><span class="line">| 曾华      | 男  |</span><br><span class="line">| 匡明      | 男  |</span><br><span class="line">| 李军      | 男  |</span><br><span class="line">| 陆军      | 男  |</span><br><span class="line">| 王尼玛    | 男  |</span><br><span class="line">| 张全蛋    | 男  |</span><br><span class="line">| 赵铁柱    | 男  |</span><br><span class="line">| 张飞      | 男  |</span><br><span class="line">+<span class="comment">-----------+-----+</span></span><br></pre></td></tr></table></figure>

<h3 id="子查询-7"><a href="#子查询-7" class="headerlink" title="子查询 - 7"></a>子查询 - 7</h3><p><strong>查询和 “李军” 同性别且同班的同学 name 。</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">name</span>, sex, <span class="keyword">class</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> sex = (</span><br><span class="line">    <span class="keyword">SELECT</span> sex <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> <span class="keyword">name</span> = <span class="string">'李军'</span></span><br><span class="line">) <span class="keyword">AND</span> <span class="keyword">class</span> = (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="keyword">class</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> <span class="keyword">name</span> = <span class="string">'李军'</span></span><br><span class="line">);</span><br><span class="line">+<span class="comment">-----------+-----+-------+</span></span><br><span class="line">| name      | sex | class |</span><br><span class="line">+<span class="comment">-----------+-----+-------+</span></span><br><span class="line">| 曾华      | 男  | 95033 |</span><br><span class="line">| 李军      | 男  | 95033 |</span><br><span class="line">| 王尼玛    | 男  | 95033 |</span><br><span class="line">+<span class="comment">-----------+-----+-------+</span></span><br></pre></td></tr></table></figure>

<h3 id="子查询-8"><a href="#子查询-8" class="headerlink" title="子查询 - 8"></a>子查询 - 8</h3><p><strong>查询所有选修 “计算机导论” 课程的 “男” 同学成绩表。</strong></p>
<p>需要的 “计算机导论” 和性别为 “男” 的编号可以在 <code>course</code> 和 <code>student</code> 表中找到。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> score <span class="keyword">WHERE</span> c_no = (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="keyword">no</span> <span class="keyword">FROM</span> course <span class="keyword">WHERE</span> <span class="keyword">name</span> = <span class="string">'计算机导论'</span></span><br><span class="line">) <span class="keyword">AND</span> s_no <span class="keyword">IN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="keyword">no</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> sex = <span class="string">'男'</span></span><br><span class="line">);</span><br><span class="line">+<span class="comment">------+-------+--------+</span></span><br><span class="line">| s_no | c_no  | degree |</span><br><span class="line">+<span class="comment">------+-------+--------+</span></span><br><span class="line">| 101  | 3-105 |     90 |</span><br><span class="line">| 102  | 3-105 |     91 |</span><br><span class="line">| 104  | 3-105 |     89 |</span><br><span class="line">| 109  | 3-105 |     76 |</span><br><span class="line">+<span class="comment">------+-------+--------+</span></span><br></pre></td></tr></table></figure>

<h3 id="按等级查询"><a href="#按等级查询" class="headerlink" title="按等级查询"></a>按等级查询</h3><p>建立一个 <code>grade</code> 表代表学生的成绩等级，并插入数据：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> grade (</span><br><span class="line">    <span class="keyword">low</span> <span class="built_in">INT</span>(<span class="number">3</span>),</span><br><span class="line">    upp <span class="built_in">INT</span>(<span class="number">3</span>),</span><br><span class="line">    grade <span class="built_in">char</span>(<span class="number">1</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> grade <span class="keyword">VALUES</span> (<span class="number">90</span>, <span class="number">100</span>, <span class="string">'A'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> grade <span class="keyword">VALUES</span> (<span class="number">80</span>, <span class="number">89</span>, <span class="string">'B'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> grade <span class="keyword">VALUES</span> (<span class="number">70</span>, <span class="number">79</span>, <span class="string">'C'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> grade <span class="keyword">VALUES</span> (<span class="number">60</span>, <span class="number">69</span>, <span class="string">'D'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> grade <span class="keyword">VALUES</span> (<span class="number">0</span>, <span class="number">59</span>, <span class="string">'E'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> grade;</span><br><span class="line">+<span class="comment">------+------+-------+</span></span><br><span class="line">| low  | upp  | grade |</span><br><span class="line">+<span class="comment">------+------+-------+</span></span><br><span class="line">|   90 |  100 | A     |</span><br><span class="line">|   80 |   89 | B     |</span><br><span class="line">|   70 |   79 | C     |</span><br><span class="line">|   60 |   69 | D     |</span><br><span class="line">|    0 |   59 | E     |</span><br><span class="line">+<span class="comment">------+------+-------+</span></span><br></pre></td></tr></table></figure>

<p><strong>查询所有学生的 s_no 、c_no 和 grade 列。</strong></p>
<p>思路是，使用区间 ( <code>BETWEEN</code> ) 查询，判断学生的成绩 ( <code>degree</code> ) 在 <code>grade</code> 表的 <code>low</code> 和 <code>upp</code> 之间。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> s_no, c_no, grade <span class="keyword">FROM</span> score, grade </span><br><span class="line"><span class="keyword">WHERE</span> degree <span class="keyword">BETWEEN</span> <span class="keyword">low</span> <span class="keyword">AND</span> upp;</span><br><span class="line">+<span class="comment">------+-------+-------+</span></span><br><span class="line">| s_no | c_no  | grade |</span><br><span class="line">+<span class="comment">------+-------+-------+</span></span><br><span class="line">| 101  | 3-105 | A     |</span><br><span class="line">| 102  | 3-105 | A     |</span><br><span class="line">| 103  | 3-105 | A     |</span><br><span class="line">| 103  | 3-245 | B     |</span><br><span class="line">| 103  | 6-166 | B     |</span><br><span class="line">| 104  | 3-105 | B     |</span><br><span class="line">| 105  | 3-105 | B     |</span><br><span class="line">| 105  | 3-245 | C     |</span><br><span class="line">| 105  | 6-166 | C     |</span><br><span class="line">| 109  | 3-105 | C     |</span><br><span class="line">| 109  | 3-245 | D     |</span><br><span class="line">| 109  | 6-166 | B     |</span><br><span class="line">+<span class="comment">------+-------+-------+</span></span><br></pre></td></tr></table></figure>

<h3 id="连接查询"><a href="#连接查询" class="headerlink" title="连接查询"></a>连接查询</h3><p>准备用于测试连接查询的数据：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> testJoin;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> person (</span><br><span class="line">    <span class="keyword">id</span> <span class="built_in">INT</span>,</span><br><span class="line">    <span class="keyword">name</span> <span class="built_in">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">    cardId <span class="built_in">INT</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> card (</span><br><span class="line">    <span class="keyword">id</span> <span class="built_in">INT</span>,</span><br><span class="line">    <span class="keyword">name</span> <span class="built_in">VARCHAR</span>(<span class="number">20</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> card <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">'饭卡'</span>), (<span class="number">2</span>, <span class="string">'建行卡'</span>), (<span class="number">3</span>, <span class="string">'农行卡'</span>), (<span class="number">4</span>, <span class="string">'工商卡'</span>), (<span class="number">5</span>, <span class="string">'邮政卡'</span>);</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> card;</span><br><span class="line">+<span class="comment">------+-----------+</span></span><br><span class="line">| id   | name      |</span><br><span class="line">+<span class="comment">------+-----------+</span></span><br><span class="line">|    1 | 饭卡      |</span><br><span class="line">|    2 | 建行卡    |</span><br><span class="line">|    3 | 农行卡    |</span><br><span class="line">|    4 | 工商卡    |</span><br><span class="line">|    5 | 邮政卡    |</span><br><span class="line">+<span class="comment">------+-----------+</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> person <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">'张三'</span>, <span class="number">1</span>), (<span class="number">2</span>, <span class="string">'李四'</span>, <span class="number">3</span>), (<span class="number">3</span>, <span class="string">'王五'</span>, <span class="number">6</span>);</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> person;</span><br><span class="line">+<span class="comment">------+--------+--------+</span></span><br><span class="line">| id   | name   | cardId |</span><br><span class="line">+<span class="comment">------+--------+--------+</span></span><br><span class="line">|    1 | 张三   |      1 |</span><br><span class="line">|    2 | 李四   |      3 |</span><br><span class="line">|    3 | 王五   |      6 |</span><br><span class="line">+<span class="comment">------+--------+--------+</span></span><br></pre></td></tr></table></figure>

<p>分析两张表发现，<code>person</code> 表并没有为 <code>cardId</code> 字段设置一个在 <code>card</code> 表中对应的 <code>id</code> 外键。如果设置了的话，<code>person</code> 中 <code>cardId</code> 字段值为 <code>6</code> 的行就插不进去，因为该 <code>cardId</code> 值在 <code>card</code> 表中并没有。</p>
<h4 id="内连接"><a href="#内连接" class="headerlink" title="内连接"></a>内连接</h4><p>要查询这两张表中有关系的数据，可以使用 <code>INNER JOIN</code> ( 内连接 ) 将它们连接在一起。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- INNER JOIN: 表示为内连接，将两张表拼接在一起。</span></span><br><span class="line"><span class="comment">-- on: 表示要执行某个条件。</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> person <span class="keyword">INNER</span> <span class="keyword">JOIN</span> card <span class="keyword">on</span> person.cardId = card.id;</span><br><span class="line">+<span class="comment">------+--------+--------+------+-----------+</span></span><br><span class="line">| id   | name   | cardId | id   | name      |</span><br><span class="line">+<span class="comment">------+--------+--------+------+-----------+</span></span><br><span class="line">|    1 | 张三   |      1 |    1 | 饭卡      |</span><br><span class="line">|    2 | 李四   |      3 |    3 | 农行卡    |</span><br><span class="line">+<span class="comment">------+--------+--------+------+-----------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 将 INNER 关键字省略掉，结果也是一样的。</span></span><br><span class="line"><span class="comment">-- SELECT * FROM person JOIN card on person.cardId = card.id;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：<code>card</code> 的整张表被连接到了右边。</p>
</blockquote>
<h4 id="左外连接"><a href="#左外连接" class="headerlink" title="左外连接"></a>左外连接</h4><p>完整显示左边的表 ( <code>person</code> ) ，右边的表如果符合条件就显示，不符合则补 <code>NULL</code> 。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- LEFT JOIN 也叫做 LEFT OUTER JOIN，用这两种方式的查询结果是一样的。</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> person <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> card <span class="keyword">on</span> person.cardId = card.id;</span><br><span class="line">+<span class="comment">------+--------+--------+------+-----------+</span></span><br><span class="line">| id   | name   | cardId | id   | name      |</span><br><span class="line">+<span class="comment">------+--------+--------+------+-----------+</span></span><br><span class="line">|    1 | 张三   |      1 |    1 | 饭卡      |</span><br><span class="line">|    2 | 李四   |      3 |    3 | 农行卡    |</span><br><span class="line">|    3 | 王五   |      6 | NULL | NULL      |</span><br><span class="line">+<span class="comment">------+--------+--------+------+-----------+</span></span><br></pre></td></tr></table></figure>

<h4 id="右外链接"><a href="#右外链接" class="headerlink" title="右外链接"></a>右外链接</h4><p>完整显示右边的表 ( <code>card</code> ) ，左边的表如果符合条件就显示，不符合则补 <code>NULL</code> 。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> person <span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> card <span class="keyword">on</span> person.cardId = card.id;</span><br><span class="line">+<span class="comment">------+--------+--------+------+-----------+</span></span><br><span class="line">| id   | name   | cardId | id   | name      |</span><br><span class="line">+<span class="comment">------+--------+--------+------+-----------+</span></span><br><span class="line">|    1 | 张三   |      1 |    1 | 饭卡      |</span><br><span class="line">|    2 | 李四   |      3 |    3 | 农行卡    |</span><br><span class="line">| NULL | NULL   |   NULL |    2 | 建行卡    |</span><br><span class="line">| NULL | NULL   |   NULL |    4 | 工商卡    |</span><br><span class="line">| NULL | NULL   |   NULL |    5 | 邮政卡    |</span><br><span class="line">+<span class="comment">------+--------+--------+------+-----------+</span></span><br></pre></td></tr></table></figure>

<h4 id="全外链接"><a href="#全外链接" class="headerlink" title="全外链接"></a>全外链接</h4><p>完整显示两张表的全部数据。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- MySQL 不支持这种语法的全外连接</span></span><br><span class="line"><span class="comment">-- SELECT * FROM person FULL JOIN card on person.cardId = card.id;</span></span><br><span class="line"><span class="comment">-- 出现错误：</span></span><br><span class="line"><span class="comment">-- ERROR 1054 (42S22): Unknown column 'person.cardId' in 'on clause'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- MySQL全连接语法，使用 UNION 将两张表合并在一起。</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> person <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> card <span class="keyword">on</span> person.cardId = card.id</span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> person <span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> card <span class="keyword">on</span> person.cardId = card.id;</span><br><span class="line">+<span class="comment">------+--------+--------+------+-----------+</span></span><br><span class="line">| id   | name   | cardId | id   | name      |</span><br><span class="line">+<span class="comment">------+--------+--------+------+-----------+</span></span><br><span class="line">|    1 | 张三   |      1 |    1 | 饭卡      |</span><br><span class="line">|    2 | 李四   |      3 |    3 | 农行卡    |</span><br><span class="line">|    3 | 王五   |      6 | NULL | NULL      |</span><br><span class="line">| NULL | NULL   |   NULL |    2 | 建行卡    |</span><br><span class="line">| NULL | NULL   |   NULL |    4 | 工商卡    |</span><br><span class="line">| NULL | NULL   |   NULL |    5 | 邮政卡    |</span><br><span class="line">+<span class="comment">------+--------+--------+------+-----------+</span></span><br></pre></td></tr></table></figure>

<h2 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h2><p>视图是<strong>虚拟的表</strong>。与包含数据的表不一样,视图只包含使用时<strong>动态检索数据</strong>的查询。作为视图,它不包含表中应该有的任何列或数据,它包含的是一个SQL查询。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--定了某个特定商品的客户</span></span><br><span class="line"><span class="keyword">select</span> cust_name,cust_contact</span><br><span class="line"><span class="keyword">from</span> customers,orders,orderitems</span><br><span class="line"><span class="keyword">where</span> customers.cust_id = orders.cust_id</span><br><span class="line">	<span class="keyword">and</span> orderitems.order_num = orders.order_num</span><br><span class="line">	<span class="keyword">and</span> prod_id = <span class="string">'TNT2'</span>;</span><br><span class="line"><span class="comment">--可以把整个查询过程包装成一个名为prodectcustomers的虚拟表，上述过程简写</span></span><br><span class="line"><span class="keyword">select</span> cust_name,cust_contact</span><br><span class="line"><span class="keyword">from</span> prodectcustomers</span><br><span class="line"><span class="keyword">and</span> prod_id = <span class="string">'TNT2'</span>;</span><br></pre></td></tr></table></figure>

<h3 id="为什么用视图？"><a href="#为什么用视图？" class="headerlink" title="为什么用视图？"></a>为什么用视图？</h3><ul>
<li>重用sql语句</li>
<li>简化sql操作</li>
<li>使用表的组成部分而不是整个表</li>
<li>保护数据，给予表特定的访问权限</li>
<li>更改表的数据格式和表示。</li>
</ul>
<p>在视图创建之后，可以用与表基本相同的方式利用他们。可以对试图执行select操作，过滤和排序数据。</p>
<h3 id="使用视图"><a href="#使用视图" class="headerlink" title="使用视图"></a>使用视图</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--视图使用create view语句来创建</span></span><br><span class="line"><span class="comment">--show create view viewname;查看创建视图的语句</span></span><br><span class="line"><span class="comment">--drop删除视图，drop view viewname;</span></span><br><span class="line"><span class="comment">--更新视图，先drop在create</span></span><br><span class="line"><span class="comment">--定了某个特定商品的客户,视图</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">view</span> productcustomers <span class="keyword">as</span></span><br><span class="line"><span class="keyword">select</span> cust_name,cust_contact</span><br><span class="line"><span class="keyword">from</span> customers,orders,orderitems</span><br><span class="line"><span class="keyword">where</span> customers.cust_id = orders.cust_id</span><br><span class="line">	<span class="keyword">and</span> orderitems.order_num = orders.order_num;</span><br><span class="line"><span class="comment">--使用视图格式化检索出来的数据</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">view</span> vendorlocation <span class="keyword">as</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">concat</span>(<span class="keyword">RTrim</span>(vend_name),<span class="string">'('</span>,<span class="keyword">RTrim</span>(vend_contry),<span class="string">')'</span>) <span class="keyword">as</span> vend_title</span><br><span class="line"><span class="keyword">from</span> venders</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> vend_name;</span><br></pre></td></tr></table></figure>

<h2 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h2><p>在 MySQL 中，事务其实是一个最小的不可分割的工作单元。事务能够<strong>保证一个业务的完整性</strong>。</p>
<p>比如我们的银行转账：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- a -&gt; -100</span></span><br><span class="line"><span class="keyword">UPDATE</span> <span class="keyword">user</span> <span class="keyword">set</span> money = money - <span class="number">100</span> <span class="keyword">WHERE</span> <span class="keyword">name</span> = <span class="string">'a'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- b -&gt; +100</span></span><br><span class="line"><span class="keyword">UPDATE</span> <span class="keyword">user</span> <span class="keyword">set</span> money = money + <span class="number">100</span> <span class="keyword">WHERE</span> <span class="keyword">name</span> = <span class="string">'b'</span>;</span><br></pre></td></tr></table></figure>

<p>在实际项目中，假设只有一条 SQL 语句执行成功，而另外一条执行失败了，就会出现数据前后不一致。</p>
<p>因此，在执行多条有关联 SQL 语句时，<strong>事务</strong>可能会要求这些 SQL 语句要么同时执行成功，要么就都执行失败。</p>
<h3 id="如何控制事务-COMMIT-ROLLBACK"><a href="#如何控制事务-COMMIT-ROLLBACK" class="headerlink" title="如何控制事务 - COMMIT / ROLLBACK"></a>如何控制事务 - COMMIT / ROLLBACK</h3><p>在 MySQL 中，事务的<strong>自动提交</strong>状态默认是开启的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-- 查询事务的自动提交状态</span><br><span class="line">SELECT @@AUTOCOMMIT;</span><br><span class="line">+--------------+</span><br><span class="line">| @@AUTOCOMMIT |</span><br><span class="line">+--------------+</span><br><span class="line">|            1 |</span><br><span class="line">+--------------+</span><br></pre></td></tr></table></figure>

<p><strong>自动提交的作用</strong>：当我们执行一条 SQL 语句的时候，其产生的效果就会立即体现出来，且不能<strong>回滚</strong>。</p>
<p>什么是回滚？举个例子：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> bank;</span><br><span class="line"></span><br><span class="line"><span class="keyword">USE</span> bank;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">user</span> (</span><br><span class="line">    <span class="keyword">id</span> <span class="built_in">INT</span> PRIMARY <span class="keyword">KEY</span>,</span><br><span class="line">    <span class="keyword">name</span> <span class="built_in">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">    money <span class="built_in">INT</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">user</span> <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">'a'</span>, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">user</span>;</span><br><span class="line">+<span class="comment">----+------+-------+</span></span><br><span class="line">| id | name | money |</span><br><span class="line">+<span class="comment">----+------+-------+</span></span><br><span class="line">|  1 | a    |  1000 |</span><br><span class="line">+<span class="comment">----+------+-------+</span></span><br></pre></td></tr></table></figure>

<p>可以看到，在执行插入语句后数据立刻生效，原因是 MySQL 中的事务自动将它<strong>提交</strong>到了数据库中。那么所谓<strong>回滚</strong>的意思就是，撤销执行过的所有 SQL 语句，使其回滚到<strong>最后一次提交</strong>数据时的状态。</p>
<p>在 MySQL 中使用 <code>ROLLBACK</code> 执行回滚：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 回滚到最后一次提交</span></span><br><span class="line"><span class="keyword">ROLLBACK</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">user</span>;</span><br><span class="line">+<span class="comment">----+------+-------+</span></span><br><span class="line">| id | name | money |</span><br><span class="line">+<span class="comment">----+------+-------+</span></span><br><span class="line">|  1 | a    |  1000 |</span><br><span class="line">+<span class="comment">----+------+-------+</span></span><br></pre></td></tr></table></figure>

<p>由于所有执行过的 SQL 语句都已经被提交过了，所以<strong>数据并没有发生回滚</strong>。那如何让数据可以发生回滚？</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 关闭自动提交</span></span><br><span class="line"><span class="keyword">SET</span> AUTOCOMMIT = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询自动提交状态</span></span><br><span class="line"><span class="keyword">SELECT</span> @@AUTOCOMMIT;</span><br><span class="line">+<span class="comment">--------------+</span></span><br><span class="line">| @@AUTOCOMMIT |</span><br><span class="line">+<span class="comment">--------------+</span></span><br><span class="line">|            0 |</span><br><span class="line">+<span class="comment">--------------+</span></span><br></pre></td></tr></table></figure>

<p>将自动提交关闭后，测试数据回滚：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">user</span> <span class="keyword">VALUES</span> (<span class="number">2</span>, <span class="string">'b'</span>, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 关闭 AUTOCOMMIT 后，数据的变化是在一张虚拟的临时数据表中展示，</span></span><br><span class="line"><span class="comment">-- 发生变化的数据并没有真正插入到数据表中。</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">user</span>;</span><br><span class="line">+<span class="comment">----+------+-------+</span></span><br><span class="line">| id | name | money |</span><br><span class="line">+<span class="comment">----+------+-------+</span></span><br><span class="line">|  1 | a    |  1000 |</span><br><span class="line">|  2 | b    |  1000 |</span><br><span class="line">+<span class="comment">----+------+-------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 数据表中的真实数据其实还是：</span></span><br><span class="line">+<span class="comment">----+------+-------+</span></span><br><span class="line">| id | name | money |</span><br><span class="line">+<span class="comment">----+------+-------+</span></span><br><span class="line">|  1 | a    |  1000 |</span><br><span class="line">+<span class="comment">----+------+-------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 由于数据还没有真正提交，可以使用回滚</span></span><br><span class="line"><span class="keyword">ROLLBACK</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 再次查询</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">user</span>;</span><br><span class="line">+<span class="comment">----+------+-------+</span></span><br><span class="line">| id | name | money |</span><br><span class="line">+<span class="comment">----+------+-------+</span></span><br><span class="line">|  1 | a    |  1000 |</span><br><span class="line">+<span class="comment">----+------+-------+</span></span><br></pre></td></tr></table></figure>

<p>那如何将虚拟的数据真正提交到数据库中？使用 <code>COMMIT</code> :</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">user</span> <span class="keyword">VALUES</span> (<span class="number">2</span>, <span class="string">'b'</span>, <span class="number">1000</span>);</span><br><span class="line"><span class="comment">-- 手动提交数据（持久性），</span></span><br><span class="line"><span class="comment">-- 将数据真正提交到数据库中，执行后不能再回滚提交过的数据。</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 提交后测试回滚</span></span><br><span class="line"><span class="keyword">ROLLBACK</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 再次查询（回滚无效了）</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">user</span>;</span><br><span class="line">+<span class="comment">----+------+-------+</span></span><br><span class="line">| id | name | money |</span><br><span class="line">+<span class="comment">----+------+-------+</span></span><br><span class="line">|  1 | a    |  1000 |</span><br><span class="line">|  2 | b    |  1000 |</span><br><span class="line">+<span class="comment">----+------+-------+</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>总结</strong></p>
<ol>
<li><p><strong>自动提交</strong></p>
<ul>
<li>查看自动提交状态：<code>SELECT @@AUTOCOMMIT</code> ；</li>
<li>设置自动提交状态：<code>SET AUTOCOMMIT = 0</code> 。</li>
</ul>
</li>
<li><p><strong>手动提交</strong></p>
<p><code>@@AUTOCOMMIT = 0</code> 时，使用 <code>COMMIT</code> 命令提交事务。</p>
</li>
<li><p><strong>事务回滚</strong></p>
<p><code>@@AUTOCOMMIT = 0</code> 时，使用 <code>ROLLBACK</code> 命令回滚事务。</p>
</li>
</ol>
</blockquote>
<p><strong>事务的实际应用</strong>，让我们再回到银行转账项目：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 转账</span></span><br><span class="line"><span class="keyword">UPDATE</span> <span class="keyword">user</span> <span class="keyword">set</span> money = money - <span class="number">100</span> <span class="keyword">WHERE</span> <span class="keyword">name</span> = <span class="string">'a'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 到账</span></span><br><span class="line"><span class="keyword">UPDATE</span> <span class="keyword">user</span> <span class="keyword">set</span> money = money + <span class="number">100</span> <span class="keyword">WHERE</span> <span class="keyword">name</span> = <span class="string">'b'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">user</span>;</span><br><span class="line">+<span class="comment">----+------+-------+</span></span><br><span class="line">| id | name | money |</span><br><span class="line">+<span class="comment">----+------+-------+</span></span><br><span class="line">|  1 | a    |   900 |</span><br><span class="line">|  2 | b    |  1100 |</span><br><span class="line">+<span class="comment">----+------+-------+</span></span><br></pre></td></tr></table></figure>

<p>这时假设在转账时发生了意外，就可以使用 <code>ROLLBACK</code> 回滚到最后一次提交的状态：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 假设转账发生了意外，需要回滚。</span></span><br><span class="line"><span class="keyword">ROLLBACK</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">user</span>;</span><br><span class="line">+<span class="comment">----+------+-------+</span></span><br><span class="line">| id | name | money |</span><br><span class="line">+<span class="comment">----+------+-------+</span></span><br><span class="line">|  1 | a    |  1000 |</span><br><span class="line">|  2 | b    |  1000 |</span><br><span class="line">+<span class="comment">----+------+-------+</span></span><br></pre></td></tr></table></figure>

<p>这时我们又回到了发生意外之前的状态，也就是说，事务给我们提供了一个可以反悔的机会。假设数据没有发生意外，这时可以手动将数据真正提交到数据表中：<code>COMMIT</code> 。</p>
<h3 id="手动开启事务-BEGIN-START-TRANSACTION"><a href="#手动开启事务-BEGIN-START-TRANSACTION" class="headerlink" title="手动开启事务 - BEGIN / START TRANSACTION"></a>手动开启事务 - BEGIN / START TRANSACTION</h3><p>事务的默认提交被开启 ( <code>@@AUTOCOMMIT = 1</code> ) 后，此时就不能使用事务回滚了。但是我们还可以手动开启一个事务处理事件，使其可以发生回滚：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 使用 BEGIN 或者 START TRANSACTION 手动开启一个事务</span></span><br><span class="line"><span class="comment">-- START TRANSACTION;</span></span><br><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> <span class="keyword">user</span> <span class="keyword">set</span> money = money - <span class="number">100</span> <span class="keyword">WHERE</span> <span class="keyword">name</span> = <span class="string">'a'</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> <span class="keyword">user</span> <span class="keyword">set</span> money = money + <span class="number">100</span> <span class="keyword">WHERE</span> <span class="keyword">name</span> = <span class="string">'b'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 由于手动开启的事务没有开启自动提交，</span></span><br><span class="line"><span class="comment">-- 此时发生变化的数据仍然是被保存在一张临时表中。</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">user</span>;</span><br><span class="line">+<span class="comment">----+------+-------+</span></span><br><span class="line">| id | name | money |</span><br><span class="line">+<span class="comment">----+------+-------+</span></span><br><span class="line">|  1 | a    |   900 |</span><br><span class="line">|  2 | b    |  1100 |</span><br><span class="line">+<span class="comment">----+------+-------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 测试回滚</span></span><br><span class="line"><span class="keyword">ROLLBACK</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">user</span>;</span><br><span class="line">+<span class="comment">----+------+-------+</span></span><br><span class="line">| id | name | money |</span><br><span class="line">+<span class="comment">----+------+-------+</span></span><br><span class="line">|  1 | a    |  1000 |</span><br><span class="line">|  2 | b    |  1000 |</span><br><span class="line">+<span class="comment">----+------+-------+</span></span><br></pre></td></tr></table></figure>

<p>仍然使用 <code>COMMIT</code> 提交数据，提交后无法再发生本次事务的回滚。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> <span class="keyword">user</span> <span class="keyword">set</span> money = money - <span class="number">100</span> <span class="keyword">WHERE</span> <span class="keyword">name</span> = <span class="string">'a'</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> <span class="keyword">user</span> <span class="keyword">set</span> money = money + <span class="number">100</span> <span class="keyword">WHERE</span> <span class="keyword">name</span> = <span class="string">'b'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">user</span>;</span><br><span class="line">+<span class="comment">----+------+-------+</span></span><br><span class="line">| id | name | money |</span><br><span class="line">+<span class="comment">----+------+-------+</span></span><br><span class="line">|  1 | a    |   900 |</span><br><span class="line">|  2 | b    |  1100 |</span><br><span class="line">+<span class="comment">----+------+-------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 提交数据</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 测试回滚（无效，因为表的数据已经被提交）</span></span><br><span class="line"><span class="keyword">ROLLBACK</span>;</span><br></pre></td></tr></table></figure>

<h3 id="事务的-ACID-特征与使用"><a href="#事务的-ACID-特征与使用" class="headerlink" title="事务的 ACID 特征与使用"></a>事务的 ACID 特征与使用</h3><p><strong>事务的四大特征：</strong></p>
<ul>
<li><strong>A 原子性</strong>：一个事务必须被<strong>视为一个不可分割的最小工作单元</strong>，整个事务中的所有操作要么全部提交成功，要么全部失败回滚，对于一个事务来说，不可能只执行其中的一部分操作，这就是事务的原子性</li>
<li><strong>C 一致性</strong>：数据库总是从一个一致性的状态转换到另一个一致性的状态。拿转账来说，假设用户A和用户B两者的钱加起来一共是5000，那么不管A和B之间如何转账，转几次账，事务结束后两个用户的钱相加起来应该还得是5000，这就是事务的一致性。 </li>
<li><strong>I 隔离性</strong>：通常来说，一个事务所做的修改在最终提交以前，对其他事务是不可见的。事务1 和 事务2 之间是具有隔离性的；(在前面的例子中，当执行完第1条语句、第2条语句还未开始时，此时有另外的一个账户汇总程序开始运行，则其看到支票帐户的余额并没有被减去100美元。）</li>
<li><strong>D 持久性</strong>：一旦事务提交，则其所做的修改会永久保存到数据库。（此时即使系统崩溃，修改的数据也不会丢失。）事务一旦结束 ( <code>COMMIT</code> ) ，就不可以再返回了 ( <code>ROLLBACK</code> ) 。</li>
</ul>
<h3 id="事务的隔离性"><a href="#事务的隔离性" class="headerlink" title="事务的隔离性"></a>事务的隔离性</h3><p><strong>事务的隔离性可分为四种 ( 性能从低到高 )</strong> ：</p>
<ol>
<li><p><strong>READ UNCOMMITTED ( 读取未提交 )</strong></p>
<p>如果有多个事务，那么任意事务都可以看见其他事务的<strong>未提交数据</strong>。</p>
<p>e.g. 如果有事物a和事务b，a事务对数据进行操作，在操作过程中，事务a没有被提交，但是b可以看见a操作的结果。</p>
</li>
<li><p><strong>READ COMMITTED ( 读取已提交 )</strong></p>
<p>只能读取到其他事务<strong>已经提交的数据</strong>。</p>
</li>
<li><p><strong>REPEATABLE READ ( 可被重复读 ，默认级别)</strong></p>
<p>如果有多个连接都开启了事务，那么事务之间不能共享数据记录，否则只能共享已提交的记录。</p>
</li>
<li><p><strong>SERIALIZABLE ( 串行化 )</strong></p>
<p>所有的事务都会按照<strong>固定顺序执行</strong>，执行完一个事务后再继续执行下一个事务的<strong>写入操作</strong>。</p>
</li>
</ol>
<p>查看当前数据库的默认隔离级别：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- MySQL 8.x, GLOBAL 表示系统级别，不加表示会话级别。</span></span><br><span class="line"><span class="keyword">SELECT</span> @@GLOBAL.TRANSACTION_ISOLATION;</span><br><span class="line"><span class="keyword">SELECT</span> @@TRANSACTION_ISOLATION;</span><br><span class="line">+<span class="comment">--------------------------------+</span></span><br><span class="line">| @@GLOBAL.TRANSACTION_ISOLATION |</span><br><span class="line">+<span class="comment">--------------------------------+</span></span><br><span class="line">| REPEATABLE-READ                | <span class="comment">-- MySQL的默认隔离级别，可以重复读。</span></span><br><span class="line">+<span class="comment">--------------------------------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- MySQL 5.x</span></span><br><span class="line"><span class="keyword">SELECT</span> @@GLOBAL.TX_ISOLATION;</span><br><span class="line"><span class="keyword">SELECT</span> @@TX_ISOLATION;</span><br></pre></td></tr></table></figure>

<p>修改隔离级别：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 设置系统隔离级别，LEVEL 后面表示要设置的隔离级别 (READ UNCOMMITTED)。</span></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> <span class="keyword">TRANSACTION</span> <span class="keyword">ISOLATION</span> <span class="keyword">LEVEL</span> <span class="keyword">READ</span> UNCOMMITTED;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询系统隔离级别，发现已经被修改。</span></span><br><span class="line"><span class="keyword">SELECT</span> @@GLOBAL.TRANSACTION_ISOLATION;</span><br><span class="line">+<span class="comment">--------------------------------+</span></span><br><span class="line">| @@GLOBAL.TRANSACTION_ISOLATION |</span><br><span class="line">+<span class="comment">--------------------------------+</span></span><br><span class="line">| READ-UNCOMMITTED               |</span><br><span class="line">+<span class="comment">--------------------------------+</span></span><br></pre></td></tr></table></figure>

<h4 id="脏读"><a href="#脏读" class="headerlink" title="脏读"></a>脏读</h4><p>测试 <strong>READ UNCOMMITTED ( 读取未提交 别)</strong> 的隔离性：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">user</span> <span class="keyword">VALUES</span> (<span class="number">3</span>, <span class="string">'小明'</span>, <span class="number">1000</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">user</span> <span class="keyword">VALUES</span> (<span class="number">4</span>, <span class="string">'淘宝店'</span>, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">user</span>;</span><br><span class="line">+<span class="comment">----+-----------+-------+</span></span><br><span class="line">| id | name      | money |</span><br><span class="line">+<span class="comment">----+-----------+-------+</span></span><br><span class="line">|  1 | a         |   900 |</span><br><span class="line">|  2 | b         |  1100 |</span><br><span class="line">|  3 | 小明      |  1000 |</span><br><span class="line">|  4 | 淘宝店    |  1000 |</span><br><span class="line">+<span class="comment">----+-----------+-------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 开启一个事务操作数据</span></span><br><span class="line"><span class="comment">-- 假设小明在淘宝店买了一双800块钱的鞋子：</span></span><br><span class="line"><span class="keyword">START</span> <span class="keyword">TRANSACTION</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> <span class="keyword">user</span> <span class="keyword">SET</span> money = money - <span class="number">800</span> <span class="keyword">WHERE</span> <span class="keyword">name</span> = <span class="string">'小明'</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> <span class="keyword">user</span> <span class="keyword">SET</span> money = money + <span class="number">800</span> <span class="keyword">WHERE</span> <span class="keyword">name</span> = <span class="string">'淘宝店'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 然后淘宝店在另一方查询结果，发现钱已到账。</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">user</span>;</span><br><span class="line">+<span class="comment">----+-----------+-------+</span></span><br><span class="line">| id | name      | money |</span><br><span class="line">+<span class="comment">----+-----------+-------+</span></span><br><span class="line">|  1 | a         |   900 |</span><br><span class="line">|  2 | b         |  1100 |</span><br><span class="line">|  3 | 小明      |   200 |</span><br><span class="line">|  4 | 淘宝店    |  1800 |</span><br><span class="line">+<span class="comment">----+-----------+-------+</span></span><br></pre></td></tr></table></figure>

<p>由于小明的转账是在新开启的事务上进行操作的，而该操作的结果是可以被其他事务（另一方的淘宝店）看见的，因此淘宝店的查询结果是正确的，淘宝店确认到账。但就在这时，如果小明在它所处的事务上又执行了 <code>ROLLBACK</code> 命令，会发生什么？</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 小明所处的事务</span></span><br><span class="line"><span class="keyword">ROLLBACK</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 此时无论对方是谁，如果再去查询结果就会发现：</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">user</span>;</span><br><span class="line">+<span class="comment">----+-----------+-------+</span></span><br><span class="line">| id | name      | money |</span><br><span class="line">+<span class="comment">----+-----------+-------+</span></span><br><span class="line">|  1 | a         |   900 |</span><br><span class="line">|  2 | b         |  1100 |</span><br><span class="line">|  3 | 小明      |  1000 |</span><br><span class="line">|  4 | 淘宝店    |  1000 |</span><br><span class="line">+<span class="comment">----+-----------+-------+</span></span><br></pre></td></tr></table></figure>

<p>这就是所谓的<strong>脏读</strong>，一个事务读取到另外一个事务还未提交的数据。这在实际开发中是<strong>不允许</strong>出现的。</p>
<h4 id="不可重复读"><a href="#不可重复读" class="headerlink" title="不可重复读"></a>不可重复读</h4><p>把隔离级别设置为 <strong>READ COMMITTED</strong> ：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> <span class="keyword">TRANSACTION</span> <span class="keyword">ISOLATION</span> <span class="keyword">LEVEL</span> <span class="keyword">READ</span> COMMITTED;</span><br><span class="line"><span class="keyword">SELECT</span> @@GLOBAL.TRANSACTION_ISOLATION;</span><br><span class="line">+<span class="comment">--------------------------------+</span></span><br><span class="line">| @@GLOBAL.TRANSACTION_ISOLATION |</span><br><span class="line">+<span class="comment">--------------------------------+</span></span><br><span class="line">| READ-COMMITTED                 |</span><br><span class="line">+<span class="comment">--------------------------------+</span></span><br></pre></td></tr></table></figure>

<p>这样，再有新的事务连接进来时，它们就只能查询到已经提交过的事务数据了。但是对于当前事务来说，它们看到的还是未提交的数据，例如：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 正在操作数据事务（当前事务）</span></span><br><span class="line"><span class="keyword">START</span> <span class="keyword">TRANSACTION</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> <span class="keyword">user</span> <span class="keyword">SET</span> money = money - <span class="number">800</span> <span class="keyword">WHERE</span> <span class="keyword">name</span> = <span class="string">'小明'</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> <span class="keyword">user</span> <span class="keyword">SET</span> money = money + <span class="number">800</span> <span class="keyword">WHERE</span> <span class="keyword">name</span> = <span class="string">'淘宝店'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 虽然隔离级别被设置为了 READ COMMITTED，但在当前事务中，</span></span><br><span class="line"><span class="comment">-- 它看到的仍然是数据表中临时改变数据，而不是真正提交过的数据。</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">user</span>;</span><br><span class="line">+<span class="comment">----+-----------+-------+</span></span><br><span class="line">| id | name      | money |</span><br><span class="line">+<span class="comment">----+-----------+-------+</span></span><br><span class="line">|  1 | a         |   900 |</span><br><span class="line">|  2 | b         |  1100 |</span><br><span class="line">|  3 | 小明      |   200 |</span><br><span class="line">|  4 | 淘宝店    |  1800 |</span><br><span class="line">+<span class="comment">----+-----------+-------+</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 假设此时在远程开启了一个新事务，连接到数据库。</span></span><br><span class="line">$ mysql -u root -p12345612</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 此时远程连接查询到的数据只能是已经提交过的</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">user</span>;</span><br><span class="line">+<span class="comment">----+-----------+-------+</span></span><br><span class="line">| id | name      | money |</span><br><span class="line">+<span class="comment">----+-----------+-------+</span></span><br><span class="line">|  1 | a         |   900 |</span><br><span class="line">|  2 | b         |  1100 |</span><br><span class="line">|  3 | 小明      |  1000 |</span><br><span class="line">|  4 | 淘宝店    |  1000 |</span><br><span class="line">+<span class="comment">----+-----------+-------+</span></span><br></pre></td></tr></table></figure>

<p>但是这样还有问题，那就是假设一个事务在操作数据时，其他事务干扰了这个事务的数据。例如：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 小张在查询数据的时候发现：</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">user</span>;</span><br><span class="line">+<span class="comment">----+-----------+-------+</span></span><br><span class="line">| id | name      | money |</span><br><span class="line">+<span class="comment">----+-----------+-------+</span></span><br><span class="line">|  1 | a         |   900 |</span><br><span class="line">|  2 | b         |  1100 |</span><br><span class="line">|  3 | 小明      |   200 |</span><br><span class="line">|  4 | 淘宝店    |  1800 |</span><br><span class="line">+<span class="comment">----+-----------+-------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 在小张求表的 money 平均值之前，小王做了一个操作：</span></span><br><span class="line"><span class="keyword">START</span> <span class="keyword">TRANSACTION</span>;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">user</span> <span class="keyword">VALUES</span> (<span class="number">5</span>, <span class="string">'c'</span>, <span class="number">100</span>);</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 此时表的真实数据是：</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">user</span>;</span><br><span class="line">+<span class="comment">----+-----------+-------+</span></span><br><span class="line">| id | name      | money |</span><br><span class="line">+<span class="comment">----+-----------+-------+</span></span><br><span class="line">|  1 | a         |   900 |</span><br><span class="line">|  2 | b         |  1100 |</span><br><span class="line">|  3 | 小明      |  1000 |</span><br><span class="line">|  4 | 淘宝店    |  1000 |</span><br><span class="line">|  5 | c         |   100 |</span><br><span class="line">+<span class="comment">----+-----------+-------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 这时小张再求平均值的时候，就会出现计算不相符合的情况：</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">AVG</span>(money) <span class="keyword">FROM</span> <span class="keyword">user</span>;</span><br><span class="line">+<span class="comment">------------+</span></span><br><span class="line">| AVG(money) |</span><br><span class="line">+<span class="comment">------------+</span></span><br><span class="line">|  820.0000  |</span><br><span class="line">+<span class="comment">------------+</span></span><br></pre></td></tr></table></figure>

<p>虽然 <strong>READ COMMITTED</strong> 让我们只能读取到其他事务已经提交的数据，但还是会出现问题，就是<strong>在读取同一个表的数据时，可能会发生前后不一致的情况。这被称为不可重复读现象 ( READ COMMITTED )</strong> 。</p>
<h4 id="幻读"><a href="#幻读" class="headerlink" title="幻读"></a>幻读</h4><p>将隔离级别设置为 <strong>REPEATABLE READ ( 可被重复读取 )</strong> :</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> <span class="keyword">TRANSACTION</span> <span class="keyword">ISOLATION</span> <span class="keyword">LEVEL</span> REPEATABLE <span class="keyword">READ</span>;</span><br><span class="line"><span class="keyword">SELECT</span> @@GLOBAL.TRANSACTION_ISOLATION;</span><br><span class="line">+<span class="comment">--------------------------------+</span></span><br><span class="line">| @@GLOBAL.TRANSACTION_ISOLATION |</span><br><span class="line">+<span class="comment">--------------------------------+</span></span><br><span class="line">| REPEATABLE-READ                |</span><br><span class="line">+<span class="comment">--------------------------------+</span></span><br></pre></td></tr></table></figure>

<p>测试 <strong>REPEATABLE READ</strong> ，假设在两个不同的连接上分别执行 <code>START TRANSACTION</code> :</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 小张 - 成都</span></span><br><span class="line"><span class="keyword">START</span> <span class="keyword">TRANSACTION</span>;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">user</span> <span class="keyword">VALUES</span> (<span class="number">6</span>, <span class="string">'d'</span>, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 小王 - 北京</span></span><br><span class="line"><span class="keyword">START</span> <span class="keyword">TRANSACTION</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 小张 - 成都</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br></pre></td></tr></table></figure>

<p>当前事务开启后，没提交之前，查询不到，提交后可以被查询到。但是，在提交之前其他事务被开启了，那么在这条事务线上，就不会查询到当前有操作事务的连接。相当于开辟出一条单独的线程。</p>
<p>无论小张是否执行过 <code>COMMIT</code> ，在小王这边，都不会查询到小张的事务记录，而是只会查询到自己所处事务的记录：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">user</span>;</span><br><span class="line">+<span class="comment">----+-----------+-------+</span></span><br><span class="line">| id | name      | money |</span><br><span class="line">+<span class="comment">----+-----------+-------+</span></span><br><span class="line">|  1 | a         |   900 |</span><br><span class="line">|  2 | b         |  1100 |</span><br><span class="line">|  3 | 小明      |  1000 |</span><br><span class="line">|  4 | 淘宝店    |  1000 |</span><br><span class="line">|  5 | c         |   100 |</span><br><span class="line">+<span class="comment">----+-----------+-------+</span></span><br></pre></td></tr></table></figure>

<p>这是<strong>因为小王在此之前开启了一个新的事务 ( START TRANSACTION ) ，那么在他的这条新事务的线上，跟其他事务是没有联系的</strong>，也就是说，此时如果其他事务正在操作数据，它是不知道的。</p>
<p>然而事实是，在真实的数据表中，小张已经插入了一条数据。但是小王此时并不知道，也插入了同一条数据，会发生什么呢？</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">user</span> <span class="keyword">VALUES</span> (<span class="number">6</span>, <span class="string">'d'</span>, <span class="number">1000</span>);</span><br><span class="line"><span class="comment">-- ERROR 1062 (23000): Duplicate entry '6' for key 'PRIMARY'</span></span><br></pre></td></tr></table></figure>

<p>报错了，操作被告知已存在主键为 <code>6</code> 的字段。这种现象也被称为<strong>幻读，一个事务提交的数据，不能被其他事务读取到</strong>。</p>
<h4 id="串行化"><a href="#串行化" class="headerlink" title="串行化"></a>串行化</h4><p>顾名思义，就是所有事务的<strong>写入操作</strong>全都是串行化的。什么意思？把隔离级别修改成 <strong>SERIALIZABLE</strong> :</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> <span class="keyword">TRANSACTION</span> <span class="keyword">ISOLATION</span> <span class="keyword">LEVEL</span> <span class="keyword">SERIALIZABLE</span>;</span><br><span class="line"><span class="keyword">SELECT</span> @@GLOBAL.TRANSACTION_ISOLATION;</span><br><span class="line">+<span class="comment">--------------------------------+</span></span><br><span class="line">| @@GLOBAL.TRANSACTION_ISOLATION |</span><br><span class="line">+<span class="comment">--------------------------------+</span></span><br><span class="line">| SERIALIZABLE                   |</span><br><span class="line">+<span class="comment">--------------------------------+</span></span><br></pre></td></tr></table></figure>

<p>还是拿小张和小王来举例：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 小张 - 成都</span></span><br><span class="line"><span class="keyword">START</span> <span class="keyword">TRANSACTION</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 小王 - 北京</span></span><br><span class="line"><span class="keyword">START</span> <span class="keyword">TRANSACTION</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 开启事务之前先查询表，准备操作数据。</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">user</span>;</span><br><span class="line">+<span class="comment">----+-----------+-------+</span></span><br><span class="line">| id | name      | money |</span><br><span class="line">+<span class="comment">----+-----------+-------+</span></span><br><span class="line">|  1 | a         |   900 |</span><br><span class="line">|  2 | b         |  1100 |</span><br><span class="line">|  3 | 小明      |  1000 |</span><br><span class="line">|  4 | 淘宝店    |  1000 |</span><br><span class="line">|  5 | c         |   100 |</span><br><span class="line">|  6 | d         |  1000 |</span><br><span class="line">+<span class="comment">----+-----------+-------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 发现没有 7 号王小花，于是插入一条数据：</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">user</span> <span class="keyword">VALUES</span> (<span class="number">7</span>, <span class="string">'王小花'</span>, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure>

<p>此时会发生什么呢？由于现在的隔离级别是 <strong>SERIALIZABLE ( 串行化 )</strong> ，串行化的意思就是：假设把所有的事务都放在一个串行的队列中，那么所有的事务都会按照<strong>固定顺序执行</strong>，执行完一个事务后再继续执行下一个事务的<strong>写入操作</strong> ( <strong>这意味着队列中同时只能执行一个事务的写入操作</strong> ) 。</p>
<p>根据这个解释，小王在插入数据时，会出现等待状态，直到小张执行 <code>COMMIT</code> 结束它所处的事务，或者出现等待超时。</p>
<h2 id="缓存"><a href="#缓存" class="headerlink" title="缓存"></a>缓存</h2><h3 id="SQL执行过程"><a href="#SQL执行过程" class="headerlink" title="SQL执行过程"></a>SQL执行过程</h3><ul>
<li>1.当客户端连接到MySQL服务器时，服务器对其进行认证。可以通过用户名与密码认证，也可以通过SSL证书进行认证。登录认证后，服务器还会验证客户端是否有执行某个查询的操作权限。</li>
<li>2.在正式查询之前，服务器会检查查询缓存，如果能找到对应的查询，则不必进行查询解析，优化，执行等过程，直接返回缓存中的结果集。</li>
<li>3.MySQL的解析器会根据查询语句，构造出一个解析树，主要用于根据语法规则来验证语句是否正确，比如SQL的关键字是否正确，关键字的顺序是否正确。</li>
</ul>
<p>而预处理器主要是进一步校验，比如表名，字段名是否正确等</p>
<ul>
<li>4.查询优化器将解析树转化为查询计划，一般情况下，一条查询可以有很多种执行方式，最终返回相同的结果，优化器就是根据<code>成本</code>找到这其中最优的执行计划</li>
<li>5.执行计划调用查询执行引擎，而查询引擎通过一系列API接口查询到数据</li>
<li>6.得到数据之后，在返回给客户端的同时，会将数据存在查询缓存中</li>
</ul>
<p><img src="/yangmiemie99.github.io/2020/04/04/SQL入门学习/sql%E6%89%A7%E8%A1%8C.png" alt></p>
<h3 id="查询缓存"><a href="#查询缓存" class="headerlink" title="查询缓存"></a>查询缓存</h3><p>我们先通过<code>show variables like &#39;%query_cache%&#39;</code>来看一下默认的数据库配置，此为本地数据库的配置。</p>
<p><img src="/yangmiemie99.github.io/2020/04/04/SQL入门学习/sql_cache.png" alt></p>
<p>have_query_cache:当前的MYSQL版本是否支持“查询缓存”功能。</p>
<p>query_cache_limit:MySQL能够缓存的最大查询结果，查询结果大于该值时不会被缓存。默认值是1048576(1MB)</p>
<p>query_cache_min_res_unit:查询缓存分配的最小块（字节）。默认值是4096（4KB）。当查询进行时，MySQL把查询结果保存在query cache，但是如果保存的结果比较大，超过了query_cache_min_res_unit的值，这时候MySQL将一边检索结果，一边进行保存结果。他保存结果也是按默认大小先分配一块空间，如果不够，又要申请新的空间给他。如果查询结果比较小，默认的query_cache_min_res_unit可能造成大量的内存碎片，如果查询结果比较大，默认的query_cache_min_res_unit又不够，导致一直分配块空间，所以可以根据实际需求，调节query_cache_min_res_unit的大小。</p>
<p>query_cache_size:为缓存查询结果分配的总内存。</p>
<p>query_cache_type:为on，可以缓存除了以select sql_no_cache开头的所有查询结果。默认query_cache_type设置为OFF，其实网上资料和各大云厂商提供的云服务器都是将这个功能关闭的，从上面的原理来看，在一般情况下，<code>他的弊端大于优点</code>。</p>
<p>query_cache_wlock_invalidate:如果该表被锁住，是否返回缓存中的数据，默认是关闭的。</p>
<h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><p>MYSQL的查询缓存实质上是缓存SQL的<strong>hash值和该SQL的查询结果</strong>，如果运行相同的SQL,服务器直接从缓存中去掉结果，而不再去解析，优化，寻找最低成本的执行计划等一系列操作，大大提升了查询速度。</p>
<ul>
<li>第一个弊端就是<strong>如果表的数据有一条发生变化，那么缓存好的结果将全部不再有效</strong>。这对于频繁更新的表，查询缓存是不适合的。</li>
</ul>
<p>比如一张表里面只有两个字段，分别是id和name，数据有一条为1，张三。我使用select * from 表名 where name=“张三”来进行查询，MySQL发现查询缓存中没有此数据，会进行一系列的解析，优化等操作进行数据的查询，查询结束之后将该SQL的hash和查询结果缓存起来，并将查询结果返回给客户端。但是这个时候我有新增了一条数据2，张三。如果我还用相同的SQL来执行，他会根据该SQL的hash值去查询缓存中，那么结果就错了。所以MySQL对于数据有变化的表来说，会直接清空关于该表的所有缓存。这样其实是效率是很差的。</p>
<ul>
<li>第二个<strong>弊端就是缓存机制是通过对SQL的hash</strong>，得出的值为key，查询结果为value来存放的，那么就意味<strong>着SQL必须完完全全一模一样</strong>，否则就命不中缓存。</li>
</ul>
<p>我们都知道hash值的规则，就算很小的查询，哈希出来的结果差距是很多的，所以select * from 表名 where name=“张三”和SELECT * FROM 表名 WHERE NAME=“张三”和select * from 表名 where name = “张三”，三个SQL哈希出来的值是不一样的，大小写和空格影响了他们，所以并不能命中缓存，但其实他们搜索结果是完全一样的。</p>
<h2 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h2><p>首先明白为什么索引会增加速度，DB在执行一条Sql语句的时候，默认的方式是根据搜索条件进行<strong>全表扫描</strong>，遇到匹配条件的就加入搜索结果集合。如果我们对某一字段增加索引，查询时就会先去索引列表中<strong>一次定位到特定值的行数</strong>，<strong>大大减少遍历匹配的行数，所以能明显增加查询的速度。</strong> </p>
<h3 id="原理部分转载"><a href="#原理部分转载" class="headerlink" title="原理部分转载"></a>原理部分转载</h3><p><a href="https://blog.csdn.net/u013308490/article/details/83001060" target="_blank" rel="noopener">原文地址</a></p>
<p>大部分数据库系统都采用B+树作为索引结构。在mysql中，索引属于存储引擎级别的概念，不同存储引擎对索引的实现方式是不同的，MyISAM和InnoDB两个存储引擎的索引实现方式见下。</p>
<h4 id="MyISAM索引实现"><a href="#MyISAM索引实现" class="headerlink" title="MyISAM索引实现"></a>MyISAM索引实现</h4><p>MyISAM引擎使用B+Tree作为索引结构，叶节点的data域存放的是<strong>数据记录的地址</strong>。主键索引的key不可以重复，而辅助索引的key可以重复。<strong>MyISAM 的索引方式也叫做“非聚集索引”</strong>。</p>
<h4 id="InnoDB索引实现"><a href="#InnoDB索引实现" class="headerlink" title="InnoDB索引实现"></a>InnoDB索引实现</h4><p>InnoDB也是使用B+Tree作为索引结构，但是具体实现方式却与MyISAM截然不同。</p>
<p>1 InnoDB的数据文件本身就是索引文件。数据文件本身按照B+Tree组织的一个索引结构，这棵树的叶子节点data域完整保存数据记录。这个索引的key是数据表的主键。<strong>这种索引叫做聚集索引。因为 InnoDB 的数据文件本身要按主键聚集。</strong></p>
<p>同时,请<strong>尽量在 InnoDB 上采用自增字段做表的主键</strong>。因为 InnoDB 数据文件本身是一棵B+Tree,非单调的主键会造成在插入新记录时数据文件为了维持 B+Tree 的特性而频繁的分裂调整,十分低效,而使用自增字段作为主键则是一个很好的选择。如果表使用自增主键,那么每次插入新的记录,记录就会顺序添加到当前索引节点的后续位置,当一页写满,就会自动开辟一个新的页。</p>
<p>2 .第二个与 MyISAM 索引的不同是 InnoDB 的<strong>辅助索引 data 域</strong>存储相应记录主键的值而不是地址。</p>
<p><strong>聚集索引</strong>这种实现方式使得按<strong>主键的搜索十分高效</strong>,但是辅助索引搜索需要检索两遍索引:首先检索<strong>辅助索引获得主键,</strong>然后用主键到主索引中检索获得记录。</p>
<p>因为辅助索引存储的数据是主键索引的key，这样就不建议主键过长，主键过长会导致辅助索引变的过大。</p>
<p><img src="/yangmiemie99.github.io/2020/04/04/SQL入门学习/%E7%B4%A2%E5%BC%95.jpg" alt></p>
<p><strong>联合索引及最左原则</strong></p>
<p>将多个字段联合一起作为索引，使用最左原则</p>
<p>例如有联合索引三个字段（A，B，C）</p>
<p>查询条件：</p>
<p>查询条件：</p>
<p>（A，，）—会使用索引</p>
<p>（A，B，）—会使用索引</p>
<p>（A，B，C）—会使用索引</p>
<p>（，B，C）—不会使用索引</p>
<p>（，，C）—不会使用索引</p>
<p><strong>最左匹配原则</strong>：</p>
<ul>
<li>索引可以简单如一个列<code>(a)</code>，也可以复杂如多个列<code>(a, b, c, d)</code>，即<strong>联合索引</strong>。</li>
<li>如果是联合索引，那么key也由多个列组成，同时，索引只能用于查找key是否<strong>存在（相等）</strong>，遇到范围查询<code>(&gt;、&lt;、between、like</code>左匹配)等就<strong>不能进一步匹配</strong>了，后续退化为线性查找。</li>
<li>因此，<strong>列的排列顺序决定了可命中索引的列数</strong>。</li>
</ul>
<p>例子：</p>
<ul>
<li><p>如有索引<code>(a, b, c, d)</code>，查询条件<code>a = 1 and b = 2 and c &gt; 3 and d = 4</code>，则会在每个节点依次命中a、b、c，无法命中d。(很简单：索引命中只能是<strong>相等</strong>的情况，不能是范围匹配)</p>
</li>
<li><p>=、in自动优化顺序</p>
<p><strong>不需要考虑=、in等的顺序</strong>，mysql会自动优化这些条件的顺序，以匹配尽可能多的索引列。</p>
<p>例子：</p>
<ul>
<li>如有索引<code>(a, b, c, d)</code>，查询条件<code>c &gt; 3 and b = 2 and a = 1 and d &lt; 4</code>与<code>a = 1 and c &gt; 3 and b = 2 and d &lt; 4</code>等顺序都是可以的，MySQL会自动优化为<code>a = 1 and b = 2 and c &gt; 3 and d &lt; 4</code>，依次命中a、b、c。</li>
</ul>
</li>
</ul>
<h3 id="索引的分类"><a href="#索引的分类" class="headerlink" title="索引的分类"></a>索引的分类</h3><p><strong>常见的索引类型有：主键索引、唯一索引、普通索引、全文索引、组合索引</strong></p>
<h3 id="创建索引"><a href="#创建索引" class="headerlink" title="创建索引"></a>创建索引</h3><p><strong>1普通索引</strong></p>
<p>在创建表的时候添加索引</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> mytable(  </span><br><span class="line">    <span class="keyword">ID</span> <span class="built_in">INT</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,   </span><br><span class="line">    username <span class="built_in">VARCHAR</span>(<span class="number">16</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,  </span><br><span class="line">    <span class="keyword">INDEX</span> [indexName] (username(<span class="keyword">length</span>))  </span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>在创建表以后添加索引</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> my_table <span class="keyword">ADD</span> <span class="keyword">INDEX</span> index_name(column_name);</span><br><span class="line">或者</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">INDEX</span> index_name <span class="keyword">ON</span> my_table(column_name);</span><br></pre></td></tr></table></figure>

<p>删除索引的语法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">INDEX</span> [indexName] <span class="keyword">ON</span> mytable;</span><br></pre></td></tr></table></figure>

<p>2<strong>唯一索引</strong></p>
<p>它与前面的普通索引类似，不同的就是：索引列的值必须唯一，但允许有空值。如果是组合索引，则列值的组合必须唯一。它有以下几种创建方式：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--创建索引</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> <span class="keyword">INDEX</span> indexName <span class="keyword">ON</span> mytable(username(<span class="keyword">length</span>)) </span><br><span class="line"><span class="comment">--修改索引</span></span><br><span class="line"><span class="keyword">ALTER</span> mytable <span class="keyword">ADD</span> <span class="keyword">UNIQUE</span> [indexName] <span class="keyword">ON</span> (username(<span class="keyword">length</span>))</span><br><span class="line"><span class="comment">--建表时直接指定</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> mytable(  </span><br><span class="line"><span class="keyword">ID</span> <span class="built_in">INT</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,   </span><br><span class="line">username <span class="built_in">VARCHAR</span>(<span class="number">16</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,  </span><br><span class="line"><span class="keyword">UNIQUE</span> [indexName] (username(<span class="keyword">length</span>))</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>3<strong>主键索引</strong></p>
<p>它是一种特殊的唯一索引，不允许有空值。一般是在建表的时候同时创建主键索引：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> mytable(  </span><br><span class="line"> </span><br><span class="line"><span class="keyword">ID</span> <span class="built_in">INT</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,   </span><br><span class="line"> </span><br><span class="line">username <span class="built_in">VARCHAR</span>(<span class="number">16</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,  </span><br><span class="line"> </span><br><span class="line">PRIMARY <span class="keyword">KEY</span>(<span class="keyword">ID</span>)  </span><br><span class="line"> </span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>4<strong>组合索引</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> mytable(  </span><br><span class="line"> </span><br><span class="line"><span class="keyword">ID</span> <span class="built_in">INT</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,   </span><br><span class="line"> </span><br><span class="line">username <span class="built_in">VARCHAR</span>(<span class="number">16</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,  </span><br><span class="line"> </span><br><span class="line">city <span class="built_in">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,  </span><br><span class="line"> </span><br><span class="line">age <span class="built_in">INT</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> </span><br><span class="line"> </span><br><span class="line">);  </span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> mytable <span class="keyword">ADD</span> <span class="keyword">INDEX</span> name_city_age (<span class="keyword">name</span>(<span class="number">10</span>),city,age);</span><br></pre></td></tr></table></figure>

<p>建立这样的组合索引，其实是相当于分别建立了下面三组组合索引：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1. usernname,city,age  </span><br><span class="line">2. usernname,city   </span><br><span class="line">3. usernname</span><br></pre></td></tr></table></figure>

<p>5<strong>全文索引</strong><br>FULLTEXT（全文）索引，<strong>仅可用于MyISAM</strong>针对较大的数据，生成全文索引非常的消耗时间和空间。<strong>对于文本的大对象</strong>，或者较大的CHAR类型的数据，如果使用普通索引，那么匹配文本前几个字符还是可行的，但是想要匹配文本中间的几个单词，那么就要使用LIKE %word%来匹配，这样需要很长的时间来处理，响应时间会大大增加，这种情况，就可使用时FULLTEXT索引了，使用全文本搜索时,MySQL<strong>不需要分别查看每个行</strong>,不需要分别分析和处理每个词。MySQL创建指<strong>定列中各词的一个索引</strong>,搜索可以针对这些词进行。样,MySQL可以快速有效地决定哪些词匹配(哪些行包含它们)<br>哪些词不匹配,它们匹配的频率,等等。<strong>在生成FULLTEXT索引时，会为文本生成一份单词的清单，在索引时及根据这个单词的清单来索引。</strong>FULLTEXT可以在创建表的时候创建，也可以在需要的时候用ALTER或者CREATE INDEX来添加：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--创建表的时候添加FULLTEXT索引</span></span><br><span class="line">CTREATE TABLE my_table(</span><br><span class="line">    id INT(10) PRIMARY KEY,</span><br><span class="line">    name VARCHAR(10) NOT NULL,</span><br><span class="line">    my_text TEXT,</span><br><span class="line">    FULLTEXT(my_text)</span><br><span class="line">)ENGINE=MyISAM DEFAULT CHARSET=utf8;</span><br><span class="line"><span class="comment">--创建表以后，在需要的时候添加FULLTEXT索引</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> my_table <span class="keyword">ADD</span> FULLTEXT <span class="keyword">INDEX</span> </span><br><span class="line">ft_index(column_name);</span><br></pre></td></tr></table></figure>

<p>全文索引的查询也有自己特殊的语法，而不能使用LIKE %查询字符串%的模糊查询语法</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> table_name <span class="keyword">MATCH</span>(my_index) AGAINST(<span class="string">'查询字符串'</span>);</span><br></pre></td></tr></table></figure>

<h3 id="删除和查询索引"><a href="#删除和查询索引" class="headerlink" title="删除和查询索引"></a>删除和查询索引</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> table_name <span class="keyword">drop</span> <span class="keyword">index</span> index_name;</span><br><span class="line"></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">index</span> <span class="keyword">from</span> table_name;</span><br></pre></td></tr></table></figure>

<h3 id="索引的不足之处"><a href="#索引的不足之处" class="headerlink" title="索引的不足之处"></a>索引的不足之处</h3><p>上面都在说使用索引的好处，但过多的使用索引将会造成滥用。因此索引也会有它的缺点：</p>
<ul>
<li><p>虽然索引大大提高了查询速度，同时却会降低更新表的速度，如对表进行INSERT、UPDATE和DELETE。因为更新表时，MySQL不仅要保存数据，还要保存一下索引文件。</p>
</li>
<li><p>建立索引会占用磁盘空间的索引文件。一般情况这个问题不太严重，但如果你在一个大表上创建了多种组合索引，索引文件的会膨胀很快。</p>
</li>
</ul>
<p>索引只是提高效率的一个因素，如果你的MySQL有大数据量的表，就需要花时间研究建立最优秀的索引，或优化查询语句。</p>
<h3 id="使用索引的注意事项"><a href="#使用索引的注意事项" class="headerlink" title="使用索引的注意事项"></a>使用索引的注意事项</h3><p>使用索引时，有以下一些技巧和注意事项：</p>
<ul>
<li><p>最佳左前缀法则<br>如果索引了多列,要遵守最左前缀法则。指的是查询从索引的最左前列开始并且不跳过索引<br>中的列。</p>
</li>
<li><p>索引不会包含有NULL值的列</p>
</li>
</ul>
<p>只要列中包含有NULL值都将不会被包含在索引中，复合索引中只要有一列含有NULL值，那么这一列对于此复合索引就是无效的。所以我们在数据库设计时不要让字段的默认值为NULL。</p>
<ul>
<li>使用短索引</li>
</ul>
<p>对串列进行索引，如果可能应该指定一个前缀长度。例如，如果有一个CHAR(255)的列，如果在前10个或20个字符内，多数值是惟一的，那么就不要对整个列进行索引。短索引不仅可以提高查询速度而且可以节省磁盘空间和I/O操作。</p>
<ul>
<li>索引列排序</li>
</ul>
<p>MySQL查询只使用一个索引，因此如果where子句中已经使用了索引的话，那么order by中的列是不会使用索引的。因此数据库默认排序可以符合要求的情况下不要使用排序操作；尽量不要包含多个列的排序，如果需要最好给这些列创建复合索引。</p>
<ul>
<li>like语句操作</li>
</ul>
<p>一般情况下不鼓励使用like操作，如果非使用不可，如何使用也是一个问题。like “%aaa%” 不会使用索引而like “aaa%”可以使用索引。</p>
<ul>
<li>不要在列上进行运算</li>
</ul>
<p>select * from users where YEAR(adddate)&lt;2007;<br>将在每个行上进行运算，这将导致索引失效而进行全表扫描，因此我们可以改成</p>
<p>select * from users where adddate&lt;‘2007-01-01’; </p>
<ul>
<li>不使用NOT IN和&lt;&gt;操作</li>
</ul>
<h2 id="Explain执行计划"><a href="#Explain执行计划" class="headerlink" title="Explain执行计划"></a>Explain执行计划</h2><p>如果有些SQL贼慢，我们需要知道他有没有走索引，走了哪个索引，这个时候我就需要通过explain关键字来深入了解MySQL内部是如何执行的。</p>
<p><img src="/yangmiemie99.github.io/2020/04/04/SQL入门学习/explain.png" alt></p>
<h3 id="id"><a href="#id" class="headerlink" title="id"></a>id</h3><p>一般来说一个select一个唯一id，如果是子查询，就有两个select，id是不一样的，但是凡事有例外，有些子查询的，他们id是一样的。这是为什么呢？</p>
<p>那是因为MySQL在进行优化的时候已经将子查询改成了连接查询，而连接查询的id是一样的。</p>
<p>id 如果相同,可以认为是一组,从上往下顺序执行;在所有组中,id 值越大,优先级越高,越先执行</p>
<h3 id="select-type"><a href="#select-type" class="headerlink" title="select_type"></a>select_type</h3><p>查询的类型，主要用于:查询的类型,<br>用于区别:普通查询、联合查询、子查询等的复杂查询</p>
<p><img src="/yangmiemie99.github.io/2020/04/04/SQL入门学习/select_type.png" alt></p>
<h3 id="type列"><a href="#type列" class="headerlink" title="type列"></a>type列</h3><p>type 显示的是访问类型,是较为重要的一个指标,结果值从最好到最坏依次是:<br>system &gt; const &gt; eq_ref &gt; ref &gt; fulltext &gt; ref_or_null &gt; index_merge &gt; unique_subquery &gt;<br>index_subquery &gt; range &gt; index &gt; ALL<br>需要记忆的<br>system&gt;const&gt;eq_ref&gt;ref&gt;range&gt;index&gt;ALL<br>一般来说<strong>,得保证查询至少达到 range 级别</strong>,最好能达到 ref。</p>
<ul>
<li><p>system:只有一行记录（等于系统表），这是const类型的特例，平时不会出现这个也可以忽略不计。</p>
</li>
<li><p>const:通过索引一次就找到了，const 用于比较 primary key 或者 unique 索引。因为只匹配一行数据,所以很快<br>如将主键置于 where 列表中,MySQL 就能将该查询转换为一个常量 e.g <code>select * from t1 where id =1;</code> </p>
</li>
<li><p>eq_ref:<strong>唯一性索引扫描,</strong>对于每个索引键,表中只有一条记录与之匹配。常见于主键或唯一索引<br>扫描e.g<code>select * from t1,t2 where t1.id = t2.id;</code></p>
</li>
<li><p>Ref:<br><strong>非唯一性索引扫描,</strong>返回匹配某个单独值的所有行.本质上也是一种索引访问,它返回<strong>所有匹配某个单独值的行,</strong>然而,它可能会找到多个符合条件的行,所以他应该属于查找和扫描的混合体</p>
<p>e.g<code>select count(distinct col1) from t1;</code>  <code>select * from t1 where col1 = ‘ac’;</code></p>
</li>
<li><p>range: 只检索给定范围的行，使用一个索引来选择行。key列显示了使用了哪个索引，一般这就是在你的where中出席拿了between、&lt;、&gt;、in等的查询。这种范围扫描比全表扫描哟啊好，因为需要开始于索引的某一点，而结束语另一点，不用全表扫描。e.g<code>select * from t1 between 30 and 60</code></p>
</li>
<li><p>index:当查询的结果全为索引列的时候,虽然也是全部扫描,但是只查询的索引库,而没有去查询<br>数据。e.g<code>select id from t1;</code></p>
</li>
<li><p>all: 将遍历全表来找到匹配的行 <code>select * from t1 where column_without_index = ‘’</code></p>
</li>
</ul>
<h3 id="possible-keys与key"><a href="#possible-keys与key" class="headerlink" title="possible_keys与key"></a>possible_keys与key</h3><ul>
<li><p>possible_keys:</p>
<p>指出MySQL能使用哪个索引在表中找到记录，查询涉及到的字段上若存在索引，则该索引将被列出，但不一定被查询使用（该查询可以利用的索引，如果没有任何索引显示 null）<br>如果该列是NULL，则没有相关的索引。在这种情况下，可以通过检查WHERE子句看是否它引用某些列或适合索引的列来提高你的查询性能。如果是这样，创造一个适当的索引并且再次用EXPLAIN检查查询</p>
</li>
<li><p><strong>key_len</strong></p>
<p><strong>表示索引中使用的字节数，可通过该列计算查询中使用的索引的长度（key_len显示的值为索引字段的最大可能长度，并非实际使用长度，即key_len是根据表定义计算而得，不是通过表内检索出的）</strong></p>
<p>不损失精确性的情况下，长度越短越好 根据这个值,就可以判断索引使用情况</p>
<p>特别是在组合索引的时候,判断所有的索引字段是否都被查询用到。char 和 varchar 跟字符编码也有密切的联系,latin1 占用 1 个字节,gbk 占用 2 个字节,utf8 占用 3 个字节。(不同字符编码占用的存储空间不同)。如果索引允许为null那么该长度还需要加1个字节。varchar类型还需要加2字节。（变长类型需要额外字节保存长度）</p>
</li>
</ul>
<h3 id="ref"><a href="#ref" class="headerlink" title="ref"></a>ref</h3><p>显示索引的哪一列被使用了,如果可能的话,是一个常数。<strong>列与索引的比较，表示上述表的连接匹配条件，即哪些列或常量被用于查找索引列上的值</strong></p>
<h3 id="rows"><a href="#rows" class="headerlink" title="rows"></a><strong>rows</strong></h3><p> 估算出结果集行数，表示MySQL根据表统计信息及索引选用情况，估算的找到所需的记录所需要读取的行数</p>
<h3 id="Extra"><a href="#Extra" class="headerlink" title="Extra"></a>Extra</h3><p>包含不适合在其他列中显示但十分重要的额外信息。</p>
<p><img src="/yangmiemie99.github.io/2020/04/04/SQL入门学习/extra.png" alt></p>
<h4 id="Using-filesort"><a href="#Using-filesort" class="headerlink" title="Using filesort"></a>Using filesort</h4><p>说明 mysql 会对数据使用一个外部的索引排序,而不是按照表内的索引顺序进行读取。<br>MySQL 中无法利用索引完成的排序操作称为“文件排序”<br><strong>当发现有 Using filesort 后,实际上就是发现了可以优化的地方</strong></p>
<p><img src="/yangmiemie99.github.io/2020/04/04/SQL入门学习/filesort.png" alt></p>
<p>上图其实是一种索引失效的情况,后面会讲,可以看出查询中用到了个联合索引,索引分别为 col1,col2,col3</p>
<p><img src="/yangmiemie99.github.io/2020/04/04/SQL入门学习/filesort2.png" alt></p>
<p>当我排序新增了个 col2,发现 using filesort 就没有了。</p>
<h4 id="Using-temporary"><a href="#Using-temporary" class="headerlink" title="Using temporary"></a>Using temporary</h4><p>使了用临时表保存中间结果,MySQL 在对查询结果排序时使用临时表。常见于排序 order by和分组查询 group by。</p>
<h4 id="Using-index"><a href="#Using-index" class="headerlink" title="Using index"></a>Using index</h4><p>表示相应的 select 操作中使用了覆盖索引(Covering Index),避免访问了表的数据行,效率不错!</p>
<p>如果<strong>一个索引包含(或覆盖)所有需要查询的字段的值</strong>，称为‘覆盖索引’。即只需扫描索引而<strong>无须回表。</strong><br>只扫描索引而无需回表的优点：<br>    1.索引条目通常远小于数据行大小，只需要读取索引，则mysql会极大地减少数据访问量。<br>    2.因为索引是按照列值顺序存储的，所以对于IO密集的范围查找会比随机从磁盘读取每一行数据的IO少很多。<br>    3.一些存储引擎如myisam在内存中只缓存索引，数据则依赖于操作系统来缓存，因此要访问数据需要一次系统调用<br>    4.innodb的聚簇索引，覆盖索引对innodb表特别有用。(innodb的二级索引在叶子节点中保存了行的主键值，所以如果<strong>二级主键能够覆盖查询，则可以避免对主键索引的二次查询)</strong></p>
<p>覆盖索引必须要存储索引列的值，而哈希索引、空间索引和全文索引不存储索引列的值，所以mysql只能用B-tree索引做覆盖索引。</p>
<h2 id="MySQL中常见Log"><a href="#MySQL中常见Log" class="headerlink" title="MySQL中常见Log"></a>MySQL中常见Log</h2><h3 id="MySQL日志文件系统的组成"><a href="#MySQL日志文件系统的组成" class="headerlink" title="MySQL日志文件系统的组成"></a>MySQL日志文件系统的组成</h3><p>a、错误日志：记录启动、运行或停止mysqld时出现的问题。 b、通用日志：记录建立的客户端连接和执行的语句。 c、更新日志：记录更改数据的语句。该日志在MySQL 5.1中已不再使用。 d、<strong>二进制日志</strong>：binlog记录所有更改数据的语句。还用于复制。 e、慢查询日志：记录所有执行时间超过long_query_time秒的所有查询或不使用索引的查询。 f、<strong>Innodb日志</strong>：innodb redo log 和undo log</p>
<p>缺省情况下，所有日志创建于mysqld数据目录中。 可以通过刷新日志，来强制mysqld来关闭和重新打开日志文件（或者在某些情况下切换到一个新的日志）。 当你执行一个FLUSH LOGS语句或执行mysqladmin flush-logs或mysqladmin refresh时，则日志被老化。 对于存在MySQL复制的情形下，从复制服务器将维护更多日志文件，被称为接替日志。</p>
<h3 id="错误日志"><a href="#错误日志" class="headerlink" title="错误日志"></a>错误日志</h3><p>错误日志是一个文本文件。 错误日志记录了MySQL Server每次启动和关闭的详细信息以及运行过程中所有较为严重的警告和错误信息。 可以用–log-error[=file_name]选项来开启mysql错误日志，该选项指定mysqld保存错误日志文件的位置。 对于指定–log-error[=file_name]选项而未给定file_name值，mysqld使用错误日志名host_name.err 并在数据目录中写入日志文件。 在mysqld正在写入错误日志到文件时，执行FLUSH LOGS 或者mysqladmin flush-logs时，服务器将关闭并重新打开日志文件。 建议在flush之前手动重命名错误日志文件，之后mysql服务将使用原始文件名打开一个新文件。 以下为错误日志备份方法： shell&gt; mv host_name.err host_name.err-old shell&gt; mysqladmin flush-logs shell&gt; mv host_name.err-old backup-directory</p>
<h3 id="InnoDB中的日志"><a href="#InnoDB中的日志" class="headerlink" title="InnoDB中的日志"></a>InnoDB中的日志</h3><p>MySQL数据库InnoDB存储引擎Log漫游</p>
<h4 id="Undo-Log"><a href="#Undo-Log" class="headerlink" title="Undo Log"></a>Undo Log</h4><p><strong>Undo Log 是为了实现事务的原子性</strong>，在MySQL数据库InnoDB存储引擎中，<code>undo log</code>主要有两个作用：回滚和多版本控制(MVCC)</p>
<ul>
<li>事务的原子性(Atomicity) 事务中的所有操作，要么全部完成，要么不做任何操作，不能只做部分操作。如果在执行的过程中发生 了错误，要回滚(Rollback)到事务开始前的状态，就像这个事务从来没有执行过。</li>
<li>原理 Undo Log的原理很简单，为了满足事务的原子性，<strong>在操作任何数据之前，首先将数据备份到一个地方 （这个存储数据备份的地方称为Undo Log）。</strong><code>undo log</code>主要存储的也是逻辑日志，比如我们要<code>insert</code>一条数据了，那<code>undo log</code>会记录的一条对应的<code>delete</code>日志。我们要<code>update</code>一条记录时，它会记录一条对应<strong>相反</strong>的update记录。然后进行数据的修改。如果出现了错误或者用户执行了 ROLLBACK语句，系统可以利用Undo Log中的备份将数据恢复到事务开始之前的状态。</li>
<li>因为<code>undo log</code>存储着修改之前的数据，相当于一个<strong>前版本</strong>，MVCC实现的是读写不阻塞，读的时候只要返回前一个版本的数据就行了。</li>
</ul>
<p>除了可以保证事务的原子性，<strong>Undo Log也可以用来辅助完成事务的持久化</strong>。</p>
<ul>
<li><p>事务的持久性(Durability) 事务一旦完成，该事务对数据库所做的所有修改都会持久的保存到数据库中。为了保证持久性，数据库 系统会将修改后的数据完全的记录到持久的存储上。</p>
</li>
<li><p>用Undo Log实现原子性和持久化的事务的简化过程 假设有A、B两个数据，值分别为1,2。 A.事务开始. B.记录A=1到undo log. C.修改A=3. D.记录B=2到undo log. E.修改B=4. F.将undo log写到磁盘。 G.将数据写到磁盘。 H.事务提交 这里有一个隐含的前提条件：‘数据都是先读到内存中，然后修改内存中的数据，最后将数据写回磁盘’。</p>
<p>之所以能同时保证原子性和持久化，是因为以下特点： A. 更新数据前记录Undo log。 B. 为了保证持久性，必须将数据在事务提交前写到磁盘。只要事务成功提交，数据必然已经持久化。 C. Undo log必须先于数据持久化到磁盘。如果在G,H之间系统崩溃，undo log是完整的， 可以用来回滚事务。 D. 如果在A-F之间系统崩溃,因为数据没有持久化到磁盘。所以磁盘上的数据还是保持在事务开始前的状态。</p>
</li>
</ul>
<p>缺陷：每个事务提交前将数据和Undo Log写入磁盘，这样会导致大量的磁盘IO，因此性能很低。</p>
<p>如果能够将数据缓存一段时间，就能减少IO提高性能。但是这样就会丧失事务的持久性。因此引入了另外一 种机制来实现持久化，即Redo Log.</p>
<h4 id="Redo-Log"><a href="#Redo-Log" class="headerlink" title="Redo Log"></a>Redo Log</h4><ul>
<li>什么是redo log?及作用</li>
</ul>
<p>假设我们有一条sql语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> user_table <span class="keyword">set</span> <span class="keyword">name</span>=<span class="string">'java3y'</span> <span class="keyword">where</span> <span class="keyword">id</span> = <span class="string">'3'</span></span><br></pre></td></tr></table></figure>

<p>MySQL执行这条SQL语句，肯定是先把<code>id=3</code>的这条记录查出来，然后将<code>name</code>字段给改掉。这没问题吧？</p>
<p>实际上Mysql的基本存储结构是<strong>页</strong>(记录都存在页里边)，所以MySQL是先把这条记录所在的<strong>页</strong>找到，然后把该页加载到内存中，将对应记录进行修改。</p>
<p>现在就可能存在一个问题：<strong>如果在内存中把数据改了，还没来得及落磁盘，而此时的数据库挂了怎么办</strong>？显然这次更改就丢了。</p>
<p><img src="/yangmiemie99.github.io/2020/04/04/SQL入门学习/%E5%BC%82%E6%AD%A5.png" alt></p>
<p>如果每个请求都需要将数据<strong>立马</strong>落磁盘之后，那速度会很慢，MySQL可能也顶不住。所以MySQL是怎么做的呢？</p>
<p>MySQL引入了<code>redo log</code>，内存写完了，然后会写一份<code>redo log</code>，这份<code>redo log</code>记载着这次<strong>在某个页上做了什么修改</strong>。</p>
<p>其实写<code>redo log</code>的时候，也会有<code>buffer</code>，是先写<code>buffer</code>，再真正落到磁盘中的。至于从<code>buffer</code>什么时候落磁盘，会有配置供我们配置。</p>
<p>所以，<code>redo log</code>的存在为了：当我们修改的时候，写完内存了，但数据还没真正写到磁盘的时候。此时我们的数据库挂了，我们可以根据<code>redo log</code>来对数据进行恢复。因为<code>redo log</code>是顺序IO，所以<strong>写入的速度很快</strong>，并且<code>redo log</code>记载的是物理变化（xxxx页做了xxx修改），文件的体积很小，<strong>恢复速度很快</strong>。<br><img src="/yangmiemie99.github.io/2020/04/04/SQL入门学习/redo_log.png" alt></p>
<p>确保事务的持久性，防止在发生故障的时间点，尚有脏页未写入磁盘，在重启mysql服务的时候，根据redo log进行重做，<strong>从而达到事务的持久性这一特性</strong>。</p>
<ul>
<li><p>原理 和Undo Log相反，<strong>Redo Log记录的是新数据的备份</strong>。在事务提交前，只要将Redo Log持久化即可， 不需要将数据持久化。当系统崩溃时，虽然数据没有持久化，但是Redo Log已经持久化。系统可以根据 Redo Log的内容，将所有数据恢复到最新的状态。</p>
</li>
<li><p>Undo + Redo事务的简化过程 假设有A、B两个数据，值分别为1,2. A.事务开始. B.记录A=1到undo log. C.修改A=3. D.记录A=3到redo log. E.记录B=2到undo log. F.修改B=4. G.记录B=4到redo log. H.将redo log写入磁盘。 I.事务提交</p>
<p><strong>undo log 保存的是修改前的数据,并且保存到内存中,回滚的时候在读取里面的内容(从而实现了原子性),redolog保存的是修改后的数据(对新数据的备份,同时也会将redo log备份),在事务提交写入到磁盘,从而保证了持久性</strong></p>
</li>
</ul>
<h3 id="慢查询日志"><a href="#慢查询日志" class="headerlink" title="慢查询日志"></a>慢查询日志</h3><p>数据库查询快慢是影响项目性能的一大因素，对于数据库，我们除了要优化 SQL，更重要的是得先找到需要优化的 SQL。如何找到低效的 SQL 是写这篇文章的主要目的。</p>
<p>MySQL 数据库有一个“慢查询日志”功能，用来记录查询时间超过某个设定值的SQL，这将极大程度帮助我们快速定位到问题所在，以便对症下药。至于查询时间的多少才算慢，每个项目、业务都有不同的要求，传统企业的软件允许查询时间高于某个值，但是把这个标准放在互联网项目或者访问量大的网站上，估计就是一个bug，甚至可能升级为一个功能性缺陷。</p>
<p>为避免误导读者，特申明本文的讨论限制在 Win 64位 + MySQL 5.6 范围内。其他平台或数据库种类及版本，我没有尝试过，不做赘述。</p>
<p>设置日志功能 关于慢查询日志，主要涉及到下面几个参数：</p>
<p>slow_query_log ：是否开启慢查询日志功能（必填） long_query_time ：超过设定值，将被视作慢查询，并记录至慢查询日志文件中（必填） log-slow-queries ：慢查询日志文件（不可填），自动在 \data\ 创建一个 [hostname]-slow.log 文件 　　也就是说，只有满足以上三个条件，“慢查询功能”才可能正确开启或关闭。</p>
<h3 id="二进制日志"><a href="#二进制日志" class="headerlink" title="二进制日志"></a>二进制日志</h3><ul>
<li>主从复制的基础：binlog日志和relaylog日志</li>
</ul>
<p>什么是MySQL主从复制 简单来说就是保证主SQL（Master）和从SQL（Slave）的数据是一致性的，向Master插入数据后，Slave会自动从Master把修改的数据同步过来（有一定的延迟），通过这种方式来保证数据的一致性，就是主从复制</p>
<p>复制方式 MySQL5.6开始主从复制有两种方式：基于日志（binlog）、基于GTID（全局事务标示符）。 本文只涉及基于日志binlog的主从配置</p>
<p><strong>复制原理</strong> 1、Master将数据改变记录到二进制日志(binary log)中，也就是配置文件log-bin指定的文件，这些记录叫做二进制日志事件(binary log events) 2、Slave通过I/O线程读取Master中的binary log events并写入到它的中继日志(relay log) 3、Slave重做中继日志中的事件，把中继日志中的事件信息一条一条的在本地执行一次，完成数据在本地的存储，从而实现将改变反映到它自己的数据(数据重放)</p>
<ul>
<li><p>什么是binlog?</p>
<p>binlog是一个二进制格式的文件，用于记录用户对数据库更新的SQL语句信息，<strong>例如更改数据库表和更改内容的SQL语句都会记录到binlog里，但是对库表等内容的查询不会记录。</strong></p>
</li>
<li><p>binlog长什么样子？</p>
</li>
</ul>
<p><code>binlog</code>我们可以简单理解为：存储着每条变更的<code>SQL</code>语句（当然从下面的图看来看，不止SQL，还有XID「事务Id」等等）默认情况下，binlog日志是二进制格式的，不能使用查看文本工具的命令（比如，cat，vi等）查看，而使用mysqlbinlog解析查看。</p>
<ul>
<li>binlog的作用：<ul>
<li><strong>因为<code>binlog</code>记录了数据库表的变更，所以我们可以用<code>binlog</code>进行复制（主从复制)和恢复数据。</strong>当有数据写入到数据库时，还会同时把<strong>更新的SQL语句写入到对应的binlog文件里</strong>，这个文件就是上文说的binlog文件。使用mysqldump备份时，只是对一段时间的数据进行全备，但是如果备份后突然发现数据库服务器故障，这个时候就要用到binlog的日志了。</li>
<li>MySQL在公司使用的时候往往都是<strong>一主多从</strong>结构的，从服务器需要与主服务器的数据保持一致，这就是通过<code>binlog</code>来实现的</li>
<li>数据库的数据被干掉了，我们可以通过<code>binlog</code>来对数据进行恢复。</li>
</ul>
</li>
</ul>
<h3 id="binlog和reglog的写入细节"><a href="#binlog和reglog的写入细节" class="headerlink" title="binlog和reglog的写入细节"></a>binlog和reglog的写入细节</h3><p><code>redo log</code>是MySQL的InnoDB引擎所产生的。</p>
<p><code>binlog</code>无论MySQL用什么引擎，都会有的。</p>
<p>InnoDB是有事务的，事务的四大特性之一：持久性就是靠<code>redo log</code>来实现的（如果写入内存成功，但数据还没真正刷到磁盘，如果此时的数据库挂了，我们可以靠<code>redo log</code>来恢复内存的数据，这就实现了持久性）。</p>
<p>上面也提到，在修改的数据的时候，<code>binlog</code>会记载着变更的类容，<code>redo log</code>也会记载着变更的内容。（只不过一个存储的是物理变化，一个存储的是逻辑变化）。那他们的写入顺序是什么样的呢？</p>
<p><code>redo log</code><strong>事务开始</strong>的时候，就开始记录每次的变更信息，而<code>binlog</code>是在<strong>事务提交</strong>的时候才记录。</p>
<p>于是新有的问题又出现了：我写其中的某一个<code>log</code>，失败了，那会怎么办？现在我们的前提是先写<code>redo log</code>，再写<code>binlog</code>，我们来看看：</p>
<ul>
<li>如果写<code>redo log</code>失败了，那我们就认为这次事务有问题，回滚，不再写<code>binlog</code>。</li>
<li>如果写<code>redo log</code>成功了，写<code>binlog</code>，写<code>binlog</code>写一半了，但失败了怎么办？我们还是会对这次的<strong>事务回滚</strong>，将无效的<code>binlog</code>给删除（因为<code>binlog</code>会影响从库的数据，所以需要做删除操作）</li>
<li>如果写<code>redo log</code>和<code>binlog</code>都成功了，那这次算是事务才会真正成功。</li>
</ul>
<p>简单来说：MySQL需要保证<code>redo log</code>和<code>binlog</code>的<strong>数据是一致</strong>的，如果不一致，那就乱套了。</p>
<ul>
<li>如果<code>redo log</code>写失败了，而<code>binlog</code>写成功了。那假设内存的数据还没来得及落磁盘，机器就挂掉了。那主从服务器的数据就不一致了。（从服务器通过<code>binlog</code>得到最新的数据，而主服务器由于<code>redo log</code>没有记载，没法恢复数据）</li>
<li>如果<code>redo log</code>写成功了，而<code>binlog</code>写失败了。那从服务器就拿不到最新的数据了。</li>
</ul>
<p>MySQL通过<strong>两阶段提交</strong>来保证<code>redo log</code>和<code>binlog</code>的数据是一致的。</p>
<p><img src="/yangmiemie99.github.io/2020/04/04/SQL入门学习/relogbinlog.png" alt></p>
<h3 id="redo-log日志与binlog日志的区别"><a href="#redo-log日志与binlog日志的区别" class="headerlink" title="redo log日志与binlog日志的区别"></a>redo log日志与binlog日志的区别</h3><p>1、redo log是在InnoDB存储引擎层产生，而binlog是MySQL数据库的上层产生的，并且二进制日志不仅仅针对INNODB存储引擎，MySQL数据库中的任何存储引擎对于数据库的更改都会产生二进制日志。</p>
<p>2、两种日志记录的内容形式不同。MySQL的binlog是逻辑日志，其记录是对应的SQL语句。而innodb存储引擎层面的重做日志是物理日志。</p>
<p>3、两种日志与记录写入磁盘的时间点不同，二进制日志只在事务提交完成后进行一次写入。<strong>而innodb存储引擎的重做日志在事务进行中不断地被写入</strong>，并日志不是随事务提交的顺序进行写入的。<strong>二进制日志仅在事务提交时记录，并且对于每一个事务，仅在事务提交时记录，并且对于每一个事务，仅包含对应事务的一个日志</strong>。而对于innodb存储引擎的<strong>重做日志，由于其记录是物理操作日志，因此每个事务对应多个日志条目</strong>，并且事务的<strong>重做日志写入是并发的</strong>，并非在事务提交时写入，其在文件中记录的顺序并非是事务开始的顺序。</p>
<p>4、binlog不是循环使用，在写满或者重启之后，会生成新的binlog文件，redo log是循环使用。</p>
<p>5、binlog可以作为恢复数据使用，主从复制搭建，redo log作为异常宕机或者介质故障后的数据恢复使用。</p>
<h2 id="锁。"><a href="#锁。" class="headerlink" title="锁。"></a>锁。</h2><p><img src="/yangmiemie99.github.io/2020/04/04/SQL入门学习/%E9%94%81.png" alt></p>
<p>即使我们不会这些锁知识，我们的程序在<strong>一般情况下</strong>还是可以跑得好好的。因为这些锁数据库<strong>隐式</strong>帮我们加了</p>
<ul>
<li>对于<code>UPDATE、DELETE、INSERT</code>语句，<strong>InnoDB</strong>会<strong>自动</strong>给涉及数据集加排他锁（X)</li>
<li><strong>MyISAM</strong>在执行查询语句<code>SELECT</code>前，会<strong>自动</strong>给涉及的所有表加<strong>读锁</strong>，在执行更新操作（<code>UPDATE、DELETE、INSERT</code>等）前，会<strong>自动</strong>给涉及的表加<strong>写锁</strong>，这个过程并<strong>不需要用户干预</strong> </li>
</ul>
<p>首先，从锁的粒度，我们可以分成两大类：</p>
<ul>
<li>表锁<ul>
<li>开销小，加锁快；不会出现死锁；锁定力度大，发生锁冲突概率高，并发度最低</li>
</ul>
</li>
<li>行锁<ul>
<li>开销大，加锁慢；会出现死锁；锁定粒度小，发生锁冲突的概率低，并发度高</li>
</ul>
</li>
</ul>
<p>不同的存储引擎支持的锁粒度是不一样的：</p>
<ul>
<li><strong>InnoDB行锁和表锁都支持</strong>！</li>
<li><strong>MyISAM只支持表锁</strong>！</li>
</ul>
<p>InnoDB只有通过<strong>索引条件</strong>检索数据<strong>才使用行级锁</strong>，否则，InnoDB将使用<strong>表锁</strong></p>
<ul>
<li>也就是说，<strong>InnoDB的行锁是基于索引的</strong>！</li>
</ul>
<h3 id="表锁"><a href="#表锁" class="headerlink" title="表锁"></a>表锁</h3><p>表读锁（Table Read Lock）</p>
<p>表写锁（Table Write Lock）</p>
<p>在表读锁和表写锁的环境下：<strong>读读不阻塞，读写阻塞，写写阻塞</strong></p>
<ul>
<li>读读不阻塞：当前用户在读数据，其他的用户也在读数据，不会加锁</li>
<li>读写阻塞：当前用户在读数据，其他的用户<strong>不能修改当前用户读的数据</strong>，会加锁！</li>
<li>写写阻塞：当前用户在修改数据，其他的用户<strong>不能修改当前用户正在修改的数据</strong>，会加锁！</li>
</ul>
<p>从上面已经看到了：<strong>读锁和写锁是互斥的，读写操作是串行</strong>。</p>
<ul>
<li><p>如果某个进程想要获取读锁，<strong>同时</strong>另外一个进程想要获取写锁。在mysql里边，<strong>写锁是优先于读锁的</strong>！</p>
</li>
<li><p>MyISAM写锁和读锁优先级的问题是可以通过参数调节的：<code>max_write_lock_count</code>和<code>low-priority-updates</code></p>
</li>
<li><p><strong>MyISAM可以</strong>支持查询和插入操作的<strong>并发</strong>进行。可以通过系统变量<code>concurrent_insert</code>来指定哪种模式，在<strong>MyISAM</strong>中它默认是：如果MyISAM表中没有空洞（即表的中间没有被删除的行），MyISAM允许在一个进程读表的同时，另一个进程从<strong>表尾</strong>插入记录。</p>
<p>但是<strong>InnoDB存储引擎是不支持的</strong>！</p>
</li>
</ul>
<p><strong>max_write_lock_count：</strong></p>
<p>缺省情况下，写操作的优先级要高于读操作的优先级，即便是先发送的读请求，后发送的写请求，此时也会优先处理写请求，然后再处理读请求。这就造成一个问题：一旦我发出若干个写请求，就会堵塞所有的读请求，直到写请求全都处理完，才有机会处理读请求。此时可以考虑使用 max_write_lock_count：</p>
<p>max_write_lock_count=1</p>
<p>有了这样的设置，当系统处理一个写操作后，就会暂停写操作，给读操作执行的机会。</p>
<p><strong>low-priority-updates：</strong></p>
<p>我们还可以更干脆点，直接降低写操作的优先级，给读操作更高的优先级。</p>
<p>low-priority-updates=1</p>
<p><strong>concurrent_insert：</strong></p>
<p>通常来说，在MyISAM里读写操作是串行的，但当对同一个表进行查询和插入操作时，为了降低锁竞争的频率，根据concurrent_insert的设置，MyISAM是可以并行处理查询和插入的：</p>
<p>当concurrent_insert=0时，不允许并发插入功能。<br>当concurrent_insert=1时，允许对没有洞洞的表使用并发插入，新数据位于数据文件结尾（缺省）。<br>当concurrent_insert=2时，不管表有没有洞洞，都允许在数据文件结尾并发插入。</p>
<p>这样看来，把concurrent_insert设置为2是很划算的，至于由此产生的文件碎片，可以定期使用OPTIMIZE TABLE语法优化。</p>
<h3 id="行锁"><a href="#行锁" class="headerlink" title="行锁"></a>行锁</h3><p>上边简单讲解了表锁的相关知识，我们使用Mysql一般是使用InnoDB存储引擎的。InnoDB和MyISAM有两个本质的区别：</p>
<ul>
<li>InnoDB支持行锁</li>
<li>InnoDB支持事务</li>
</ul>
<p>从上面也说了：我们是<strong>很少手动加表锁</strong>的。表锁对我们程序员来说几乎是透明的，即使InnoDB不走索引，加的表锁也是自动的！</p>
<p>我们应该<strong>更加关注行锁的内容</strong>，因为InnoDB一大特性就是支持行锁！</p>
<p>InnoDB实现了以下<strong>两种</strong>类型的行锁。</p>
<ul>
<li>共享锁（S锁）：允许一个事务去读一行，阻止其他事务获得相同数据集的排他锁。 <ul>
<li>也叫做<strong>读锁</strong>：读锁是<strong>共享</strong>的，多个客户可以<strong>同时读取同一个</strong>资源，但<strong>不允许其他客户修改</strong>。</li>
</ul>
</li>
<li>排他锁（X锁)：允许获得排他锁的事务更新数据，阻止其他事务取得相同数据集的共享读锁和排他写锁。 <ul>
<li>也叫做<strong>写锁</strong>：写锁是排他的，<strong>写锁会阻塞其他的写锁和读锁</strong>。</li>
</ul>
</li>
</ul>
<p>看完上面的有没有发现，在一开始所说的：X锁，S锁，读锁，写锁，共享锁，排它锁其实<strong>总共就两个锁</strong>，只不过它们<strong>有多个名字罢了</strong><del>~</del></p>
<ol>
<li><code>select ... lock in share mode</code>: 会加共享锁(即下文中的<code>Shared Lock</code>)</li>
<li><code>select ... for update</code>: 会加排它锁</li>
</ol>
<h3 id="意向锁"><a href="#意向锁" class="headerlink" title="意向锁"></a>意向锁</h3><p><strong>为了允许行锁和表锁共存，实现多粒度锁机制</strong>，InnoDB还有两种内部使用的意向锁（Intention Locks），这两种意向锁都是<strong>表锁</strong>：</p>
<ul>
<li>意向共享锁（IS）：事务打算给数据行加行共享锁，事务在给一个数据行加共享锁前必须先取得该表的IS锁。</li>
<li>意向排他锁（IX）：事务打算给数据行加行排他锁，事务在给一个数据行加排他锁前必须先取得该表的IX锁。</li>
<li>意向锁也是数据库隐式帮我们做了，<strong>不需要程序员操心</strong>！</li>
</ul>
<h3 id="Record-Locks记录锁"><a href="#Record-Locks记录锁" class="headerlink" title="Record Locks记录锁"></a>Record Locks记录锁</h3><p>行锁，顾名思义，是加在<strong>索引行</strong>(对！是索引行！不是数据行！)上的锁。比如<code>select * from user where id=1 and id=10 for update</code>，就会在<code>id=1</code>和<code>id=10</code>的索引行上加Record Lock</p>
<h3 id="Gap-Locks间隙锁"><a href="#Gap-Locks间隙锁" class="headerlink" title="Gap Locks间隙锁"></a>Gap Locks间隙锁</h3><p>间隙锁，它会锁住两个索引之间的区域。比如<code>select * from user where id&gt;1 and id&lt;10 for update</code>，就会在id为(1,10)的索引区间上加Gap Lock</p>
<h3 id="Next-Key-Locks临键锁"><a href="#Next-Key-Locks临键锁" class="headerlink" title="Next-Key Locks临键锁"></a>Next-Key Locks临键锁</h3><p>也叫间隙锁，它是Record Lock + Gap Lock形成的一个闭区间锁。比如<code>select * from user where id&gt;=1 and id&lt;=10 for update</code>，就会在id为[1,10]的索引闭区间上加Next-Key Lock</p>
<h3 id="悲观锁"><a href="#悲观锁" class="headerlink" title="悲观锁"></a>悲观锁</h3><p>当我们要对一个数据库里的一条数据进行修改的时候，为了避免被其他人修改，最好的方法是直接对数据库加锁以防并发。这种借助数据库的锁机制，在修改数据之前先锁定，再修改的方式被称之为悲观锁。</p>
<p>所以，按照上面的例子。我们使用悲观锁的话其实很简单(手动加行锁就行了)：</p>
<ul>
<li><code>select * from xxxx for update</code></li>
</ul>
<p>在select 语句后边加了 <code>for update</code>相当于加了排它锁(写锁)，加了写锁以后，其他的事务就不能对它修改了！需要等待当前事务修改完之后才可以修改.</p>
<h3 id="乐观锁"><a href="#乐观锁" class="headerlink" title="乐观锁"></a>乐观锁</h3><p>乐观锁假设一般情况下不会造成冲突，所以在数据提交更新的时候，才会对数据的冲突与否进行检测，如果发生冲突了，则返回给用户错误信息，让用户决定怎么去做。</p>
<p>乐观锁不是数据库层面上的锁，是需要自己手动去加的锁。一般我们添加一个版本字段来实现：</p>
<p>具体过程是这样的：</p>
<p>张三<code>select * from table</code>  —&gt;会查询出记录出来，同时会有一个version字段</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>name</th>
<th>version</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>zhangsan</td>
<td>1</td>
</tr>
</tbody></table>
<p>李四<code>select * from table</code> —&gt;会查询出记录出来，同时会有一个version字段</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>name</th>
<th>version</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>zhangsan</td>
<td>1</td>
</tr>
</tbody></table>
<p>李四对这条记录做修改：<code>update A set Name=lisi,version=version+1 where ID=#{id} and version=#{version}</code>，判断之前查询到的version与现在的数据的version进行比较，<strong>同时会更新version字段</strong><br>此时数据库记录如下：</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>name</th>
<th>version</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>lisi</td>
<td>2</td>
</tr>
</tbody></table>
<p>张三也对这条记录修改：<code>update A set Name=lisi,version=version+1 where ID=#{id} and version=#{version}</code>，但失败了！因为<strong>当前数据库中的版本跟之前查询出来的版本不一致</strong>！</p>
<h2 id="MVCC和事务的隔离级别"><a href="#MVCC和事务的隔离级别" class="headerlink" title="MVCC和事务的隔离级别"></a>MVCC和事务的隔离级别</h2><p>数据库事务有不同的隔离级别，不同的隔离级别对锁的使用是不同的，<strong>锁的应用最终导致不同事务的隔离级别</strong></p>
<p>MVCC(Multi-Version Concurrency Control)多版本并发控制，可以简单地认为：<strong>MVCC就是行级锁的一个变种(升级版)</strong>。</p>
<ul>
<li>事务的隔离级别就是<strong>通过锁的机制来实现</strong>，只不过<strong>隐藏了加锁细节</strong> </li>
</ul>
<p>在<strong>表锁中我们读写是阻塞</strong>的，基于提升并发性能的考虑，<strong>MVCC一般读写是不阻塞的</strong>(所以说MVCC很多情况下避免了加锁的操作)</p>
<ul>
<li>MVCC实现的<strong>读写不阻塞</strong>正如其名：<strong>多版本</strong>并发控制—&gt;通过一定机制生成一个数据请求<strong>时间点的一致性数据快照（Snapshot)</strong>，并用这个快照来提供一定级别（<strong>语句级或事务级</strong>）的<strong>一致性读取</strong>。从用户的角度来看，好像是<strong>数据库可以提供同一数据的多个版本</strong>。</li>
</ul>
<p>快照有<strong>两个级别</strong>：</p>
<ul>
<li>语句级 <ul>
<li>针对于<code>Read committed</code>隔离级别</li>
</ul>
</li>
<li>事务级别 <ul>
<li>针对于<code>Repeatable read</code>隔离级别</li>
</ul>
</li>
</ul>
<h3 id="MVCC原理"><a href="#MVCC原理" class="headerlink" title="MVCC原理"></a>MVCC原理</h3><p>InnoDB的MVCC，是通过每行记录后边保存的两个隐藏列来实现的。一个保存了行的穿件时间，一个保存行的过期时间。当然实际存储的并不是实际的时间，而是系统版本号。每开始一个新的事务，系统版本号都会自动递增，事务开始时刻的系统版本号会作为事务的版本号，用来和查询到的每行记录的版本号比较。看一下repeeated read 隔离级别下，MVCC具体如何工作。</p>
<ul>
<li>select：InnoDB根据以下两个条件检查每行记录<ul>
<li>InnoDB只查找版本早于当前事务版本的数据行（也就是，行的系统版本号小于等于当前事务的版本号，）这样可以确保事务读取的行，要么是在事务开始之前存在的，要么是事务自身插入或者修改过的。</li>
<li>行的删除版本要么之前未定义，要么大于当前事务的版本号。这样确保事务读取到的行，在事务开始之前没有删除。</li>
</ul>
</li>
<li>insert:InnoDB为新的插入的每一行保存当前的系统把呢本好作为当前行的版本号。</li>
<li>delete:InnoDB为删除的每一行保存当前系统的版本号作为行删除标识。</li>
<li>updata:InnoDB为插入一行新的记录，保存当前的系统版本号作为行版本号，同时作为行删除标识。</li>
</ul>
<p>保存这两个额外的版本号，使得大多数读操作都可以不用加锁。这样设计使得读数据操作很简单，性能更好，并且也能保证只会读到符合标准的行。不足之处是每行记录都需要额外的空间，需要更多的行检查工作，以及一些额外的维护工作。</p>
<p>知乎大佬解释为</p>
<p><img src="/yangmiemie99.github.io/2020/04/04/SQL入门学习/MVCCzh.png" alt></p>
<h3 id="隔离"><a href="#隔离" class="headerlink" title="隔离"></a>隔离</h3><p>我们在初学的时候已经知道，事务的隔离级别有<strong>4种</strong>：</p>
<ul>
<li>Read uncommitted <ul>
<li>会出现脏读，不可重复读，幻读</li>
</ul>
</li>
<li>Read committed <ul>
<li>会出现不可重复读，幻读</li>
</ul>
</li>
<li>Repeatable read <ul>
<li>会出现幻读(但在Mysql实现的Repeatable read配合gap锁不会出现幻读！)</li>
</ul>
</li>
<li>Serializable <ul>
<li>串行，避免以上的情况！</li>
</ul>
</li>
</ul>
<h4 id="Read-uncommitted"><a href="#Read-uncommitted" class="headerlink" title="Read uncommitted"></a>Read uncommitted</h4><p>会出现的现象—&gt;脏读：<strong>一个事务读取到另外一个事务未提交的数据</strong></p>
<ul>
<li>例子：A向B转账，<strong>A执行了转账语句，但A还没有提交事务，B读取数据，发现自己账户钱变多了</strong>！B跟A说，我已经收到钱了。A回滚事务【rollback】，等B再查看账户的钱时，发现钱并没有多。</li>
<li>出现脏读的本质就是因为<strong>操作(修改)完该数据就立马释放掉锁</strong>，导致读的数据就变成了无用的或者是<strong>错误的数据</strong>。</li>
</ul>
<h4 id="READ-COMMITTED"><a href="#READ-COMMITTED" class="headerlink" title="READ COMMITTED"></a>READ COMMITTED</h4><p>既然读未提交有那么大的数据可靠性问题，那就往前迈一小步，读已提交。该级别下将锁的释放时机延迟到事务提交之后，从而实现了读已提交，解决了脏读<br> 但是！好像哪里不太对？！锁的释放时机延迟了，写与写操作之间产生锁竞争就算了，那在锁释放之前，读也不能读了吗？这并发性能不能忍！这时就该MVCC出马了，既然不想阻塞等待最新的数据，那就无视当前持有锁的操作，读取最新的历史版本数据先用着<br> 因此，在读已提交的级别下，<strong>每次select时</strong>都会通过<strong>MVCC获取当前数据的最新快照</strong>，不加任何锁，也无视任何锁(因为历史数据是构造出来的，身上不可能有锁)，完美解决读写之间的并发问题，和READ UNCOMMITTED的并发性能只差在写写操作上<br> 而为了进一步提升写写操作上的并发性能，该级别下不会使用前文提到的间隙锁，无论什么查询都只会加行锁，而且在执行完WHERE条件筛选之后，会立即释放掉不符合条件的行锁，对于并发性能的追求可谓仁至义尽了<br> 但是，正因为对并发性能的极致追求或者说贪婪，该级别下还是遗留了不可重复读和幻读问题：</p>
<ol>
<li>MVCC版本的生成时机: 是<strong>每次select时</strong>，这就意味着，如果我们在事务A中执行多次的select，<strong>在每次select之间有其他事务更新了我们读取的数据并提交了，那就出现了不可重复读</strong></li>
<li>锁的范围: 因为没有间隙锁，这就意味着，如果我们在事务A中多次执行<code>select * from user where age&gt;18 and age&lt;30 for update</code>时，其他事务是可以往age为(18,30)这个区间插入/删除数据的，那就出现了幻读</li>
</ol>
<h4 id="REPEATABLE-READ"><a href="#REPEATABLE-READ" class="headerlink" title="REPEATABLE READ"></a>REPEATABLE READ</h4><p>既然读已提交依然有较大的数据可靠性能问题，那就再往前迈一小步，可重复读，该级别在读已提交的基础上做了两点修改，从而避免了不可重复读和幻读：</p>
<ol>
<li>MVCC版本的生成时间: 一次事务中只在<strong>第一次select时</strong>生成版本，后续的查询都是在这个版本上进行，从而实现了可重复读</li>
</ol>
<p>锁的范围: 在行锁的基础上，加上Gap Lock，从而形成Next-Key Lock，在所有遍历过的(不管是否匹配条件)索引行上以及之间的区域上，都加上锁，阻塞其他事务在遍历范围内进行写操作，从而避免了幻读<br>看似很完美了对吧，并发性能上、读读、读写操作依旧两不误，写写操作为了数据可靠性做了妥协也是能接受的，皆大欢喜？<br>图样图森破！这个世界怕什么？猪队友啊！InnoDB在可重复读级别下已经将数据可靠性和并发性能两方面做得尽善尽美了，但前提是用户查询时能够主动善用Locking Reads，即前文提到的<code>select ... lock in share mode</code>和<code>select ... for update</code>。如果只是使用普通的<code>select</code>，依然防不住幻读<br>这是因为MVCC的快照只对读操作有效，对写操作无效，举例说明会更清晰一点： 事务A依次执行如下3条sql，事务B在语句1和2之间，插入10条age=20的记录，事务A就幻读了</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1\. <span class="keyword">select</span> <span class="keyword">count</span>(<span class="number">1</span>) <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> age=<span class="number">20</span>;</span><br><span class="line"><span class="comment">-- return 0: 当前没有age=20的</span></span><br><span class="line">2\. <span class="keyword">update</span> <span class="keyword">user</span> <span class="keyword">set</span> <span class="keyword">name</span>=<span class="keyword">test</span> <span class="keyword">where</span> age=<span class="number">20</span>;</span><br><span class="line"><span class="comment">-- Affects 10 rows: 因为事务B刚写入10条age=20的记录，而写操作是不受MVCC影响，能看到最新数据的，所以更新成功，而一旦操作成功，这些被操作的数据就会对当前事务可见</span></span><br><span class="line">3\. <span class="keyword">select</span> <span class="keyword">count</span>(<span class="number">1</span>) <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> age=<span class="number">20</span>;</span><br><span class="line"><span class="comment">-- return 10: 出现幻读</span></span><br></pre></td></tr></table></figure>

<p>这种场景，需要用户主动使用Locking Read来防止其他事务在查询范围内进行写操作，因此，为了防患于未然，隔离级别又往前迈了一步</p>
<h4 id="SERIALISABLE"><a href="#SERIALISABLE" class="headerlink" title="SERIALISABLE"></a>SERIALISABLE</h4><p>大杀器，该级别下，会自动将所有普通<code>select</code>转化为<code>select ... lock in share mode</code>执行，即针对同一数据的所有读写都变成互斥的了，可靠性大大提高，并发性大大降低<br>机智如你可能会问，那可重复读级别下使用Locking Read不也变成读写互斥了嘛，那这两个有什么区别呢？可重复读你可以自己选择是否使用Locking Read呀，艺高人胆大可以使用普通的<code>select</code>读写并发的嘛</p>
<table>
<thead>
<tr>
<th>隔离级别</th>
<th>MVCC版本生成时机</th>
<th>写操作释放锁的时机</th>
<th>锁的范围</th>
<th>丢失修改</th>
<th>脏读</th>
<th>不可重复度</th>
<th>幻读</th>
</tr>
</thead>
<tbody><tr>
<td>READ UNCOMMITTED</td>
<td>/</td>
<td>SQL执行完立即释放</td>
<td>行锁</td>
<td>√</td>
<td>√</td>
<td>√</td>
<td>√</td>
</tr>
<tr>
<td>READ COMMITTED</td>
<td>每次select时</td>
<td>事务结束后</td>
<td>行锁</td>
<td></td>
<td></td>
<td>√</td>
<td>√</td>
</tr>
<tr>
<td>REPEATABLE READ</td>
<td>事务第一次select时</td>
<td>事务结束后</td>
<td>行锁或间隙锁</td>
<td></td>
<td></td>
<td></td>
<td>特定情况下</td>
</tr>
<tr>
<td>SERIALIZABLE</td>
<td>事务第一次select时</td>
<td>事务结束后</td>
<td>行锁或间隙锁</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/yangmiemie99.github.io/tags/数据库/" rel="tag"># 数据库</a>
          
            <a href="/yangmiemie99.github.io/tags/MySQL/" rel="tag"># MySQL</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/yangmiemie99.github.io/2020/03/28/文件系统和文件/" rel="next" title="文件系统和文件">
                <i class="fa fa-chevron-left"></i> 文件系统和文件
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/yangmiemie99.github.io/2020/04/16/网络分析工具/" rel="prev" title="网络分析工具">
                网络分析工具 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/yangmiemie99.github.io/images/touxiang.jpeg" alt="Yang MieMie">
            
              <p class="site-author-name" itemprop="name">Yang MieMie</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/yangmiemie99.github.io/archives/">
              
                  <span class="site-state-item-count">43</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/yangmiemie99.github.io/categories/index.html">
                  <span class="site-state-item-count">11</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/yangmiemie99.github.io/tags/index.html">
                  <span class="site-state-item-count">32</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/yangmiemie99" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#数据库基础概念"><span class="nav-number">1.</span> <span class="nav-text">数据库基础概念</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#什么是数据库"><span class="nav-number">1.1.</span> <span class="nav-text">什么是数据库</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#数据库软件"><span class="nav-number">1.2.</span> <span class="nav-text">数据库软件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#表"><span class="nav-number">1.3.</span> <span class="nav-text">表</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#模式"><span class="nav-number">1.4.</span> <span class="nav-text">模式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#列和数据类型"><span class="nav-number">1.5.</span> <span class="nav-text">列和数据类型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#行"><span class="nav-number">1.6.</span> <span class="nav-text">行</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#主键"><span class="nav-number">1.7.</span> <span class="nav-text">主键</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#什么是-SQL"><span class="nav-number">1.8.</span> <span class="nav-text">什么是 SQL</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#什么是-MySQL"><span class="nav-number">1.9.</span> <span class="nav-text">什么是 MySQL</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#基于客户机—服务器的数据库"><span class="nav-number">1.9.1.</span> <span class="nav-text">基于客户机—服务器的数据库</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#登录和退出MySQL服务器"><span class="nav-number">1.10.</span> <span class="nav-text">登录和退出MySQL服务器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#数据类型"><span class="nav-number">1.11.</span> <span class="nav-text">数据类型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#基本语法"><span class="nav-number">1.12.</span> <span class="nav-text">基本语法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#输入中文乱码解决"><span class="nav-number">1.13.</span> <span class="nav-text">输入中文乱码解决</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#建表约束"><span class="nav-number">1.14.</span> <span class="nav-text">建表约束</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#主键约束"><span class="nav-number">1.14.1.</span> <span class="nav-text">主键约束</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#唯一约束"><span class="nav-number">1.14.2.</span> <span class="nav-text">唯一约束</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#非空约束"><span class="nav-number">1.14.3.</span> <span class="nav-text">非空约束</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#默认约束"><span class="nav-number">1.14.4.</span> <span class="nav-text">默认约束</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#外键约束"><span class="nav-number">1.14.5.</span> <span class="nav-text">外键约束</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#数据库的三大设计范式"><span class="nav-number">1.15.</span> <span class="nav-text">数据库的三大设计范式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1NF"><span class="nav-number">1.15.1.</span> <span class="nav-text">1NF</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2NF"><span class="nav-number">1.15.2.</span> <span class="nav-text">2NF</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3NF"><span class="nav-number">1.15.3.</span> <span class="nav-text">3NF</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查询边学边练"><span class="nav-number">1.16.</span> <span class="nav-text">查询边学边练</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#准备数据"><span class="nav-number">1.16.1.</span> <span class="nav-text">准备数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#查询基本使用"><span class="nav-number">1.16.2.</span> <span class="nav-text">查询基本使用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#WHERE子句注意"><span class="nav-number">1.16.3.</span> <span class="nav-text">WHERE子句注意</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#AND和OR的计算次序"><span class="nav-number">1.16.4.</span> <span class="nav-text">AND和OR的计算次序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#通配符LIKE"><span class="nav-number">1.16.5.</span> <span class="nav-text">通配符LIKE</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#where子句中的正则表达式"><span class="nav-number">1.16.6.</span> <span class="nav-text">where子句中的正则表达式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建计算字段"><span class="nav-number">1.16.7.</span> <span class="nav-text">创建计算字段</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#数据汇总"><span class="nav-number">1.16.8.</span> <span class="nav-text">数据汇总</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#聚集函数"><span class="nav-number">1.16.8.1.</span> <span class="nav-text">聚集函数</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#分组数据"><span class="nav-number">1.16.9.</span> <span class="nav-text">分组数据</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#过滤分组"><span class="nav-number">1.16.9.1.</span> <span class="nav-text">过滤分组</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#分组计算平均成绩"><span class="nav-number">1.16.10.</span> <span class="nav-text">分组计算平均成绩</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#分组条件与模糊查询"><span class="nav-number">1.16.11.</span> <span class="nav-text">分组条件与模糊查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#多表查询-1"><span class="nav-number">1.16.12.</span> <span class="nav-text">多表查询 - 1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#多表查询-2"><span class="nav-number">1.16.13.</span> <span class="nav-text">多表查询 - 2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#三表关联查询"><span class="nav-number">1.16.14.</span> <span class="nav-text">三表关联查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#子查询加分组求平均分"><span class="nav-number">1.16.15.</span> <span class="nav-text">子查询加分组求平均分</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#子查询-1"><span class="nav-number">1.16.16.</span> <span class="nav-text">子查询 - 1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#子查询-2"><span class="nav-number">1.16.17.</span> <span class="nav-text">子查询 - 2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#YEAR-函数与带-IN-关键字查询"><span class="nav-number">1.16.18.</span> <span class="nav-text">YEAR 函数与带 IN 关键字查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#多层嵌套子查询"><span class="nav-number">1.16.19.</span> <span class="nav-text">多层嵌套子查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#多表查询"><span class="nav-number">1.16.20.</span> <span class="nav-text">多表查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#子查询-3"><span class="nav-number">1.16.21.</span> <span class="nav-text">子查询 - 3</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#UNION-和-NOTIN-的使用"><span class="nav-number">1.16.22.</span> <span class="nav-text">UNION 和 NOTIN 的使用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ANY-表示至少一个-DESC-降序"><span class="nav-number">1.16.23.</span> <span class="nav-text">ANY 表示至少一个 - DESC ( 降序 )</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#表示所有的-ALL"><span class="nav-number">1.16.24.</span> <span class="nav-text">表示所有的 ALL</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#别名"><span class="nav-number">1.16.25.</span> <span class="nav-text">别名</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#复制表的数据作为条件查询"><span class="nav-number">1.16.26.</span> <span class="nav-text">复制表的数据作为条件查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#子查询-4"><span class="nav-number">1.16.27.</span> <span class="nav-text">子查询 - 4</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#条件加组筛选"><span class="nav-number">1.16.28.</span> <span class="nav-text">条件加组筛选</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#NOTLIKE-模糊查询取反"><span class="nav-number">1.16.29.</span> <span class="nav-text">NOTLIKE 模糊查询取反</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#YEAR-与-NOW-函数"><span class="nav-number">1.16.30.</span> <span class="nav-text">YEAR 与 NOW 函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MAX-与-MIN-函数"><span class="nav-number">1.16.31.</span> <span class="nav-text">MAX 与 MIN 函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#多段排序"><span class="nav-number">1.16.32.</span> <span class="nav-text">多段排序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#子查询-5"><span class="nav-number">1.16.33.</span> <span class="nav-text">子查询 - 5</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MAX-函数与子查询"><span class="nav-number">1.16.34.</span> <span class="nav-text">MAX 函数与子查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#子查询-6"><span class="nav-number">1.16.35.</span> <span class="nav-text">子查询 - 6</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#子查询-7"><span class="nav-number">1.16.36.</span> <span class="nav-text">子查询 - 7</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#子查询-8"><span class="nav-number">1.16.37.</span> <span class="nav-text">子查询 - 8</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#按等级查询"><span class="nav-number">1.16.38.</span> <span class="nav-text">按等级查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#连接查询"><span class="nav-number">1.16.39.</span> <span class="nav-text">连接查询</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#内连接"><span class="nav-number">1.16.39.1.</span> <span class="nav-text">内连接</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#左外连接"><span class="nav-number">1.16.39.2.</span> <span class="nav-text">左外连接</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#右外链接"><span class="nav-number">1.16.39.3.</span> <span class="nav-text">右外链接</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#全外链接"><span class="nav-number">1.16.39.4.</span> <span class="nav-text">全外链接</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#视图"><span class="nav-number">1.17.</span> <span class="nav-text">视图</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#为什么用视图？"><span class="nav-number">1.17.1.</span> <span class="nav-text">为什么用视图？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用视图"><span class="nav-number">1.17.2.</span> <span class="nav-text">使用视图</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#事务"><span class="nav-number">1.18.</span> <span class="nav-text">事务</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#如何控制事务-COMMIT-ROLLBACK"><span class="nav-number">1.18.1.</span> <span class="nav-text">如何控制事务 - COMMIT / ROLLBACK</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#手动开启事务-BEGIN-START-TRANSACTION"><span class="nav-number">1.18.2.</span> <span class="nav-text">手动开启事务 - BEGIN / START TRANSACTION</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#事务的-ACID-特征与使用"><span class="nav-number">1.18.3.</span> <span class="nav-text">事务的 ACID 特征与使用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#事务的隔离性"><span class="nav-number">1.18.4.</span> <span class="nav-text">事务的隔离性</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#脏读"><span class="nav-number">1.18.4.1.</span> <span class="nav-text">脏读</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#不可重复读"><span class="nav-number">1.18.4.2.</span> <span class="nav-text">不可重复读</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#幻读"><span class="nav-number">1.18.4.3.</span> <span class="nav-text">幻读</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#串行化"><span class="nav-number">1.18.4.4.</span> <span class="nav-text">串行化</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#缓存"><span class="nav-number">1.19.</span> <span class="nav-text">缓存</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#SQL执行过程"><span class="nav-number">1.19.1.</span> <span class="nav-text">SQL执行过程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#查询缓存"><span class="nav-number">1.19.2.</span> <span class="nav-text">查询缓存</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#原理"><span class="nav-number">1.19.3.</span> <span class="nav-text">原理</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#索引"><span class="nav-number">1.20.</span> <span class="nav-text">索引</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#原理部分转载"><span class="nav-number">1.20.1.</span> <span class="nav-text">原理部分转载</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#MyISAM索引实现"><span class="nav-number">1.20.1.1.</span> <span class="nav-text">MyISAM索引实现</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#InnoDB索引实现"><span class="nav-number">1.20.1.2.</span> <span class="nav-text">InnoDB索引实现</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#索引的分类"><span class="nav-number">1.20.2.</span> <span class="nav-text">索引的分类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建索引"><span class="nav-number">1.20.3.</span> <span class="nav-text">创建索引</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#删除和查询索引"><span class="nav-number">1.20.4.</span> <span class="nav-text">删除和查询索引</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#索引的不足之处"><span class="nav-number">1.20.5.</span> <span class="nav-text">索引的不足之处</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用索引的注意事项"><span class="nav-number">1.20.6.</span> <span class="nav-text">使用索引的注意事项</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Explain执行计划"><span class="nav-number">1.21.</span> <span class="nav-text">Explain执行计划</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#id"><span class="nav-number">1.21.1.</span> <span class="nav-text">id</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#select-type"><span class="nav-number">1.21.2.</span> <span class="nav-text">select_type</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#type列"><span class="nav-number">1.21.3.</span> <span class="nav-text">type列</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#possible-keys与key"><span class="nav-number">1.21.4.</span> <span class="nav-text">possible_keys与key</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ref"><span class="nav-number">1.21.5.</span> <span class="nav-text">ref</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#rows"><span class="nav-number">1.21.6.</span> <span class="nav-text">rows</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Extra"><span class="nav-number">1.21.7.</span> <span class="nav-text">Extra</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Using-filesort"><span class="nav-number">1.21.7.1.</span> <span class="nav-text">Using filesort</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Using-temporary"><span class="nav-number">1.21.7.2.</span> <span class="nav-text">Using temporary</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Using-index"><span class="nav-number">1.21.7.3.</span> <span class="nav-text">Using index</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MySQL中常见Log"><span class="nav-number">1.22.</span> <span class="nav-text">MySQL中常见Log</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#MySQL日志文件系统的组成"><span class="nav-number">1.22.1.</span> <span class="nav-text">MySQL日志文件系统的组成</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#错误日志"><span class="nav-number">1.22.2.</span> <span class="nav-text">错误日志</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#InnoDB中的日志"><span class="nav-number">1.22.3.</span> <span class="nav-text">InnoDB中的日志</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Undo-Log"><span class="nav-number">1.22.3.1.</span> <span class="nav-text">Undo Log</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Redo-Log"><span class="nav-number">1.22.3.2.</span> <span class="nav-text">Redo Log</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#慢查询日志"><span class="nav-number">1.22.4.</span> <span class="nav-text">慢查询日志</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#二进制日志"><span class="nav-number">1.22.5.</span> <span class="nav-text">二进制日志</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#binlog和reglog的写入细节"><span class="nav-number">1.22.6.</span> <span class="nav-text">binlog和reglog的写入细节</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#redo-log日志与binlog日志的区别"><span class="nav-number">1.22.7.</span> <span class="nav-text">redo log日志与binlog日志的区别</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#锁。"><span class="nav-number">1.23.</span> <span class="nav-text">锁。</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#表锁"><span class="nav-number">1.23.1.</span> <span class="nav-text">表锁</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#行锁"><span class="nav-number">1.23.2.</span> <span class="nav-text">行锁</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#意向锁"><span class="nav-number">1.23.3.</span> <span class="nav-text">意向锁</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Record-Locks记录锁"><span class="nav-number">1.23.4.</span> <span class="nav-text">Record Locks记录锁</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Gap-Locks间隙锁"><span class="nav-number">1.23.5.</span> <span class="nav-text">Gap Locks间隙锁</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Next-Key-Locks临键锁"><span class="nav-number">1.23.6.</span> <span class="nav-text">Next-Key Locks临键锁</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#悲观锁"><span class="nav-number">1.23.7.</span> <span class="nav-text">悲观锁</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#乐观锁"><span class="nav-number">1.23.8.</span> <span class="nav-text">乐观锁</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MVCC和事务的隔离级别"><span class="nav-number">1.24.</span> <span class="nav-text">MVCC和事务的隔离级别</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#MVCC原理"><span class="nav-number">1.24.1.</span> <span class="nav-text">MVCC原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#隔离"><span class="nav-number">1.24.2.</span> <span class="nav-text">隔离</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Read-uncommitted"><span class="nav-number">1.24.2.1.</span> <span class="nav-text">Read uncommitted</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#READ-COMMITTED"><span class="nav-number">1.24.2.2.</span> <span class="nav-text">READ COMMITTED</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#REPEATABLE-READ"><span class="nav-number">1.24.2.3.</span> <span class="nav-text">REPEATABLE READ</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SERIALISABLE"><span class="nav-number">1.24.2.4.</span> <span class="nav-text">SERIALISABLE</span></a></li></ol></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Yang MieMie</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/yangmiemie99.github.io/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/yangmiemie99.github.io/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/yangmiemie99.github.io/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/yangmiemie99.github.io/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/yangmiemie99.github.io/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/yangmiemie99.github.io/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/yangmiemie99.github.io/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/yangmiemie99.github.io/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/yangmiemie99.github.io/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/yangmiemie99.github.io/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/yangmiemie99.github.io/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/yangmiemie99.github.io/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/yangmiemie99.github.io/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config("");
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
  


  

  

</body>
</html>
